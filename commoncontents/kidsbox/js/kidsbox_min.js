(function(){var ai=this,ac=ai._,ae={},ar=Array.prototype,ab=Object.prototype,an=Function.prototype,aw=ar.push,ah=ar.slice,au=ar.concat,ak=ab.toString,aq=ab.hasOwnProperty,ad=ar.forEach,ag=ar.map,ao=ar.reduce,aa=ar.reduceRight,at=ar.filter,ap=ar.every,aj=ar.some,X=ar.indexOf,av=ar.lastIndexOf,Y=Array.isArray,ax=Object.keys,am=an.bind,Z=function(a){return a instanceof Z?a:this instanceof Z?(this._wrapped=a,void 0):new Z(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Z),exports._=Z):ai._=Z,Z.VERSION="1.4.4";var W=Z.each=Z.forEach=function(h,f,g){if(null!=h){if(ad&&h.forEach===ad){h.forEach(f,g)}else{if(h.length===+h.length){for(var c=0,d=h.length;d>c;c++){if(f.call(g,h[c],c,h)===ae){return}}}else{for(var b in h){if(Z.has(h,b)&&f.call(g,h[b],b,h)===ae){return}}}}}};Z.map=Z.collect=function(d,a,b){var c=[];return null==d?c:ag&&d.map===ag?d.map(a,b):(W(d,function(g,e,f){c[c.length]=a.call(b,g,e,f)}),c)};var H="Reduce of empty array with no initial value";Z.reduce=Z.foldl=Z.inject=function(f,b,c,d){var a=arguments.length>2;if(null==f&&(f=[]),ao&&f.reduce===ao){return d&&(b=Z.bind(b,d)),a?f.reduce(b,c):f.reduce(b)}if(W(f,function(h,g,e){a?c=b.call(d,c,h,g,e):(c=h,a=!0)}),!a){throw new TypeError(H)}return c},Z.reduceRight=Z.foldr=function(j,f,g,h){var c=arguments.length>2;if(null==j&&(j=[]),aa&&j.reduceRight===aa){return h&&(f=Z.bind(f,h)),c?j.reduceRight(f,g):j.reduceRight(f)}var d=j.length;if(d!==+d){var b=Z.keys(j);d=b.length}if(W(j,function(e,i,a){i=b?b[--d]:--d,c?g=f.call(h,g,j[i],i,a):(g=j[i],c=!0)}),!c){throw new TypeError(H)}return g},Z.find=Z.detect=function(d,a,b){var c;return Q(d,function(g,e,f){return a.call(b,g,e,f)?(c=g,!0):void 0}),c},Z.filter=Z.select=function(d,a,b){var c=[];return null==d?c:at&&d.filter===at?d.filter(a,b):(W(d,function(g,e,f){a.call(b,g,e,f)&&(c[c.length]=g)}),c)},Z.reject=function(c,a,b){return Z.filter(c,function(g,f,d){return !a.call(b,g,f,d)},b)},Z.every=Z.all=function(d,b,c){b||(b=Z.identity);var a=!0;return null==d?a:ap&&d.every===ap?d.every(b,c):(W(d,function(g,f,e){return(a=a&&b.call(c,g,f,e))?void 0:ae}),!!a)};var Q=Z.some=Z.any=function(d,b,c){b||(b=Z.identity);var a=!1;return null==d?a:aj&&d.some===aj?d.some(b,c):(W(d,function(g,f,e){return a||(a=b.call(c,g,f,e))?ae:void 0}),!!a)};Z.contains=Z.include=function(b,a){return null==b?!1:X&&b.indexOf===X?b.indexOf(a)!=-1:Q(b,function(c){return c===a})},Z.invoke=function(d,a){var b=ah.call(arguments,2),c=Z.isFunction(a);return Z.map(d,function(e){return(c?a:e[a]).apply(e,b)})},Z.pluck=function(b,a){return Z.map(b,function(c){return c[a]})},Z.where=function(c,a,b){return Z.isEmpty(a)?b?null:[]:Z[b?"find":"filter"](c,function(e){for(var d in a){if(a[d]!==e[d]){return !1}}return !0})},Z.findWhere=function(b,a){return Z.where(b,a,!0)},Z.max=function(d,a,b){if(!a&&Z.isArray(d)&&d[0]===+d[0]&&65535>d.length){return Math.max.apply(Math,d)}if(!a&&Z.isEmpty(d)){return -1/0}var c={computed:-1/0,value:-1/0};return W(d,function(h,f,g){var e=a?a.call(b,h,f,g):h;e>=c.computed&&(c={value:h,computed:e})}),c.value},Z.min=function(d,a,b){if(!a&&Z.isArray(d)&&d[0]===+d[0]&&65535>d.length){return Math.min.apply(Math,d)}if(!a&&Z.isEmpty(d)){return 1/0}var c={computed:1/0,value:1/0};return W(d,function(h,f,g){var e=a?a.call(b,h,f,g):h;c.computed>e&&(c={value:h,computed:e})}),c.value},Z.shuffle=function(d){var a,b=0,c=[];return W(d,function(e){a=Z.random(b++),c[b-1]=c[a],c[a]=e}),c};var al=function(a){return Z.isFunction(a)?a:function(b){return b[a]}};Z.sortBy=function(d,a,b){var c=al(a);return Z.pluck(Z.map(d,function(g,f,e){return{value:g,index:f,criteria:c.call(b,g,f,e)}}).sort(function(i,f){var g=i.criteria,h=f.criteria;if(g!==h){if(g>h||g===void 0){return 1}if(h>g||h===void 0){return -1}}return i.index<f.index?-1:1}),"value")};var P=function(g,c,d,f){var a={},b=al(c||Z.identity);return W(g,function(h,e){var i=b.call(d,h,e,g);f(a,i,h)}),a};Z.groupBy=function(c,a,b){return P(c,a,b,function(f,d,e){(Z.has(f,d)?f[d]:f[d]=[]).push(e)})},Z.countBy=function(c,a,b){return P(c,a,b,function(e,d){Z.has(e,d)||(e[d]=0),e[d]++})},Z.sortedIndex=function(k,f,g,h){g=null==g?Z.identity:al(g);for(var c=g.call(h,f),d=0,b=k.length;b>d;){var j=d+b>>>1;c>g.call(h,k[j])?d=j+1:b=j}return d},Z.toArray=function(a){return a?Z.isArray(a)?ah.call(a):a.length===+a.length?Z.map(a,Z.identity):Z.values(a):[]},Z.size=function(a){return null==a?0:a.length===+a.length?a.length:Z.keys(a).length},Z.first=Z.head=Z.take=function(c,a,b){return null==c?void 0:null==a||b?c[0]:ah.call(c,0,a)},Z.initial=function(c,a,b){return ah.call(c,0,c.length-(null==a||b?1:a))},Z.last=function(c,a,b){return null==c?void 0:null==a||b?c[c.length-1]:ah.call(c,Math.max(c.length-a,0))},Z.rest=Z.tail=Z.drop=function(c,a,b){return ah.call(c,null==a||b?1:a)},Z.compact=function(a){return Z.filter(a,Z.identity)};var G=function(c,a,b){return W(c,function(d){Z.isArray(d)?a?aw.apply(b,d):G(d,a,b):b.push(d)}),b};Z.flatten=function(b,a){return G(b,a,[])},Z.without=function(a){return Z.difference(a,ah.call(arguments,1))},Z.uniq=Z.unique=function(j,f,g,h){Z.isFunction(f)&&(h=g,g=f,f=!1);var c=g?Z.map(j,g,h):j,d=[],b=[];return W(c,function(a,i){(f?i&&b[b.length-1]===a:Z.contains(b,a))||(b.push(a),d.push(j[i]))}),d},Z.union=function(){return Z.uniq(au.apply(ar,arguments))},Z.intersection=function(b){var a=ah.call(arguments,1);return Z.filter(Z.uniq(b),function(c){return Z.every(a,function(d){return Z.indexOf(d,c)>=0})})},Z.difference=function(b){var a=au.apply(ar,ah.call(arguments,1));return Z.filter(b,function(c){return !Z.contains(a,c)})},Z.zip=function(){for(var d=ah.call(arguments),a=Z.max(Z.pluck(d,"length")),b=Array(a),c=0;a>c;c++){b[c]=Z.pluck(d,""+c)}return b},Z.object=function(f,b){if(null==f){return{}}for(var c={},d=0,a=f.length;a>d;d++){b?c[f[d]]=b[d]:c[f[d][0]]=f[d][1]}return c},Z.indexOf=function(f,b,c){if(null==f){return -1}var d=0,a=f.length;if(c){if("number"!=typeof c){return d=Z.sortedIndex(f,b),f[d]===b?d:-1}d=0>c?Math.max(0,a+c):c}if(X&&f.indexOf===X){return f.indexOf(b,c)}for(;a>d;d++){if(f[d]===b){return d}}return -1},Z.lastIndexOf=function(f,b,c){if(null==f){return -1}var d=null!=c;if(av&&f.lastIndexOf===av){return d?f.lastIndexOf(b,c):f.lastIndexOf(b)}for(var a=d?c:f.length;a--;){if(f[a]===b){return a}}return -1},Z.range=function(g,c,d){1>=arguments.length&&(c=g||0,g=0),d=arguments[2]||1;for(var f=Math.max(Math.ceil((c-g)/d),0),a=0,b=Array(f);f>a;){b[a++]=g,g+=d}return b},Z.bind=function(c,a){if(c.bind===am&&am){return am.apply(c,ah.call(arguments,1))}var b=ah.call(arguments,2);return function(){return c.apply(a,b.concat(ah.call(arguments)))}},Z.partial=function(b){var a=ah.call(arguments,1);return function(){return b.apply(this,a.concat(ah.call(arguments)))}},Z.bindAll=function(b){var a=ah.call(arguments,1);return 0===a.length&&(a=Z.functions(b)),W(a,function(c){b[c]=Z.bind(b[c],b)}),b},Z.memoize=function(c,a){var b={};return a||(a=Z.identity),function(){var d=a.apply(this,arguments);return Z.has(b,d)?b[d]:b[d]=c.apply(this,arguments)}},Z.delay=function(c,a){var b=ah.call(arguments,2);return setTimeout(function(){return c.apply(null,b)},a)},Z.defer=function(a){return Z.delay.apply(Z,[a,1].concat(ah.call(arguments,1)))},Z.throttle=function(k,f){var g,h,c,d,b=0,j=function(){b=new Date,c=null,d=k.apply(g,h)};return function(){var e=new Date,a=f-(e-b);return g=this,h=arguments,0>=a?(clearTimeout(c),c=null,b=e,d=k.apply(g,h)):c||(c=setTimeout(j,a)),d}},Z.debounce=function(f,b,c){var d,a;return function(){var g=this,e=arguments,h=function(){d=null,c||(a=f.apply(g,e))},j=c&&!d;return clearTimeout(d),d=setTimeout(h,b),j&&(a=f.apply(g,e)),a}},Z.once=function(c){var a,b=!1;return function(){return b?a:(b=!0,a=c.apply(this,arguments),c=null,a)}},Z.wrap=function(b,a){return function(){var c=[b];return aw.apply(c,arguments),a.apply(this,c)}},Z.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--){b=[a[c].apply(this,b)]}return b[0]}},Z.after=function(b,a){return 0>=b?a():function(){return 1>--b?a.apply(this,arguments):void 0}},Z.keys=ax||function(c){if(c!==Object(c)){throw new TypeError("Invalid object")}var a=[];for(var b in c){Z.has(c,b)&&(a[a.length]=b)}return a},Z.values=function(c){var a=[];for(var b in c){Z.has(c,b)&&a.push(c[b])}return a},Z.pairs=function(c){var a=[];for(var b in c){Z.has(c,b)&&a.push([b,c[b]])}return a},Z.invert=function(c){var a={};for(var b in c){Z.has(c,b)&&(a[c[b]]=b)}return a},Z.functions=Z.methods=function(c){var a=[];for(var b in c){Z.isFunction(c[b])&&a.push(b)}return a.sort()},Z.extend=function(a){return W(ah.call(arguments,1),function(b){if(b){for(var c in b){a[c]=b[c]}}}),a},Z.pick=function(c){var a={},b=au.apply(ar,ah.call(arguments,1));return W(b,function(d){d in c&&(a[d]=c[d])}),a},Z.omit=function(d){var b={},c=au.apply(ar,ah.call(arguments,1));for(var a in d){Z.contains(c,a)||(b[a]=d[a])}return b},Z.defaults=function(a){return W(ah.call(arguments,1),function(b){if(b){for(var c in b){null==a[c]&&(a[c]=b[c])}}}),a},Z.clone=function(a){return Z.isObject(a)?Z.isArray(a)?a.slice():Z.extend({},a):a},Z.tap=function(b,a){return a(b),b};var L=function(g,q,b,k){if(g===q){return 0!==g||1/g==1/q}if(null==g||null==q){return g===q}g instanceof Z&&(g=g._wrapped),q instanceof Z&&(q=q._wrapped);var p=ak.call(g);if(p!=ak.call(q)){return !1}switch(p){case"[object String]":return g==q+"";case"[object Number]":return g!=+g?q!=+q:0==g?1/g==1/q:g==+q;case"[object Date]":case"[object Boolean]":return +g==+q;case"[object RegExp]":return g.source==q.source&&g.global==q.global&&g.multiline==q.multiline&&g.ignoreCase==q.ignoreCase}if("object"!=typeof g||"object"!=typeof q){return !1}for(var h=b.length;h--;){if(b[h]==g){return k[h]==q}}b.push(g),k.push(q);var m=0,d=!0;if("[object Array]"==p){if(m=g.length,d=m==q.length){for(;m--&&(d=L(g[m],q[m],b,k));){}}}else{var l=g.constructor,j=q.constructor;if(l!==j&&!(Z.isFunction(l)&&l instanceof l&&Z.isFunction(j)&&j instanceof j)){return !1}for(var v in g){if(Z.has(g,v)&&(m++,!(d=Z.has(q,v)&&L(g[v],q[v],b,k)))){break}}if(d){for(v in q){if(Z.has(q,v)&&!m--){break}}d=!m}}return b.pop(),k.pop(),d};Z.isEqual=function(b,a){return L(b,a,[],[])},Z.isEmpty=function(b){if(null==b){return !0}if(Z.isArray(b)||Z.isString(b)){return 0===b.length}for(var a in b){if(Z.has(b,a)){return !1}}return !0},Z.isElement=function(a){return !(!a||1!==a.nodeType)},Z.isArray=Y||function(a){return"[object Array]"==ak.call(a)},Z.isObject=function(a){return a===Object(a)},W(["Arguments","Function","String","Number","Date","RegExp"],function(a){Z["is"+a]=function(b){return ak.call(b)=="[object "+a+"]"}}),Z.isArguments(arguments)||(Z.isArguments=function(a){return !(!a||!Z.has(a,"callee"))}),"function"!=typeof/./&&(Z.isFunction=function(a){return"function"==typeof a}),Z.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},Z.isNaN=function(a){return Z.isNumber(a)&&a!=+a},Z.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==ak.call(a)},Z.isNull=function(a){return null===a},Z.isUndefined=function(a){return a===void 0},Z.has=function(b,a){return aq.call(b,a)},Z.noConflict=function(){return ai._=ac,this},Z.identity=function(a){return a},Z.times=function(f,b,c){for(var d=Array(f),a=0;f>a;a++){d[a]=b.call(c,a)}return d},Z.random=function(b,a){return null==a&&(a=b,b=0),b+Math.floor(Math.random()*(a-b+1))};var K={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};K.unescape=Z.invert(K.escape);var C={escape:RegExp("["+Z.keys(K.escape).join("")+"]","g"),unescape:RegExp("("+Z.keys(K.unescape).join("|")+")","g")};Z.each(["escape","unescape"],function(a){Z[a]=function(b){return null==b?"":(""+b).replace(C[a],function(c){return K[a][c]})}}),Z.result=function(c,a){if(null==c){return null}var b=c[a];return Z.isFunction(b)?b.call(c):b},Z.mixin=function(a){W(Z.functions(a),function(b){var c=Z[b]=a[b];Z.prototype[b]=function(){var d=[this._wrapped];return aw.apply(d,arguments),U.call(this,c.apply(Z,d))}})};var J=0;Z.uniqueId=function(b){var a=++J+"";return b?b+a:a},Z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,af={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},V=/\\|'|\r|\n|\t|\u2028|\u2029/g;Z.template=function(f,m,b){var h;b=Z.defaults({},b,Z.templateSettings);var l=RegExp([(b.escape||z).source,(b.interpolate||z).source,(b.evaluate||z).source].join("|")+"|$","g"),g=0,k="__p+='";f.replace(l,function(c,i,n,a,p){return k+=f.slice(g,p).replace(V,function(e){return"\\"+af[e]}),i&&(k+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(k+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),a&&(k+="';\n"+a+"\n__p+='"),g=p+c.length,c}),k+="';\n",b.variable||(k="with(obj||{}){\n"+k+"}\n"),k="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+k+"return __p;\n";try{h=Function(b.variable||"obj","_",k)}catch(d){throw d.source=k,d}if(m){return h(m,Z)}var j=function(a){return h.call(this,a,Z)};return j.source="function("+(b.variable||"obj")+"){\n"+k+"}",j},Z.chain=function(a){return Z(a).chain()};var U=function(a){return this._chain?Z(a).chain():a};Z.mixin(Z),W(["pop","push","reverse","shift","sort","splice","unshift"],function(b){var a=ar[b];Z.prototype[b]=function(){var c=this._wrapped;return a.apply(c,arguments),"shift"!=b&&"splice"!=b||0!==c.length||delete c[0],U.call(this,c)}}),W(["concat","join","slice"],function(b){var a=ar[b];Z.prototype[b]=function(){return U.call(this,a.apply(this._wrapped,arguments))}}),Z.extend(Z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);
(function(){var ac=this;var aq=ac.Backbone;var am=[];var ae=am.push;var ad=am.slice;var ah=am.splice;var av;if(typeof exports!=="undefined"){av=exports}else{av=ac.Backbone={}}av.VERSION="1.0.0";var an=ac._;if(!an&&typeof require!=="undefined"){an=require("underscore")}av.$=ac.jQuery||ac.Zepto||ac.ender||ac.$;av.noConflict=function(){ac.Backbone=aq;return this};av.emulateHTTP=false;av.emulateJSON=false;var ag=av.Events={on:function(b,d,a){if(!aj(this,"on",b,[d,a])||!d){return this}this._events||(this._events={});var c=this._events[b]||(this._events[b]=[]);c.push({callback:d,context:a,ctx:a||this});return this},once:function(b,f,a){if(!aj(this,"once",b,[f,a])||!f){return this}var d=this;var c=an.once(function(){d.off(b,c);f.apply(this,arguments)});c._callback=f;return this.on(b,c,a)},off:function(v,k,h){var b,w,g,m,d,p,l,j;if(!this._events||!aj(this,"off",v,[k,h])){return this}if(!v&&!k&&!h){this._events={};return this}m=v?[v]:an.keys(this._events);for(d=0,p=m.length;d<p;d++){v=m[d];if(g=this._events[v]){this._events[v]=b=[];if(k||h){for(l=0,j=g.length;l<j;l++){w=g[l];if(k&&k!==w.callback&&k!==w.callback._callback||h&&h!==w.context){b.push(w)}}}if(!b.length){delete this._events[v]}}}return this},trigger:function(b){if(!this._events){return this}var d=ad.call(arguments,1);if(!aj(this,"trigger",b,d)){return this}var a=this._events[b];var c=this._events.all;if(a){at(a,d)}if(c){at(c,arguments)}return this},stopListening:function(b,f,a){var d=this._listeners;if(!d){return this}var c=!f&&!a;if(typeof f==="object"){a=this}if(b){(d={})[b._listenerId]=b}for(var g in d){d[g].off(f,a,this);if(c){delete this._listeners[g]}}return this}};var ab=/\s+/;var aj=function(d,k,c,j){if(!c){return true}if(typeof c==="object"){for(var g in c){d[k].apply(d,[g,c[g]].concat(j))}return false}if(ab.test(c)){var l=c.split(ab);for(var b=0,f=l.length;b<f;b++){d[k].apply(d,[l[b]].concat(j))}return false}return true};var at=function(d,k){var c,j=-1,g=d.length,l=k[0],b=k[1],f=k[2];switch(k.length){case 0:while(++j<g){(c=d[j]).callback.call(c.ctx)}return;case 1:while(++j<g){(c=d[j]).callback.call(c.ctx,l)}return;case 2:while(++j<g){(c=d[j]).callback.call(c.ctx,l,b)}return;case 3:while(++j<g){(c=d[j]).callback.call(c.ctx,l,b,f)}return;default:while(++j<g){(c=d[j]).callback.apply(c.ctx,k)}}};var ap={listenTo:"on",listenToOnce:"once"};an.each(ap,function(a,b){ag[b]=function(g,c,f){var d=this._listeners||(this._listeners={});var h=g._listenerId||(g._listenerId=an.uniqueId("l"));d[h]=g;if(typeof c==="object"){f=this}g[a](c,f,this);return this}});ag.bind=ag.on;ag.unbind=ag.off;an.extend(av,ag);var ar=av.Model=function(b,d){var a;var c=b||{};d||(d={});this.cid=an.uniqueId("c");this.attributes={};an.extend(this,an.pick(d,af));if(d.parse){c=this.parse(c,d)||{}}if(a=an.result(this,"defaults")){c=an.defaults({},c,a)}this.set(c,d);this.changed={};this.initialize.apply(this,arguments)};var af=["url","urlRoot","collection"];an.extend(ar.prototype,ag,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return an.clone(this.attributes)},sync:function(){return av.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return an.escape(this.get(a))},has:function(a){return this.get(a)!=null},set:function(A,p,k){var b,C,h,x,g,y,j,w;if(A==null){return this}if(typeof A==="object"){C=A;k=p}else{(C={})[A]=p}k||(k={});if(!this._validate(C,k)){return false}h=k.unset;g=k.silent;x=[];y=this._changing;this._changing=true;if(!y){this._previousAttributes=an.clone(this.attributes);this.changed={}}w=this.attributes,j=this._previousAttributes;if(this.idAttribute in C){this.id=C[this.idAttribute]}for(b in C){p=C[b];if(!an.isEqual(w[b],p)){x.push(b)}if(!an.isEqual(j[b],p)){this.changed[b]=p}else{delete this.changed[b]}h?delete w[b]:w[b]=p}if(!g){if(x.length){this._pending=true}for(var m=0,v=x.length;m<v;m++){this.trigger("change:"+x[m],this,w[x[m]],k)}}if(y){return this}if(!g){while(this._pending){this._pending=false;this.trigger("change",this,k)}}this._pending=false;this._changing=false;return this},unset:function(a,b){return this.set(a,void 0,an.extend({},b,{unset:true}))},clear:function(b){var c={};for(var a in this.attributes){c[a]=void 0}return this.set(c,an.extend({},b,{unset:true}))},hasChanged:function(a){if(a==null){return !an.isEmpty(this.changed)}return an.has(this.changed,a)},changedAttributes:function(b){if(!b){return this.hasChanged()?an.clone(this.changed):false}var f,a=false;var d=this._changing?this._previousAttributes:this.attributes;for(var c in b){if(an.isEqual(d[c],f=b[c])){continue}(a||(a={}))[c]=f}return a},previous:function(a){if(a==null||!this._previousAttributes){return null}return this._previousAttributes[a]},previousAttributes:function(){return an.clone(this._previousAttributes)},fetch:function(b){b=b?an.clone(b):{};if(b.parse===void 0){b.parse=true}var c=this;var a=b.success;b.success=function(d){if(!c.set(c.parse(d,b),b)){return false}if(a){a(c,d,b)}c.trigger("sync",c,d,b)};D(this,b);return this.sync("read",this,b)},save:function(k,g,f){var b,l,d,h=this.attributes;if(k==null||typeof k==="object"){b=k;f=g}else{(b={})[k]=g}if(b&&(!f||!f.wait)&&!this.set(b,f)){return false}f=an.extend({validate:true},f);if(!this._validate(b,f)){return false}if(b&&f.wait){this.attributes=an.extend({},h,b)}if(f.parse===void 0){f.parse=true}var c=this;var j=f.success;f.success=function(a){c.attributes=h;var i=c.parse(a,f);if(f.wait){i=an.extend(b||{},i)}if(an.isObject(i)&&!c.set(i,f)){return false}if(j){j(c,a,f)}c.trigger("sync",c,a,f)};D(this,f);l=this.isNew()?"create":f.patch?"patch":"update";if(l==="patch"){f.attrs=b}d=this.sync(l,this,f);if(b&&f.wait){this.attributes=h}return d},destroy:function(b){b=b?an.clone(b):{};var f=this;var a=b.success;var d=function(){f.trigger("destroy",f,f.collection,b)};b.success=function(e){if(b.wait||f.isNew()){d()}if(a){a(f,e,b)}if(!f.isNew()){f.trigger("sync",f,e,b)}};if(this.isNew()){b.success();return false}D(this,b);var c=this.sync("delete",this,b);if(!b.wait){d()}return c},url:function(){var a=an.result(this,"urlRoot")||an.result(this.collection,"url")||q();if(this.isNew()){return a}return a+(a.charAt(a.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(a){return this._validate({},an.extend(a||{},{validate:true}))},_validate:function(b,c){if(!c.validate||!this.validate){return true}b=an.extend({},this.attributes,b);var a=this.validationError=this.validate(b,c)||null;if(!a){return true}this.trigger("invalid",this,a,an.extend(c||{},{validationError:a}));return false}});var aa=["keys","values","pairs","invert","pick","omit"];an.each(aa,function(a){ar.prototype[a]=function(){var b=ad.call(arguments);b.unshift(this.attributes);return an[a].apply(an,b)}});var ao=av.Collection=function(a,b){b||(b={});if(b.url){this.url=b.url}if(b.model){this.model=b.model}if(b.comparator!==void 0){this.comparator=b.comparator}this._reset();this.initialize.apply(this,arguments);if(a){this.reset(a,an.extend({silent:true},b))}};var ai={add:true,remove:true,merge:true};var X={add:true,merge:false,remove:false};an.extend(ao.prototype,ag,{model:ar,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return av.sync.apply(this,arguments)},add:function(a,b){return this.set(a,an.defaults(b||{},X))},remove:function(b,f){b=an.isArray(b)?b.slice():[b];f||(f={});var a,d,c,g;for(a=0,d=b.length;a<d;a++){g=this.get(b[a]);if(!g){continue}delete this._byId[g.id];delete this._byId[g.cid];c=this.indexOf(g);this.models.splice(c,1);this.length--;if(!f.silent){f.index=c;g.trigger("remove",g,this,f)}this._removeReference(g)}return this},set:function(E,r){r=an.defaults(r||{},ai);if(r.parse){E=this.parse(E,r)}if(!an.isArray(E)){E=E?[E]:[]}var k,H,y,h,C,j;var x=r.at;var n=this.comparator&&x==null&&r.sort!==false;var w=an.isString(this.comparator)?this.comparator:null;var b=[],A=[],m={};for(k=0,H=E.length;k<H;k++){if(!(y=this._prepareModel(E[k],r))){continue}if(C=this.get(y)){if(r.remove){m[C.cid]=true}if(r.merge){C.set(y.attributes,r);if(n&&!j&&C.hasChanged(w)){j=true}}}else{if(r.add){b.push(y);y.on("all",this._onModelEvent,this);this._byId[y.cid]=y;if(y.id!=null){this._byId[y.id]=y}}}}if(r.remove){for(k=0,H=this.length;k<H;++k){if(!m[(y=this.models[k]).cid]){A.push(y)}}if(A.length){this.remove(A,r)}}if(b.length){if(n){j=true}this.length+=b.length;if(x!=null){ah.apply(this.models,[x,0].concat(b))}else{ae.apply(this.models,b)}}if(j){this.sort({silent:true})}if(r.silent){return this}for(k=0,H=b.length;k<H;k++){(y=b[k]).trigger("add",y,this,r)}if(j){this.trigger("sort",this,r)}return this},reset:function(b,d){d||(d={});for(var a=0,c=this.models.length;a<c;a++){this._removeReference(this.models[a])}d.previousModels=this.models;this._reset();this.add(b,an.extend({silent:true},d));if(!d.silent){this.trigger("reset",this,d)}return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,an.extend({at:this.length},b));return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,an.extend({at:0},b));return a},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){if(a==null){return void 0}return this._byId[a.id!=null?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){if(an.isEmpty(a)){return b?void 0:[]}return this[b?"find":"filter"](function(d){for(var c in a){if(a[c]!==d.get(c)){return false}}return true})},findWhere:function(a){return this.where(a,true)},sort:function(a){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}a||(a={});if(an.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(an.bind(this.comparator,this))}if(!a.silent){this.trigger("sort",this,a)}return this},sortedIndex:function(b,d,a){d||(d=this.comparator);var c=an.isFunction(d)?d:function(e){return e.get(d)};return an.sortedIndex(this.models,b,c,a)},pluck:function(a){return an.invoke(this.models,"get",a)},fetch:function(b){b=b?an.clone(b):{};if(b.parse===void 0){b.parse=true}var c=b.success;var a=this;b.success=function(e){var d=b.reset?"reset":"set";a[d](e,b);if(c){c(a,e,b)}a.trigger("sync",a,e,b)};D(this,b);return this.sync("read",this,b)},create:function(b,d){d=d?an.clone(d):{};if(!(b=this._prepareModel(b,d))){return false}if(!d.wait){this.add(b,d)}var a=this;var c=d.success;d.success=function(e){if(d.wait){a.add(b,d)}if(c){c(b,e,d)}};b.save(null,d);return b},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(b,c){if(b instanceof ar){if(!b.collection){b.collection=this}return b}c||(c={});c.collection=this;var a=new this.model(b,c);if(!a._validate(b,c)){this.trigger("invalid",this,b,c);return false}return a},_removeReference:function(a){if(this===a.collection){delete a.collection}a.off("all",this._onModelEvent,this)},_onModelEvent:function(b,d,a,c){if((b==="add"||b==="remove")&&a!==this){return}if(b==="destroy"){this.remove(d,c)}if(d&&b==="change:"+d.idAttribute){delete this._byId[d.previous(d.idAttribute)];if(d.id!=null){this._byId[d.id]=d}}this.trigger.apply(this,arguments)}});var aw=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];an.each(aw,function(a){ao.prototype[a]=function(){var b=ad.call(arguments);b.unshift(this.models);return an[a].apply(an,b)}});var Z=["groupBy","countBy","sortBy"];an.each(Z,function(a){ao.prototype[a]=function(d,b){var c=an.isFunction(d)?d:function(e){return e.get(d)};return an[a](this.models,c,b)}});var au=av.View=function(a){this.cid=an.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var Y=/^(\S+)\s*(.*)$/;var M=["model","collection","el","id","attributes","className","tagName","events"];an.extend(au.prototype,ag,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,b){if(this.$el){this.undelegateEvents()}this.$el=a instanceof av.$?a:av.$(a);this.el=this.$el[0];if(b!==false){this.delegateEvents()}return this},delegateEvents:function(b){if(!(b||(b=an.result(this,"events")))){return this}this.undelegateEvents();for(var f in b){var a=b[f];if(!an.isFunction(a)){a=this[b[f]]}if(!a){continue}var d=f.match(Y);var c=d[1],g=d[2];a=an.bind(a,this);c+=".delegateEvents"+this.cid;if(g===""){this.$el.on(c,a)}else{this.$el.on(c,g,a)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(a){if(this.options){a=an.extend({},an.result(this,"options"),a)}an.extend(this,an.pick(a,M));this.options=a},_ensureElement:function(){if(!this.el){var a=an.extend({},an.result(this,"attributes"));if(this.id){a.id=an.result(this,"id")}if(this.className){a["class"]=an.result(this,"className")}var b=av.$("<"+an.result(this,"tagName")+">").attr(a);this.setElement(b,false)}else{this.setElement(an.result(this,"el"),false)}}});av.sync=function(b,f,a){var d=ak[b];an.defaults(a||(a={}),{emulateHTTP:av.emulateHTTP,emulateJSON:av.emulateJSON});var c={type:d,dataType:"json"};if(!a.url){c.url=an.result(f,"url")||q()}if(a.data==null&&f&&(b==="create"||b==="update"||b==="patch")){c.contentType="application/json";c.data=JSON.stringify(a.attrs||f.toJSON(a))}if(a.emulateJSON){c.contentType="application/x-www-form-urlencoded";c.data=c.data?{model:c.data}:{}}if(a.emulateHTTP&&(d==="PUT"||d==="DELETE"||d==="PATCH")){c.type="POST";if(a.emulateJSON){c.data._method=d}var h=a.beforeSend;a.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",d);if(h){return h.apply(this,arguments)}}}if(c.type!=="GET"&&!a.emulateJSON){c.processData=false}if(c.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){c.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var g=a.xhr=av.ajax(an.extend(c,a));f.trigger("request",f,g,a);return g};var ak={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};av.ajax=function(){return av.$.ajax.apply(av.$,arguments)};var B=av.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var W=/\((.*?)\)/g;var z=/(\(\?)?:\w+/g;var L=/\*\w+/g;var V=/[\-{}\[\]+?.,\\\^$|#\s]/g;an.extend(B.prototype,ag,{initialize:function(){},route:function(b,d,a){if(!an.isRegExp(b)){b=this._routeToRegExp(b)}if(an.isFunction(d)){a=d;d=""}if(!a){a=this[d]}var c=this;av.history.route(b,function(e){var f=c._extractParameters(b,e);a&&a.apply(c,f);c.trigger.apply(c,["route:"+d].concat(f));c.trigger("route",d,f);av.history.trigger("route",c,d,f)});return this},navigate:function(a,b){av.history.navigate(a,b);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=an.result(this,"routes");var a,b=an.keys(this.routes);while((a=b.pop())!=null){this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(V,"\\$&").replace(W,"(?:$1)?").replace(z,function(b,c){return c?b:"([^/]+)"}).replace(L,"(.*?)");return new RegExp("^"+a+"$")},_extractParameters:function(b,c){var a=b.exec(c).slice(1);return an.map(a,function(d){return d?decodeURIComponent(d):null})}});var K=av.History=function(){this.handlers=[];an.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var J=/^[#\/]|\s+$/g;var F=/^\/+|\/+$/g;var G=/msie [\w.]+/;var Q=/\/$/;K.started=false;an.extend(K.prototype,ag,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(b,c){if(b==null){if(this._hasPushState||!this._wantsHashChange||c){b=this.location.pathname;var a=this.root.replace(Q,"");if(!b.indexOf(a)){b=b.substr(a.length)}}else{b=this.getHash()}}return b.replace(J,"")},start:function(b){if(K.started){throw new Error("Backbone.history has already been started")}K.started=true;this.options=an.extend({},{root:"/"},this.options,b);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var f=this.getFragment();var a=document.documentMode;var d=G.exec(navigator.userAgent.toLowerCase())&&(!a||a<=7);this.root=("/"+this.root+"/").replace(F,"/");if(d&&this._wantsHashChange){this.iframe=av.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(f)}if(this._hasPushState){av.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&"onhashchange" in window&&!d){av.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=f;var c=this.location;var g=c.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&g&&c.hash){this.fragment=this.getHash().replace(J,"");this.history.replaceState({},document.title,this.root+this.fragment+c.search)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){av.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);K.started=false},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();if(b===this.fragment&&this.iframe){b=this.getFragment(this.getHash(this.iframe))}if(b===this.fragment){return false}if(this.iframe){this.navigate(b)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(b){var c=this.fragment=this.getFragment(b);var a=an.any(this.handlers,function(d){if(d.route.test(c)){d.callback(c);return true}});return a},navigate:function(b,c){if(!K.started){return false}if(!c||c===true){c={trigger:c}}b=this.getFragment(b||"");if(this.fragment===b){return}this.fragment=b;var a=this.root+b;if(this._hasPushState){this.history[c.replace?"replaceState":"pushState"]({},document.title,a)}else{if(this._wantsHashChange){this._updateHash(this.location,b,c.replace);if(this.iframe&&b!==this.getFragment(this.getHash(this.iframe))){if(!c.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,b,c.replace)}}else{return this.location.assign(a)}}if(c.trigger){this.loadUrl(b)}},_updateHash:function(b,d,a){if(a){var c=b.href.replace(/(javascript:|#).*$/,"");b.replace(c+"#"+d)}else{b.hash="#"+d}}});av.history=new K;var al=function(b,f){var a=this;var d;if(b&&an.has(b,"constructor")){d=b.constructor}else{d=function(){return a.apply(this,arguments)}}an.extend(d,a,f);var c=function(){this.constructor=d};c.prototype=a.prototype;d.prototype=new c;if(b){an.extend(d.prototype,b)}d.__super__=a.prototype;return d};ar.extend=ao.extend=B.extend=au.extend=K.extend=al;var q=function(){throw new Error('A "url" property or function must be specified')};var D=function(b,c){var a=c.error;c.error=function(d){if(a){a(b,d,c)}b.trigger("error",b,d,c)}}}).call(this);
(function(d,c){typeof exports=="object"&&d.require?module.exports=c(require("underscore"),require("backbone")):typeof define=="function"&&define.amd?define(["underscore","backbone"],function(b,a){return c(b||d._,a||d.Backbone)}):c(_,Backbone)})(this,function(f,e){function h(){return((1+Math.random())*65536|0).toString(16).substring(1)}function g(){return h()+h()+"-"+h()+"-"+h()+"-"+h()+"-"+h()+h()+h()}return e.LocalStorage=window.Store=function(d){if(!this.localStorage){throw"Backbone.localStorage: Environment does not support localStorage."}this.name=d;var c=this.localStorage().getItem(this.name);this.records=c&&c.split(",")||[]},f.extend(e.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(b){return b.id||(b.id=g(),b.set(b.idAttribute,b.id)),this.localStorage().setItem(this.name+"-"+b.id,JSON.stringify(b)),this.records.push(b.id.toString()),this.save(),this.find(b)},update:function(a){return this.localStorage().setItem(this.name+"-"+a.id,JSON.stringify(a)),f.include(this.records,a.id.toString())||this.records.push(a.id.toString()),this.save(),this.find(a)},find:function(b){return this.jsonData(this.localStorage().getItem(this.name+"-"+b.id))},findAll:function(){return(f.chain||f)(this.records).map(function(b){return this.jsonData(this.localStorage().getItem(this.name+"-"+b))},this).compact().value()},destroy:function(a){return a.isNew()?!1:(this.localStorage().removeItem(this.name+"-"+a.id),this.records=f.reject(this.records,function(b){return b===a.id.toString()}),this.save(),a)},localStorage:function(){return localStorage},jsonData:function(b){return b&&JSON.parse(b)},_clear:function(){var a=this.localStorage(),d=new RegExp("^"+this.name+"-");a.removeItem(this.name),(f.chain||f)(a).keys().filter(function(b){return d.test(b)}).each(function(b){a.removeItem(b)}),this.records.length=0},_storageSize:function(){return this.localStorage().length}}),e.LocalStorage.sync=window.Store.sync=e.localSync=function(b,p,o){var n=p.localStorage||p.collection.localStorage,m,l,k=e.$.Deferred&&e.$.Deferred();try{switch(b){case"read":m=p.id!=undefined?n.find(p):n.findAll();break;case"create":m=n.create(p);break;case"update":m=n.update(p);break;case"delete":m=n.destroy(p)}}catch(j){j.code===22&&n._storageSize()===0?l="Private browsing is unsupported":l=j.message}return m?(o&&o.success&&(e.VERSION==="0.9.10"?o.success(p,m,o):o.success(m)),k&&k.resolve(m)):(l=l?l:"Record Not Found",o&&o.error&&(e.VERSION==="0.9.10"?o.error(p,l,o):o.error(l)),k&&k.reject(l)),o&&o.complete&&o.complete(m),k&&k.promise()},e.ajaxSync=e.sync,e.getSyncMethod=function(b){return b.localStorage||b.collection&&b.collection.localStorage?e.localSync:e.ajaxSync},e.sync=function(b,j,i){return e.getSyncMethod(j).apply(this,[b,j,i])},e.LocalStorage});
/*!
 * Draggabilly PACKAGED v1.0.7
 * Make that shiz draggable
 * http://draggabilly.desandro.com
 */
(function(b){function f(e){return RegExp("(^|\\s+)"+e+"(\\s+|$)")}function h(i,j){var k=a(i,j)?d:g;k(i,j)}var a,g,d;"classList" in document.documentElement?(a=function(i,j){return i.classList.contains(j)},g=function(i,j){i.classList.add(j)},d=function(i,j){i.classList.remove(j)}):(a=function(e,i){return f(i).test(e.className)},g=function(i,j){a(i,j)||(i.className=i.className+" "+j)},d=function(e,i){e.className=e.className.replace(f(i)," ")});var c={hasClass:a,addClass:g,removeClass:d,toggleClass:h,has:a,add:g,remove:d,toggle:h};"function"==typeof define&&define.amd?define("classie/classie",c):b.classie=c})(window),function(){function b(){}function c(f,g){for(var h=f.length;h--;){if(f[h].listener===g){return h}}return -1}function d(e){return function(){return this[e].apply(this,arguments)}}var a=b.prototype;a.getListeners=function(g){var h,j,f=this._getEvents();if("object"==typeof g){h={};for(j in f){f.hasOwnProperty(j)&&g.test(j)&&(h[j]=f[j])}}else{h=f[g]||(f[g]=[])}return h},a.flattenListeners=function(f){var g,h=[];for(g=0;f.length>g;g+=1){h.push(f[g].listener)}return h},a.getListenersAsObject=function(f){var g,h=this.getListeners(f);return h instanceof Array&&(g={},g[f]=h),g||h},a.addListener=function(f,j){var e,h=this.getListenersAsObject(f),g="object"==typeof j;for(e in h){h.hasOwnProperty(e)&&-1===c(h[e],j)&&h[e].push(g?j:{listener:j,once:!1})}return this},a.on=d("addListener"),a.addOnceListener=function(f,g){return this.addListener(f,{listener:g,once:!0})},a.once=d("addOnceListener"),a.defineEvent=function(e){return this.getListeners(e),this},a.defineEvents=function(f){for(var g=0;f.length>g;g+=1){this.defineEvent(f[g])}return this},a.removeListener=function(f,j){var e,h,g=this.getListenersAsObject(f);for(h in g){g.hasOwnProperty(h)&&(e=c(g[h],j),-1!==e&&g[h].splice(e,1))}return this},a.off=d("removeListener"),a.addListeners=function(f,g){return this.manipulateListeners(!1,f,g)},a.removeListeners=function(f,g){return this.manipulateListeners(!0,f,g)},a.manipulateListeners=function(g,k,m){var f,l,j=g?this.removeListener:this.addListener,h=g?this.removeListeners:this.addListeners;if("object"!=typeof k||k instanceof RegExp){for(f=m.length;f--;){j.call(this,k,m[f])}}else{for(f in k){k.hasOwnProperty(f)&&(l=k[f])&&("function"==typeof l?j.call(this,f,l):h.call(this,f,l))}}return this},a.removeEvent=function(g){var h,j=typeof g,f=this._getEvents();if("string"===j){delete f[g]}else{if("object"===j){for(h in f){f.hasOwnProperty(h)&&g.test(h)&&delete f[h]}}else{delete this._events}}return this},a.removeAllListeners=d("removeEvent"),a.emitEvent=function(g,k){var m,f,l,j,h=this.getListenersAsObject(g);for(l in h){if(h.hasOwnProperty(l)){for(f=h[l].length;f--;){m=h[l][f],m.once===!0&&this.removeListener(g,m.listener),j=m.listener.apply(this,k||[]),j===this._getOnceReturnValue()&&this.removeListener(g,m.listener)}}}return this},a.trigger=d("emitEvent"),a.emit=function(f){var g=Array.prototype.slice.call(arguments,1);return this.emitEvent(f,g)},a.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},a._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},a._getEvents=function(){return this._events||(this._events={})},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return b}):"object"==typeof module&&module.exports?module.exports=b:this.EventEmitter=b}.call(this),function(b){var c=document.documentElement,f=function(){};c.addEventListener?f=function(g,h,i){g.addEventListener(h,i,!1)}:c.attachEvent&&(f=function(h,j,g){h[j+g]=g.handleEvent?function(){var i=b.event;i.target=i.target||i.srcElement,g.handleEvent.call(g,i)}:function(){var e=b.event;e.target=e.target||e.srcElement,g.call(h,e)},h.attachEvent("on"+j,h[j+g])});var a=function(){};c.removeEventListener?a=function(g,h,i){g.removeEventListener(h,i,!1)}:c.detachEvent&&(a=function(h,j,k){h.detachEvent("on"+j,h[j+k]);try{delete h[j+k]}catch(g){h[j+k]=void 0}});var d={bind:f,unbind:a};"function"==typeof define&&define.amd?define("eventie/eventie",d):b.eventie=d}(this),function(b){function c(f){if(f){if("string"==typeof a[f]){return f}f=f.charAt(0).toUpperCase()+f.slice(1);for(var h,i=0,g=d.length;g>i;i++){if(h=d[i]+f,"string"==typeof a[h]){return h}}}}var d="Webkit Moz ms Ms O".split(" "),a=document.documentElement.style;"function"==typeof define&&define.amd?define("get-style-property/get-style-property",[],function(){return c}):b.getStyleProperty=c}(window),function(d){function h(a){var i=parseFloat(a),l=-1===a.indexOf("%")&&!isNaN(i);return l&&i}function k(){for(var l={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},m=0,o=b.length;o>m;m++){var a=b[m];l[a]=0}return l}function c(e){function a(F){if("string"==typeof F&&(F=document.querySelector(F)),F&&"object"==typeof F&&F.nodeType){var K=f(F);if("none"===K.display){return k()}var G={};G.width=F.offsetWidth,G.height=F.offsetHeight;for(var C=G.isBorderBox=!(!m||!K[m]||"border-box"!==K[m]),N=0,O=b.length;O>N;N++){var H=b[N],J=K[H];J=n(F,J);var M=parseFloat(J);G[H]=isNaN(M)?0:M}var B=G.paddingLeft+G.paddingRight,I=G.paddingTop+G.paddingBottom,s=G.marginLeft+G.marginRight,D=G.marginTop+G.marginBottom,z=G.borderLeftWidth+G.borderRightWidth,Q=G.borderTopWidth+G.borderBottomWidth,q=C&&l,o=h(K.width);o!==!1&&(G.width=o+(q?0:B+z));var A=h(K.height);return A!==!1&&(G.height=A+(q?0:I+Q)),G.innerWidth=G.width-(B+z),G.innerHeight=G.height-(I+Q),G.outerWidth=G.width+s,G.outerHeight=G.height+D,G}}function n(q,u){if(g||-1===u.indexOf("%")){return u}var w=q.style,p=w.left,v=q.runtimeStyle,r=v&&v.left;return r&&(v.left=q.currentStyle.left),w.left=u,u=w.pixelLeft,w.left=p,r&&(v.left=r),u}var l,m=e("boxSizing");return function(){if(m){var p=document.createElement("div");p.style.width="200px",p.style.padding="1px 2px 3px 4px",p.style.borderStyle="solid",p.style.borderWidth="1px 2px 3px 4px",p.style[m]="border-box";var q=document.body||document.documentElement;q.appendChild(p);var o=f(p);l=200===h(o.width),q.removeChild(p)}}(),a}var j=document.defaultView,g=j&&j.getComputedStyle,f=g?function(a){return j.getComputedStyle(a,null)}:function(a){return a.currentStyle},b=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];"function"==typeof define&&define.amd?define("get-size/get-size",["get-style-property/get-style-property"],c):d.getSize=c(d.getStyleProperty)}(window),function(A){function v(a,c){for(var d in c){a[d]=c[d]}return a}function k(){}function l(n,e,I,t,G){function C(c,d){this.element=c,this.options=v({},this.options),v(this.options,d),this._create()}function a(){return !1}function h(c,d){c.x=void 0!==d.pageX?d.pageX:d.clientX,c.y=void 0!==d.pageY?d.pageY:d.clientY}var r=t("transform"),F=!!t("perspective");v(C.prototype,e.prototype),C.prototype.options={},C.prototype._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=v({},this.position);var c=y(this.element);"relative"!==c.position&&"absolute"!==c.position&&(this.element.style.position="relative"),this.enable(),this.setHandles()},C.prototype.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element];for(var c=0,d=this.handles.length;d>c;c++){var i=this.handles[c];I.bind(i,"mousedown",this),I.bind(i,"touchstart",this),D(i)}};var f="attachEvent" in b.documentElement,D=f?function(d){"IMG"===d.nodeName&&(d.ondragstart=a);for(var p=d.querySelectorAll("img"),u=0,c=p.length;c>u;u++){var s=p[u];s.ondragstart=a}}:k;C.prototype._getPosition=function(){var c=y(this.element),d=parseInt(c.left,10),i=parseInt(c.top,10);this.position.x=isNaN(d)?0:d,this.position.y=isNaN(i)?0:i,this._addTransformPosition(c)},C.prototype._addTransformPosition=function(d){if(r){var s=d[r];if(0===s.indexOf("matrix")){var E=s.split(","),c=0===s.indexOf("matrix3d")?12:4,u=parseInt(E[c],10),p=parseInt(E[c+1],10);this.position.x+=u,this.position.y+=p}}},C.prototype.handleEvent=function(c){var d="on"+c.type;this[d]&&this[d](c)},C.prototype.getTouch=function(d){for(var o=0,p=d.length;p>o;o++){var c=d[o];if(c.identifier===this.pointerIdentifier){return c}}},C.prototype.onmousedown=function(c){var d=c.button;d&&0!==d&&1!==d||this.dragStart(c,c)},C.prototype.ontouchstart=function(c){this.isDragging||this.dragStart(c,c.changedTouches[0])},C.prototype.dragStart=function(c,i){if(this.isEnabled){c.preventDefault?c.preventDefault():c.returnValue=!1;var d="touchstart"===c.type;this.pointerIdentifier=i.identifier,this._getPosition(),this.measureContainment(),h(this.startPoint,i),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this._bindEvents({events:d?["touchmove","touchend","touchcancel"]:["mousemove","mouseup"],node:c.preventDefault?A:b}),n.add(this.element,"is-dragging"),this.isDragging=!0,this.emitEvent("dragStart",[this,c,i]),this.animate()}},C.prototype._bindEvents=function(d){for(var o=0,p=d.events.length;p>o;o++){var c=d.events[o];I.bind(d.node,c,this)}this._boundEvents=d},C.prototype._unbindEvents=function(){var d=this._boundEvents;if(d&&d.events){for(var o=0,p=d.events.length;p>o;o++){var c=d.events[o];I.unbind(d.node,c,this)}delete this._boundEvents}},C.prototype.measureContainment=function(){var d=this.options.containment;if(d){this.size=G(this.element);var o=this.element.getBoundingClientRect(),p=m(d)?d:"string"==typeof d?b.querySelector(d):this.element.parentNode;this.containerSize=G(p);var c=p.getBoundingClientRect();this.relativeStartPosition={x:o.left-c.left,y:o.top-c.top}}},C.prototype.onmousemove=function(c){this.dragMove(c,c)},C.prototype.ontouchmove=function(c){var d=this.getTouch(c.changedTouches);d&&this.dragMove(c,d)},C.prototype.dragMove=function(d,o){if(h(this.dragPoint,o),this.dragPoint.x-=this.startPoint.x,this.dragPoint.y-=this.startPoint.y,this.options.containment){var p=this.relativeStartPosition.x,c=this.relativeStartPosition.y;this.dragPoint.x=Math.max(this.dragPoint.x,-p),this.dragPoint.y=Math.max(this.dragPoint.y,-c),this.dragPoint.x=Math.min(this.dragPoint.x,this.containerSize.width-p-this.size.width),this.dragPoint.y=Math.min(this.dragPoint.y,this.containerSize.height-c-this.size.height)}this.position.x=this.startPosition.x+this.dragPoint.x,this.position.y=this.startPosition.y+this.dragPoint.y,this.emitEvent("dragMove",[this,d,o])},C.prototype.onmouseup=function(c){this.dragEnd(c,c)},C.prototype.ontouchend=function(c){var d=this.getTouch(c.changedTouches);d&&this.dragEnd(c,d)},C.prototype.dragEnd=function(c,d){this.isDragging=!1,delete this.pointerIdentifier,r&&(this.element.style[r]="",this.setLeftTop()),this._unbindEvents(),n.remove(this.element,"is-dragging"),this.emitEvent("dragEnd",[this,c,d])},C.prototype.ontouchcancel=function(c){var d=this.getTouch(c.changedTouches);this.dragEnd(c,d)},C.prototype.animate=function(){if(this.isDragging){this.positionDrag();var c=this;q(function(){c.animate()})}};var H=F?function(c,d){return"translate3d( "+c+"px, "+d+"px, 0)"}:function(c,d){return"translate( "+c+"px, "+d+"px)"};return C.prototype.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},C.prototype.positionDrag=r?function(){this.element.style[r]=H(this.dragPoint.x,this.dragPoint.y)}:C.prototype.setLeftTop,C.prototype.enable=function(){this.isEnabled=!0},C.prototype.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},C}for(var j,b=A.document,B=b.defaultView,y=B&&B.getComputedStyle?function(a){return B.getComputedStyle(a,null)}:function(a){return a.currentStyle},m="object"==typeof HTMLElement?function(a){return a instanceof HTMLElement}:function(a){return a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName},w=0,z="webkit moz ms o".split(" "),q=A.requestAnimationFrame,x=A.cancelAnimationFrame,g=0;z.length>g&&(!q||!x);g++){j=z[g],q=q||A[j+"RequestAnimationFrame"],x=x||A[j+"CancelAnimationFrame"]||A[j+"CancelRequestAnimationFrame"]}q&&x||(q=function(c){var f=(new Date).getTime(),a=Math.max(0,16-(f-w)),d=A.setTimeout(function(){c(f+a)},a);return w=f+a,d},x=function(a){A.clearTimeout(a)}),"function"==typeof define&&define.amd?define(["classie/classie","eventEmitter/EventEmitter","eventie/eventie","get-style-property/get-style-property","get-size/get-size"],l):A.Draggabilly=l(A.classie,A.EventEmitter,A.eventie,A.getStyleProperty,A.getSize)}(window);
/*! IndexedDBShim - v0.1.2 - 2014-01-07 */
var idbModules={};!function(g){function f(k,e,m,l){m.target=e,"function"==typeof e[k]&&e[k].apply(e,[m]),"function"==typeof l&&l()}function j(a,m,l){var k=new DOMException.constructor(0,m);throw k.name=a,k.message=m,g.DEBUG&&(console.log(a,m,l,k),console.trace&&console.trace()),k}var i=function(){this.length=0,this._items=[],Object.defineProperty&&Object.defineProperty(this,"_items",{enumerable:!1})};if(i.prototype={contains:function(b){return -1!==this._items.indexOf(b)},item:function(b){return this._items[b]},indexOf:function(b){return this._items.indexOf(b)},push:function(d){this._items.push(d),this.length+=1;for(var c=0;c<this._items.length;c++){this[c]=this._items[c]}},splice:function(){this._items.splice.apply(this._items,arguments),this.length=this._items.length;for(var b in this){b===String(parseInt(b,10))&&delete this[b]}for(b=0;b<this._items.length;b++){this[b]=this._items[b]}}},Object.defineProperty){for(var h in {indexOf:!1,push:!1,splice:!1}){Object.defineProperty(i.prototype,h,{enumerable:!1})}}g.util={throwDOMException:j,callback:f,quote:function(b){return"'"+b+"'"},StringList:i}}(idbModules),function(idbModules){var Sca=function(){return{decycle:function(object,callback){function checkForCompletion(){0===queuedObjects.length&&returnCallback(derezObj)}function readBlobAsDataURL(a,b){var c=new FileReader;c.onloadend=function(a){var c=a.target.result,d="blob";updateEncodedBlob(c,b,d)},c.readAsDataURL(a)}function updateEncodedBlob(dataURL,path,blobtype){var encoded=queuedObjects.indexOf(path);path=path.replace("$","derezObj"),eval(path+'.$enc="'+dataURL+'"'),eval(path+'.$type="'+blobtype+'"'),queuedObjects.splice(encoded,1),checkForCompletion()}function derez(a,b){var c,d,e;if(!("object"!=typeof a||null===a||a instanceof Boolean||a instanceof Date||a instanceof Number||a instanceof RegExp||a instanceof Blob||a instanceof String)){for(c=0;c<objects.length;c+=1){if(objects[c]===a){return{$ref:paths[c]}}}if(objects.push(a),paths.push(b),"[object Array]"===Object.prototype.toString.apply(a)){for(e=[],c=0;c<a.length;c+=1){e[c]=derez(a[c],b+"["+c+"]")}}else{e={};for(d in a){Object.prototype.hasOwnProperty.call(a,d)&&(e[d]=derez(a[d],b+"["+JSON.stringify(d)+"]"))}}return e}return a instanceof Blob?(queuedObjects.push(b),readBlobAsDataURL(a,b)):a instanceof Boolean?a={$type:"bool",$enc:a.toString()}:a instanceof Date?a={$type:"date",$enc:a.getTime()}:a instanceof Number?a={$type:"num",$enc:a.toString()}:a instanceof RegExp&&(a={$type:"regex",$enc:a.toString()}),a}var objects=[],paths=[],queuedObjects=[],returnCallback=callback,derezObj=derez(object,"$");checkForCompletion()},retrocycle:function retrocycle($){function dataURLToBlob(a){var b,c,d,e=";base64,";if(-1===a.indexOf(e)){return c=a.split(","),b=c[0].split(":")[1],d=c[1],new Blob([d],{type:b})}c=a.split(e),b=c[0].split(":")[1],d=window.atob(c[1]);for(var f=d.length,g=new Uint8Array(f),h=0;f>h;++h){g[h]=d.charCodeAt(h)}return new Blob([g.buffer],{type:b})}function rez(value){var i,item,name,path;if(value&&"object"==typeof value){if("[object Array]"===Object.prototype.toString.apply(value)){for(i=0;i<value.length;i+=1){item=value[i],item&&"object"==typeof item&&(path=item.$ref,value[i]="string"==typeof path&&px.test(path)?eval(path):rez(item))}}else{if(void 0!==value.$type){switch(value.$type){case"blob":case"file":value=dataURLToBlob(value.$enc);break;case"bool":value=Boolean("true"===value.$enc);break;case"date":value=new Date(value.$enc);break;case"num":value=Number(value.$enc);break;case"regex":value=eval(value.$enc)}}else{for(name in value){"object"==typeof value[name]&&(item=value[name],item&&(path=item.$ref,value[name]="string"==typeof path&&px.test(path)?eval(path):rez(item)))}}}}return value}var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return rez($),$},encode:function(a,b){function c(a){b(JSON.stringify(a))}this.decycle(a,c)},decode:function(a){return this.retrocycle(JSON.parse(a))}}}();idbModules.Sca=Sca}(idbModules),function(g){var f=["","number","string","boolean","object","undefined"],j=function(){return{encode:function(b){return f.indexOf(typeof b)+"-"+JSON.stringify(b)},decode:function(b){return"undefined"==typeof b?void 0:JSON.parse(b.substring(2))}}},i={number:j("number"),"boolean":j(),object:j(),string:{encode:function(b){return f.indexOf("string")+"-"+b},decode:function(b){return""+b.substring(2)}},undefined:{encode:function(){return f.indexOf("undefined")+"-undefined"},decode:function(){return void 0}}},h=function(){return{encode:function(b){return i[typeof b].encode(b)},decode:function(b){return i[f[b.substring(0,1)]].decode(b)}}}();g.Key=h}(idbModules),function(d){var c=function(f,e){return{type:f,debug:e,bubbles:!1,cancelable:!1,eventPhase:0,timeStamp:new Date}};d.Event=c}(idbModules),function(e){var d=function(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null,this.readyState="pending"},f=function(){this.onblocked=this.onupgradeneeded=null};f.prototype=d,e.IDBRequest=d,e.IDBOpenRequest=f}(idbModules),function(e,d){var f=function(h,g,j,i){this.lower=h,this.upper=g,this.lowerOpen=j,this.upperOpen=i};f.only=function(b){return new f(b,b,!1,!1)},f.lowerBound=function(b,c){return new f(b,d,c,d)},f.upperBound=function(b){return new f(d,b,d,open)},f.bound=function(g,c,i,h){return new f(g,c,i,h)},e.IDBKeyRange=f}(idbModules),function(e,d){function f(l,k,j,i,b,a){this.__range=l,this.source=this.__idbObjectStore=j,this.__req=i,this.key=d,this.direction=k,this.__keyColumnName=b,this.__valueColumnName=a,this.source.transaction.__active||e.util.throwDOMException("TransactionInactiveError - The transaction this IDBObjectStore belongs to is not active."),this.__offset=-1,this.__lastKeyContinued=d,this["continue"]()}f.prototype.__find=function(n,m,l,k){var j=this,b=["SELECT * FROM ",e.util.quote(j.__idbObjectStore.name)],a=[];b.push("WHERE ",j.__keyColumnName," NOT NULL"),j.__range&&(j.__range.lower||j.__range.upper)&&(b.push("AND"),j.__range.lower&&(b.push(j.__keyColumnName+(j.__range.lowerOpen?" >":" >= ")+" ?"),a.push(e.Key.encode(j.__range.lower))),j.__range.lower&&j.__range.upper&&b.push("AND"),j.__range.upper&&(b.push(j.__keyColumnName+(j.__range.upperOpen?" < ":" <= ")+" ?"),a.push(e.Key.encode(j.__range.upper)))),"undefined"!=typeof n&&(j.__lastKeyContinued=n,j.__offset=0),j.__lastKeyContinued!==d&&(b.push("AND "+j.__keyColumnName+" >= ?"),a.push(e.Key.encode(j.__lastKeyContinued))),b.push("ORDER BY ",j.__keyColumnName),b.push("LIMIT 1 OFFSET "+j.__offset),e.DEBUG&&console.log(b.join(" "),a),m.executeSql(b.join(" "),a,function(p,o){if(1===o.rows.length){var i=e.Key.decode(o.rows.item(0)[j.__keyColumnName]),g="value"===j.__valueColumnName?e.Sca.decode(o.rows.item(0)[j.__valueColumnName]):e.Key.decode(o.rows.item(0)[j.__valueColumnName]);l(i,g)}else{e.DEBUG&&console.log("Reached end of cursors"),l(d,d)}},function(g,h){e.DEBUG&&console.log("Could not execute Cursor.continue"),k(h)})},f.prototype["continue"]=function(b){var g=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(i,h,c,a){g.__offset++,g.__find(b,i,function(j,k){g.key=j,g.value=k,c("undefined"!=typeof g.key?g:d,g.__req)},function(j){a(j)})})},f.prototype.advance=function(b){0>=b&&e.util.throwDOMException("Type Error - Count is invalid - 0 or negative",b);var a=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(c,j,i,h){a.__offset+=b,a.__find(d,c,function(g,k){a.key=g,a.value=k,i("undefined"!=typeof a.key?a:d,a.__req)},function(g){h(g)})})},f.prototype.update=function(g){var b=this,a=this.__idbObjectStore.transaction.__createRequest(function(){});return e.Sca.encode(g,function(h){b.__idbObjectStore.transaction.__pushToQueue(a,function(k,j,i,c){b.__find(d,k,function(l){var m="UPDATE "+e.util.quote(b.__idbObjectStore.name)+" SET value = ? WHERE key = ?";e.DEBUG&&console.log(m,h,l),k.executeSql(m,[h,e.Key.encode(l)],function(n,o){1===o.rowsAffected?i(l):c("No rows with key found"+l)},function(o,n){c(n)})},function(l){c(l)})})}),a},f.prototype["delete"]=function(){var a=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(i,h,c,b){a.__find(d,i,function(j){var g="DELETE FROM  "+e.util.quote(a.__idbObjectStore.name)+" WHERE key = ?";e.DEBUG&&console.log(g,j),i.executeSql(g,[e.Key.encode(j)],function(k,l){1===l.rowsAffected?(a.__offset--,c(d)):b("No rows with key found"+j)},function(l,k){b(k)})},function(g){b(g)})})},e.IDBCursor=f}(idbModules),function(idbModules,undefined){function IDBIndex(a,b){this.indexName=this.name=a,this.__idbObjectStore=this.objectStore=this.source=b;var c=b.__storeProps&&b.__storeProps.indexList;c&&(c=JSON.parse(c)),this.keyPath=c&&c[a]&&c[a].keyPath||a,["multiEntry","unique"].forEach(function(b){this[b]=!!(c&&c[a]&&c[a].optionalParams&&c[a].optionalParams[b])},this)}IDBIndex.prototype.__createIndex=function(indexName,keyPath,optionalParameters){var me=this,transaction=me.__idbObjectStore.transaction;transaction.__addToTransactionQueue(function(tx,args,success,failure){me.__idbObjectStore.__getStoreProps(tx,function(){function error(){idbModules.util.throwDOMException(0,"Could not create new index",arguments)}2!==transaction.mode&&idbModules.util.throwDOMException(0,"Invalid State error, not a version transaction",me.transaction);var idxList=JSON.parse(me.__idbObjectStore.__storeProps.indexList);"undefined"!=typeof idxList[indexName]&&idbModules.util.throwDOMException(0,"Index already exists on store",idxList);var columnName=indexName;idxList[indexName]={columnName:columnName,keyPath:keyPath,optionalParams:optionalParameters},me.__idbObjectStore.__storeProps.indexList=JSON.stringify(idxList);var sql=["ALTER TABLE",idbModules.util.quote(me.__idbObjectStore.name),"ADD",columnName,"BLOB"].join(" ");idbModules.DEBUG&&console.log(sql),tx.executeSql(sql,[],function(tx,data){tx.executeSql("SELECT * FROM "+idbModules.util.quote(me.__idbObjectStore.name),[],function(tx,data){!function initIndexForRow(i){if(i<data.rows.length){try{var value=idbModules.Sca.decode(data.rows.item(i).value),indexKey=eval("value['"+keyPath+"']");tx.executeSql("UPDATE "+idbModules.util.quote(me.__idbObjectStore.name)+" set "+columnName+" = ? where key = ?",[idbModules.Key.encode(indexKey),data.rows.item(i).key],function(){initIndexForRow(i+1)},error)}catch(e){initIndexForRow(i+1)}}else{idbModules.DEBUG&&console.log("Updating the indexes in table",me.__idbObjectStore.__storeProps),tx.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[me.__idbObjectStore.__storeProps.indexList,me.__idbObjectStore.name],function(){me.__idbObjectStore.__setReadyState("createIndex",!0),success(me)},error)}}(0)},error)},error)},"createObjectStore")})},IDBIndex.prototype.openCursor=function(a,b){var c=new idbModules.IDBRequest;new idbModules.IDBCursor(a,b,this.source,c,this.indexName,"value");return c},IDBIndex.prototype.openKeyCursor=function(a,b){var c=new idbModules.IDBRequest;new idbModules.IDBCursor(a,b,this.source,c,this.indexName,"key");return c},IDBIndex.prototype.__fetchIndexData=function(a,b){var c=this;return c.__idbObjectStore.transaction.__addToTransactionQueue(function(d,e,f,g){var h=["SELECT * FROM ",idbModules.util.quote(c.__idbObjectStore.name)," WHERE",c.indexName,"NOT NULL"],i=[];"undefined"!=typeof a&&(h.push("AND",c.indexName," = ?"),i.push(idbModules.Key.encode(a))),idbModules.DEBUG&&console.log("Trying to fetch data for Index",h.join(" "),i),d.executeSql(h.join(" "),i,function(a,c){var d;d="count"===b?c.rows.length:0===c.rows.length?undefined:"key"===b?idbModules.Key.decode(c.rows.item(0).key):idbModules.Sca.decode(c.rows.item(0).value),f(d)},g)})},IDBIndex.prototype.get=function(a){return this.__fetchIndexData(a,"value")},IDBIndex.prototype.getKey=function(a){return this.__fetchIndexData(a,"key")},IDBIndex.prototype.count=function(a){return this.__fetchIndexData(a,"count")},idbModules.IDBIndex=IDBIndex}(idbModules),function(idbModules){var IDBObjectStore=function(a,b,c){this.name=a,this.transaction=b,this.__ready={},this.__setReadyState("createObjectStore","undefined"==typeof c?!0:c),this.indexNames=new idbModules.util.StringList};IDBObjectStore.prototype.__setReadyState=function(a,b){this.__ready[a]=b},IDBObjectStore.prototype.__waitForReady=function(a,b){var c=!0;if("undefined"!=typeof b){c="undefined"==typeof this.__ready[b]?!0:this.__ready[b]}else{for(var d in this.__ready){this.__ready[d]||(c=!1)}}if(c){a()}else{idbModules.DEBUG&&console.log("Waiting for to be ready",b);var e=this;window.setTimeout(function(){e.__waitForReady(a,b)},100)}},IDBObjectStore.prototype.__getStoreProps=function(a,b,c){var d=this;this.__waitForReady(function(){d.__storeProps?(idbModules.DEBUG&&console.log("Store properties - cached",d.__storeProps),b(d.__storeProps)):a.executeSql("SELECT * FROM __sys__ where name = ?",[d.name],function(a,c){1!==c.rows.length?b():(d.__storeProps={name:c.rows.item(0).name,indexList:c.rows.item(0).indexList,autoInc:c.rows.item(0).autoInc,keyPath:c.rows.item(0).keyPath},idbModules.DEBUG&&console.log("Store properties",d.__storeProps),b(d.__storeProps))},function(){b()})},c)},IDBObjectStore.prototype.__deriveKey=function(tx,value,key,callback){function getNextAutoIncKey(){tx.executeSql("SELECT * FROM sqlite_sequence where name like ?",[me.name],function(a,b){1!==b.rows.length?callback(0):callback(b.rows.item(0).seq)},function(a,b){idbModules.util.throwDOMException(0,"Data Error - Could not get the auto increment value for key",b)})}var me=this;me.__getStoreProps(tx,function(props){if(props||idbModules.util.throwDOMException(0,"Data Error - Could not locate defination for this table",props),props.keyPath){if("undefined"!=typeof key&&idbModules.util.throwDOMException(0,"Data Error - The object store uses in-line keys and the key parameter was provided",props),value){try{var primaryKey=eval("value['"+props.keyPath+"']");primaryKey?callback(primaryKey):"true"===props.autoInc?getNextAutoIncKey():idbModules.util.throwDOMException(0,"Data Error - Could not eval key from keyPath")}catch(e){idbModules.util.throwDOMException(0,"Data Error - Could not eval key from keyPath",e)}}else{idbModules.util.throwDOMException(0,"Data Error - KeyPath was specified, but value was not")}}else{"undefined"!=typeof key?callback(key):"false"===props.autoInc?idbModules.util.throwDOMException(0,"Data Error - The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",props):getNextAutoIncKey()}})},IDBObjectStore.prototype.__insertData=function(tx,encoded,value,primaryKey,success,error){var paramMap={};"undefined"!=typeof primaryKey&&(paramMap.key=idbModules.Key.encode(primaryKey));var indexes=JSON.parse(this.__storeProps.indexList);for(var key in indexes){try{paramMap[indexes[key].columnName]=idbModules.Key.encode(eval("value['"+indexes[key].keyPath+"']"))}catch(e){error(e)}}var sqlStart=["INSERT INTO ",idbModules.util.quote(this.name),"("],sqlEnd=[" VALUES ("],sqlValues=[];for(key in paramMap){sqlStart.push(key+","),sqlEnd.push("?,"),sqlValues.push(paramMap[key])}sqlStart.push("value )"),sqlEnd.push("?)"),sqlValues.push(encoded);var sql=sqlStart.join(" ")+sqlEnd.join(" ");idbModules.DEBUG&&console.log("SQL for adding",sql,sqlValues),tx.executeSql(sql,sqlValues,function(){success(primaryKey)},function(a,b){error(b)})},IDBObjectStore.prototype.add=function(a,b){var c=this,d=c.transaction.__createRequest(function(){});return idbModules.Sca.encode(a,function(e){c.transaction.__pushToQueue(d,function(d,f,g,h){c.__deriveKey(d,a,b,function(b){c.__insertData(d,e,a,b,g,h)})})}),d},IDBObjectStore.prototype.put=function(a,b){var c=this,d=c.transaction.__createRequest(function(){});return idbModules.Sca.encode(a,function(e){c.transaction.__pushToQueue(d,function(d,f,g,h){c.__deriveKey(d,a,b,function(b){var f="DELETE FROM "+idbModules.util.quote(c.name)+" where key = ?";d.executeSql(f,[idbModules.Key.encode(b)],function(d,f){idbModules.DEBUG&&console.log("Did the row with the",b,"exist? ",f.rowsAffected),c.__insertData(d,e,a,b,g,h)},function(a,b){h(b)})})})}),d},IDBObjectStore.prototype.get=function(a){var b=this;return b.transaction.__addToTransactionQueue(function(c,d,e,f){b.__waitForReady(function(){var d=idbModules.Key.encode(a);idbModules.DEBUG&&console.log("Fetching",b.name,d),c.executeSql("SELECT * FROM "+idbModules.util.quote(b.name)+" where key = ?",[d],function(a,b){idbModules.DEBUG&&console.log("Fetched data",b);try{if(0===b.rows.length){return e()}e(idbModules.Sca.decode(b.rows.item(0).value))}catch(c){idbModules.DEBUG&&console.log(c),e(void 0)}},function(a,b){f(b)})})})},IDBObjectStore.prototype["delete"]=function(a){var b=this;return b.transaction.__addToTransactionQueue(function(c,d,e,f){b.__waitForReady(function(){var d=idbModules.Key.encode(a);idbModules.DEBUG&&console.log("Fetching",b.name,d),c.executeSql("DELETE FROM "+idbModules.util.quote(b.name)+" where key = ?",[d],function(a,b){idbModules.DEBUG&&console.log("Deleted from database",b.rowsAffected),e()},function(a,b){f(b)})})})},IDBObjectStore.prototype.clear=function(){var a=this;return a.transaction.__addToTransactionQueue(function(b,c,d,e){a.__waitForReady(function(){b.executeSql("DELETE FROM "+idbModules.util.quote(a.name),[],function(a,b){idbModules.DEBUG&&console.log("Cleared all records from database",b.rowsAffected),d()},function(a,b){e(b)})})})},IDBObjectStore.prototype.count=function(a){var b=this;return b.transaction.__addToTransactionQueue(function(c,d,e,f){b.__waitForReady(function(){var d="SELECT * FROM "+idbModules.util.quote(b.name)+("undefined"!=typeof a?" WHERE key = ?":""),g=[];"undefined"!=typeof a&&g.push(idbModules.Key.encode(a)),c.executeSql(d,g,function(a,b){e(b.rows.length)},function(a,b){f(b)})})})},IDBObjectStore.prototype.openCursor=function(a,b){var c=new idbModules.IDBRequest;new idbModules.IDBCursor(a,b,this,c,"key","value");return c},IDBObjectStore.prototype.index=function(a){var b=new idbModules.IDBIndex(a,this);return b},IDBObjectStore.prototype.createIndex=function(a,b,c){var d=this;c=c||{},d.__setReadyState("createIndex",!1);var e=new idbModules.IDBIndex(a,d);return d.__waitForReady(function(){e.__createIndex(a,b,c)},"createObjectStore"),d.indexNames.push(a),e},IDBObjectStore.prototype.deleteIndex=function(a){var b=new idbModules.IDBIndex(a,this,!1);return b.__deleteIndex(a),b},idbModules.IDBObjectStore=IDBObjectStore}(idbModules),function(g){var f=0,j=1,i=2,h=function(k,c,b){if("number"==typeof c){this.mode=c,2!==c&&g.DEBUG&&console.log("Mode should be a string, but was specified as ",c)}else{if("string"==typeof c){switch(c){case"readwrite":this.mode=j;break;case"readonly":this.mode=f;break;default:this.mode=f}}}this.storeNames="string"==typeof k?[k]:k;for(var a=0;a<this.storeNames.length;a++){b.objectStoreNames.contains(this.storeNames[a])||g.util.throwDOMException(0,"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",this.storeNames[a])}this.__active=!0,this.__running=!1,this.__requests=[],this.__aborted=!1,this.db=b,this.error=null,this.onabort=this.onerror=this.oncomplete=null};h.prototype.__executeRequests=function(){if(this.__running&&this.mode!==i){return g.DEBUG&&console.log("Looks like the request set is already running",this.mode),void 0}this.__running=!0;var a=this;window.setTimeout(function(){2===a.mode||a.__active||g.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",a.__active),a.db.__db.transaction(function(p){function o(e,r){r&&(l.req=r),l.req.readyState="done",l.req.result=e,delete l.req.error;var q=g.Event("success");g.util.callback("onsuccess",l.req,q),k++,m()}function n(){l.req.readyState="done",l.req.error="DOMError";var c=g.Event("error",arguments);g.util.callback("onerror",l.req,c),k++,m()}function m(){return k>=a.__requests.length?(a.__active=!1,a.__requests=[],void 0):(l=a.__requests[k],l.op(p,l.args,o,n),void 0)}a.__tx=p;var l=null,k=0;try{m()}catch(b){g.DEBUG&&console.log("An exception occured in transaction",arguments),"function"==typeof a.onerror&&a.onerror()}},function(){g.DEBUG&&console.log("An error in transaction",arguments),"function"==typeof a.onerror&&a.onerror()},function(){g.DEBUG&&console.log("Transaction completed",arguments),"function"==typeof a.oncomplete&&a.oncomplete()})},1)},h.prototype.__addToTransactionQueue=function(a,k){this.__active||this.mode===i||g.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished.",this.__mode);var d=this.__createRequest();return this.__pushToQueue(d,a,k),d},h.prototype.__createRequest=function(){var a=new g.IDBRequest;return a.source=this.db,a.transaction=this,a},h.prototype.__pushToQueue=function(e,d,k){this.__requests.push({op:d,args:k,req:e}),this.__executeRequests()},h.prototype.objectStore=function(a){return new g.IDBObjectStore(a,this)},h.prototype.abort=function(){!this.__active&&g.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",this.__active)},h.prototype.READ_ONLY=0,h.prototype.READ_WRITE=1,h.prototype.VERSION_CHANGE=2,g.IDBTransaction=h}(idbModules),function(d){var c=function(a,j,i,h){this.__db=a,this.version=i,this.__storeProperties=h,this.objectStoreNames=new d.util.StringList;for(var g=0;g<h.rows.length;g++){this.objectStoreNames.push(h.rows.item(g).name)}this.name=j,this.onabort=this.onerror=this.onversionchange=null};c.prototype.createObjectStore=function(a,j){var i=this;j=j||{},j.keyPath=j.keyPath||null;var h=new d.IDBObjectStore(a,i.__versionTransaction,!1),g=i.__versionTransaction;return g.__addToTransactionQueue(function(m,l,k){function e(){d.util.throwDOMException(0,"Could not create new object store",arguments)}i.__versionTransaction||d.util.throwDOMException(0,"Invalid State error",i.transaction);var b=["CREATE TABLE",d.util.quote(a),"(key BLOB",j.autoIncrement?", inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");d.DEBUG&&console.log(b),m.executeSql(b,[],function(f){f.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[a,j.keyPath,j.autoIncrement?!0:!1,"{}"],function(){h.__setReadyState("createObjectStore",!0),k(h)},e)},e)}),i.objectStoreNames.push(a),h},c.prototype.deleteObjectStore=function(a){var h=function(){d.util.throwDOMException(0,"Could not delete ObjectStore",arguments)},g=this;!g.objectStoreNames.contains(a)&&h("Object Store does not exist"),g.objectStoreNames.splice(g.objectStoreNames.indexOf(a),1);var f=g.__versionTransaction;f.__addToTransactionQueue(function(){g.__versionTransaction||d.util.throwDOMException(0,"Invalid State error",g.transaction),g.__db.transaction(function(b){b.executeSql("SELECT * FROM __sys__ where name = ?",[a],function(j,i){i.rows.length>0&&j.executeSql("DROP TABLE "+d.util.quote(a),[],function(){j.executeSql("DELETE FROM __sys__ WHERE name = ?",[a],function(){},h)},h)})})})},c.prototype.close=function(){},c.prototype.transaction=function(a,f){var e=new d.IDBTransaction(a,f||1,this);return e},d.IDBDatabase=c}(idbModules),function(f){var e=4194304;if(window.openDatabase){var h=window.openDatabase("__sysdb__",1,"System Database",e);h.transaction(function(a){a.executeSql("SELECT * FROM dbVersions",[],function(){},function(){h.transaction(function(c){c.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[],function(){},function(){f.util.throwDOMException("Could not create table __sysdb__ to save DB versions")})})})},function(){f.DEBUG&&console.log("Error in sysdb transaction - when selecting from dbVersions",arguments)});var g={open:function(l,k){function j(){if(!a){var d=f.Event("error",arguments);b.readyState="done",b.error="DOMError",f.util.callback("onerror",b,d),a=!0}}function c(m){var d=window.openDatabase(l,1,l,e);b.readyState="done","undefined"==typeof k&&(k=m||1),(0>=k||m>k)&&f.util.throwDOMException(0,"An attempt was made to open a database using a lower version than the existing version.",k),d.transaction(function(i){i.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",[],function(){i.executeSql("SELECT * FROM __sys__",[],function(n,p){var o=f.Event("success");b.source=b.result=new f.IDBDatabase(d,l,k,p),k>m?h.transaction(function(q){q.executeSql("UPDATE dbVersions set version = ? where name = ?",[k,l],function(){var r=f.Event("upgradeneeded");r.oldVersion=m,r.newVersion=k,b.transaction=b.result.__versionTransaction=new f.IDBTransaction([],2,b.source),f.util.callback("onupgradeneeded",b,r,function(){var s=f.Event("success");f.util.callback("onsuccess",b,s)})},j)},j):f.util.callback("onsuccess",b,o)},j)},j)},j)}var b=new f.IDBOpenRequest,a=!1;return h.transaction(function(d){d.executeSql("SELECT * FROM dbVersions where name = ?",[l],function(m,i){0===i.rows.length?m.executeSql("INSERT INTO dbVersions VALUES (?,?)",[l,k||1],function(){c(0)},j):c(i.rows.item(0).version)},j)},j),b},deleteDatabase:function(l){function k(d){if(!b){c.readyState="done",c.error="DOMError";var i=f.Event("error");i.message=d,i.debug=arguments,f.util.callback("onerror",c,i),b=!0}}function j(){h.transaction(function(d){d.executeSql("DELETE FROM dbVersions where name = ? ",[l],function(){c.result=void 0;var i=f.Event("success");i.newVersion=null,i.oldVersion=a,f.util.callback("onsuccess",c,i)},k)},k)}var c=new f.IDBOpenRequest,b=!1,a=null;return h.transaction(function(d){d.executeSql("SELECT * FROM dbVersions where name = ?",[l],function(o,n){if(0===n.rows.length){c.result=void 0;var m=f.Event("success");return m.newVersion=null,m.oldVersion=a,f.util.callback("onsuccess",c,m),void 0}a=n.rows.item(0).version;var i=window.openDatabase(l,1,l,e);i.transaction(function(p){p.executeSql("SELECT * FROM __sys__",[],function(q,t){var s=t.rows;!function r(u){u>=s.length?q.executeSql("DROP TABLE __sys__",[],function(){j()},k):q.executeSql("DROP TABLE "+f.util.quote(s.item(u).name),[],function(){r(u+1)},function(){r(u+1)})}(0)},function(){j()})},k)})},k),c},cmp:function(a,d){return f.Key.encode(a)>f.Key.encode(d)?1:a===d?0:-1}};f.shimIndexedDB=g}}(idbModules),function(d,c){"undefined"!=typeof d.openDatabase&&(d.shimIndexedDB=c.shimIndexedDB,d.shimIndexedDB&&(d.shimIndexedDB.__useShim=function(){d.indexedDB=c.shimIndexedDB,d.IDBDatabase=c.IDBDatabase,d.IDBTransaction=c.IDBTransaction,d.IDBCursor=c.IDBCursor,d.IDBKeyRange=c.IDBKeyRange},d.shimIndexedDB.__debug=function(b){c.DEBUG=b})),"indexedDB" in d||(d.indexedDB=d.indexedDB||d.webkitIndexedDB||d.mozIndexedDB||d.oIndexedDB||d.msIndexedDB),"undefined"==typeof d.indexedDB&&"undefined"!=typeof d.openDatabase?d.shimIndexedDB.__useShim():(d.IDBDatabase=d.IDBDatabase||d.webkitIDBDatabase,d.IDBTransaction=d.IDBTransaction||d.webkitIDBTransaction,d.IDBCursor=d.IDBCursor||d.webkitIDBCursor,d.IDBKeyRange=d.IDBKeyRange||d.webkitIDBKeyRange,d.IDBTransaction||(d.IDBTransaction={}),d.IDBTransaction.READ_ONLY=d.IDBTransaction.READ_ONLY||"readonly",d.IDBTransaction.READ_WRITE=d.IDBTransaction.READ_WRITE||"readwrite")}(window,idbModules);
(function(){TouchMouseEvent={DOWN:"touchmousedown",UP:"touchmouseup",MOVE:"touchmousemove"};var d=function(f){var e;switch(f.type){case"mousedown":e=TouchMouseEvent.DOWN;break;case"mouseup":e=TouchMouseEvent.UP;break;case"mousemove":e=TouchMouseEvent.MOVE;break;default:return}var g=a(e,f,f.pageX,f.pageY);$(f.target).trigger(g)};var c=function(f){var e;switch(f.type){case"touchstart":e=TouchMouseEvent.DOWN;break;case"touchend":e=TouchMouseEvent.UP;break;case"touchmove":e=TouchMouseEvent.MOVE;break;default:return}var h=f.originalEvent.touches[0];var g;if(e==TouchMouseEvent.UP){g=a(e,f,null,null)}else{g=a(e,f,h.pageX,h.pageY)}$(f.target).trigger(g)};var a=function(g,f,e,h){return $.Event(g,{pageX:e,pageY:h,originalEvent:f})};var b=$(document);if("ontouchstart" in window){b.on("touchstart",c);b.on("touchmove",c);b.on("touchend",c)}else{b.on("mousedown",d);b.on("mouseup",d);b.on("mousemove",d)}})();
/*!
 * jQuery Transit - CSS3 transitions and transformations
 * (c) 2011-2012 Rico Sta. Cruz <rico@ricostacruz.com>
 * MIT Licensed.
 *
 * http://ricostacruz.com/jquery.transit
 * http://github.com/rstacruz/jquery.transit
 */
(function(x){x.transit={version:"0.9.9",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:true,useTransitionEnd:false};var E=document.createElement("div");var r={};function G(a){if(a in E.style){return a}var b=["Moz","Webkit","O","ms"];var e=a.charAt(0).toUpperCase()+a.substr(1);if(a in E.style){return a}for(var c=0;c<b.length;++c){var d=b[c]+e;if(d in E.style){return d}}}function D(){E.style[r.transform]="";E.style[r.transform]="rotateY(90deg)";return E.style[r.transform]!==""}var H=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;r.transition=G("transition");r.transitionDelay=G("transitionDelay");r.transform=G("transform");r.transformOrigin=G("transformOrigin");r.transform3d=D();var z={transition:"transitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"};var C=r.transitionEnd=z[r.transition]||null;for(var s in r){if(r.hasOwnProperty(s)&&typeof x.support[s]==="undefined"){x.support[s]=r[s]}}E=null;x.cssEase={_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"};x.cssHooks["transit:transform"]={get:function(a){return x(a).data("transform")||new y()},set:function(b,c){var a=c;if(!(a instanceof y)){a=new y(a)}if(r.transform==="WebkitTransform"&&!H){b.style[r.transform]=a.toString(true)}else{b.style[r.transform]=a.toString()}x(b).data("transform",a)}};x.cssHooks.transform={set:x.cssHooks["transit:transform"].set};if(x.fn.jquery<"1.8"){x.cssHooks.transformOrigin={get:function(a){return a.style[r.transformOrigin]},set:function(b,a){b.style[r.transformOrigin]=a}};x.cssHooks.transition={get:function(a){return a.style[r.transition]},set:function(b,a){b.style[r.transition]=a}}}u("scale");u("translate");u("rotate");u("rotateX");u("rotateY");u("rotate3d");u("perspective");u("skewX");u("skewY");u("x",true);u("y",true);function y(a){if(typeof a==="string"){this.parse(a)}return this}y.prototype={setFromString:function(a,b){var c=(typeof b==="string")?b.split(","):(b.constructor===Array)?b:[b];c.unshift(a);y.prototype.set.apply(this,c)},set:function(a){var b=Array.prototype.slice.apply(arguments,[1]);if(this.setter[a]){this.setter[a].apply(this,b)}else{this[a]=b.join(",")}},get:function(a){if(this.getter[a]){return this.getter[a].apply(this)}else{return this[a]||0}},setter:{rotate:function(a){this.rotate=t(a,"deg")},rotateX:function(a){this.rotateX=t(a,"deg")},rotateY:function(a){this.rotateY=t(a,"deg")},scale:function(b,a){if(a===undefined){a=b}this.scale=b+","+a},skewX:function(a){this.skewX=t(a,"deg")},skewY:function(a){this.skewY=t(a,"deg")},perspective:function(a){this.perspective=t(a,"px")},x:function(a){this.set("translate",a,null)},y:function(a){this.set("translate",null,a)},translate:function(b,a){if(this._translateX===undefined){this._translateX=0}if(this._translateY===undefined){this._translateY=0}if(b!==null&&b!==undefined){this._translateX=t(b,"px")}if(a!==null&&a!==undefined){this._translateY=t(a,"px")}this.translate=this._translateX+","+this._translateY}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},scale:function(){var a=(this.scale||"1,1").split(",");if(a[0]){a[0]=parseFloat(a[0])}if(a[1]){a[1]=parseFloat(a[1])}return(a[0]===a[1])?a[0]:a},rotate3d:function(){var a=(this.rotate3d||"0,0,0,0deg").split(",");for(var b=0;b<=3;++b){if(a[b]){a[b]=parseFloat(a[b])}}if(a[3]){a[3]=t(a[3],"deg")}return a}},parse:function(a){var b=this;a.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(e,c,d){b.setFromString(c,d)})},toString:function(a){var b=[];for(var c in this){if(this.hasOwnProperty(c)){if((!r.transform3d)&&((c==="rotateX")||(c==="rotateY")||(c==="perspective")||(c==="transformOrigin"))){continue}if(c[0]!=="_"){if(a&&(c==="scale")){b.push(c+"3d("+this[c]+",1)")}else{if(a&&(c==="translate")){b.push(c+"3d("+this[c]+",0)")}else{b.push(c+"("+this[c]+")")}}}}}return b.join(" ")}};function v(b,c,a){if(c===true){b.queue(a)}else{if(c){b.queue(c,a)}else{a()}}}function A(a){var b=[];x.each(a,function(c){c=x.camelCase(c);c=x.transit.propertyMap[c]||x.cssProps[c]||c;c=F(c);if(x.inArray(c,b)===-1){b.push(c)}});return b}function B(f,c,a,g){var e=A(f);if(x.cssEase[a]){a=x.cssEase[a]}var b=""+w(c)+" "+a;if(parseInt(g,10)>0){b+=" "+w(g)}var d=[];x.each(e,function(h,i){d.push(i+" "+b)});return d.join(", ")}x.fn.transition=x.fn.transit=function(f,n,g,c){var b=this;var k=0;var i=true;if(typeof n==="function"){c=n;n=undefined}if(typeof g==="function"){c=g;g=undefined}if(typeof f.easing!=="undefined"){g=f.easing;delete f.easing}if(typeof f.duration!=="undefined"){n=f.duration;delete f.duration}if(typeof f.complete!=="undefined"){c=f.complete;delete f.complete}if(typeof f.queue!=="undefined"){i=f.queue;delete f.queue}if(typeof f.delay!=="undefined"){k=f.delay;delete f.delay}if(typeof n==="undefined"){n=x.fx.speeds._default}if(typeof g==="undefined"){g=x.cssEase._default}n=w(n);var m=B(f,n,g,k);var d=x.transit.enabled&&r.transition;var l=d?(parseInt(n,10)+parseInt(k,10)):0;if(l===0){var e=function(o){b.css(f);if(c){c.apply(b)}if(o){o()}};v(b,i,e);return b}var h={};var a=function(o){var p=false;var q=function(){if(p){b.unbind(C,q)}if(l>0){b.each(function(){this.style[r.transition]=(h[this]||null)})}if(typeof c==="function"){c.apply(b)}if(typeof o==="function"){o()}};if((l>0)&&(C)&&(x.transit.useTransitionEnd)){p=true;b.bind(C,q)}else{window.setTimeout(q,l)}b.each(function(){if(l>0){this.style[r.transition]=m}x(this).css(f)})};var j=function(o){this.offsetWidth;a(o)};v(b,i,j);return this};function u(a,b){if(!b){x.cssNumber[a]=true}x.transit.propertyMap[a]=r.transform;x.cssHooks[a]={get:function(c){var d=x(c).css("transit:transform");return d.get(a)},set:function(d,c){var e=x(d).css("transit:transform");e.setFromString(a,c);x(d).css({"transit:transform":e})}}}function F(a){return a.replace(/([A-Z])/g,function(b){return"-"+b.toLowerCase()})}function t(a,b){if((typeof a==="string")&&(!a.match(/^[\-0-9\.]+$/))){return a}else{return""+a+b}}function w(a){var b=a;if(x.fx.speeds[b]){b=x.fx.speeds[b]}return t(b,"ms")}x.transit.getTransitionValue=B})(jQuery);
(function(a){a.simplePlaceholder={placeholderClass:null,hidePlaceholder:function(){var b=a(this);if(b.val()==b.attr("placeholder")&&b.data(a.simplePlaceholder.placeholderData)){b.val("").removeClass(a.simplePlaceholder.placeholderClass).data(a.simplePlaceholder.placeholderData,false)}},showPlaceholder:function(){var b=a(this);if(b.val()==""){b.val(b.attr("placeholder")).addClass(a.simplePlaceholder.placeholderClass).data(a.simplePlaceholder.placeholderData,true)}},preventPlaceholderSubmit:function(){a(this).find(".simple-placeholder").each(function(c){var b=a(this);if(b.val()==b.attr("placeholder")&&b.data(a.simplePlaceholder.placeholderData)){b.val("")}});return true}};a.fn.simplePlaceholder=function(c){if(document.createElement("input").placeholder==undefined){var b={placeholderClass:"placeholding",placeholderData:"simplePlaceholder.placeholding"};if(c){a.extend(b,c)}a.extend(a.simplePlaceholder,b);this.each(function(){var d=a(this);d.focus(a.simplePlaceholder.hidePlaceholder);d.blur(a.simplePlaceholder.showPlaceholder);d.data(a.simplePlaceholder.placeholderData,false);if(d.val()==""){d.val(d.attr("placeholder"));d.addClass(a.simplePlaceholder.placeholderClass);d.data(a.simplePlaceholder.placeholderData,true)}d.addClass("simple-placeholder");a(this.form).submit(a.simplePlaceholder.preventPlaceholderSubmit)})}return this}})(jQuery);
var KidsBox={Model:{},Collection:{},View:{},Router:{},Singleton:{},Activities:{},CourseId:null,localStorage:undefined,CalcSupported:(function(){var a=document.createElement("div");a.style.cssText="width:calc(10px); width:-webkit-calc(10px);";return(!!a.style.length)})(),isLocalAndIE:(function(){return(((/MSIE (\d+\.\d+);/.test(navigator.userAgent)===true)||(!!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/))))&&((location.protocol!=="file:")===false))})(),isAndroid:(function(){return(navigator.userAgent.toLowerCase().indexOf("android")>-1&&navigator.userAgent.toLowerCase().indexOf("chrome")==-1)})(),isAndroid_40_41:(function(){var c=navigator.userAgent,b,a=false;if(c.toLowerCase().indexOf("android")>=0){b=parseFloat(c.slice(c.toLowerCase().indexOf("android")+8));a=(b==4.1||b==4.2)}return a})(),Main:(function(){var e=function(){KidsBox.Singleton.PageModelA=new KidsBox.Model.CurrentPageModel();KidsBox.Singleton.PageModelB=new KidsBox.Model.CurrentPageModel();KidsBox.Singleton.PageModelC=new KidsBox.Model.CurrentPageModel();KidsBox.Singleton.NavigatorModel=new KidsBox.Model.NavigatorModel();KidsBox.Singleton.CurrentPopupModel=new KidsBox.Model.CurrentPopupModel();KidsBox.Singleton.PopupModel=new KidsBox.Model.PopupModel();KidsBox.Singleton.CurrentResourceLinkModel=new KidsBox.Model.CurrentResourceLinkModel();KidsBox.Singleton.FooterModel=new KidsBox.Model.FooterModel()};var d=function(){KidsBox.Singleton.PagesCollection=new KidsBox.Collection.PagesCollection();KidsBox.Singleton.CurrentPagesCollection=new KidsBox.Collection.CurrentPagesCollection();KidsBox.Singleton.PopupCollection=new KidsBox.Collection.PopupCollection();KidsBox.Singleton.ThemeCollection=new KidsBox.Collection.ThemeCollection();KidsBox.Singleton.HighLightCollection=new KidsBox.Collection.HighLightCollection();KidsBox.Singleton.LinkResourceCollection=new KidsBox.Collection.LinkResourceCollection();KidsBox.Singleton.NotesCollection=new KidsBox.Collection.NotesCollection();KidsBox.Singleton.BookMarkCollection=new KidsBox.Collection.BookMarkCollection();KidsBox.Singleton.SearchCollection=new KidsBox.Collection.SearchCollection()};var a=function(){KidsBox.Singleton.CourseView=new KidsBox.View.CourseView({model:KidsBox.Singleton.NavigatorModel,el:$("#container")});KidsBox.Singleton.FooterView=new KidsBox.View.FooterView({model:KidsBox.Singleton.FooterModel,el:$(".main-footer")});KidsBox.Singleton.NavigatorView=new KidsBox.View.NavigatorView({model:KidsBox.Singleton.NavigatorModel,el:$("nav.navbar")});KidsBox.Singleton.ViewA=new KidsBox.View.PageView({model:KidsBox.Singleton.PageModelA,el:$("#pageA")});KidsBox.Singleton.ViewB=new KidsBox.View.PageView({model:KidsBox.Singleton.PageModelB,el:$("#pageB")});KidsBox.Singleton.ViewC=new KidsBox.View.PageView({model:KidsBox.Singleton.PageModelC,el:$("#pageC")});KidsBox.Singleton.PopupView=new KidsBox.View.PopupView({model:KidsBox.Singleton.CurrentPopupModel,el:$("#popupContainer")});KidsBox.Singleton.NotesView=new KidsBox.View.NotesView({model:KidsBox.Singleton.NotesCollection,el:$("#notesContainer")});KidsBox.Singleton.BookMarkView=new KidsBox.View.BookMarkView({model:KidsBox.Singleton.BookMarkCollection,el:$("#bookMarkContainer")});KidsBox.Singleton.BookMarkApiView=new KidsBox.View.BookMarkApiView({model:KidsBox.Singleton.BookMarkCollection,el:$("#bookMarkApiContainer")});KidsBox.Singleton.SearchView=new KidsBox.View.SearchView({model:KidsBox.Singleton.SearchCollection,el:$("#searchContainer")});KidsBox.Singleton.ResourceLinkView=new KidsBox.View.ResourceLinkView({model:KidsBox.Singleton.CurrentResourceLinkModel,el:$("#resourceLinkContainer")})};var f=function(){KidsBox.Singleton.NavigatorModel.set("titleIntroduction",$("#btnMenu").text());KidsBox.Singleton.NavigatorModel.set("updateTitle",$("#btnMenu").attr("data-update"));KidsBox.Singleton.NavigatorModel.set("rangeBookPages",$("#btnMenu").attr("data-rangebookpages"));KidsBox.Singleton.CurrentPagesCollection.add([KidsBox.Singleton.PageModelA,KidsBox.Singleton.PageModelB,KidsBox.Singleton.PageModelC]);var g=0;$("noscript[data-type='content']").each(function(){KidsBox.Singleton.PagesCollection.add({html:$(this).text(),text:$(this).text().replace(/(<([^>]+)>)/ig,"").toLowerCase(),pageId:g++,pageNumber:$(this).attr("data-id").split(".").join(",").split(" ").join(""),themeId:$(this).attr("data-theme-id")});$(this).remove()});$("noscript[data-type='popup']").each(function(){KidsBox.Singleton.PopupCollection.add({popupId:$(this).attr("data-id"),themeId:$(this).attr("data-theme-id"),type:$(this).attr("data-type-related"),html:$(this).text()});$(this).remove()});$("activity[data-id]").each(function(){KidsBox.Activities[$(this).attr("data-id")]=$(this).text();$(this).remove()});if(!KidsBox.isLocalAndIE){KidsBox.Singleton.HighLightCollection.fetch();KidsBox.Singleton.LinkResourceCollection.fetch();KidsBox.Singleton.NotesCollection.fetch();KidsBox.Singleton.BookMarkCollection.fetch();KidsBox.Singleton.BookMarkCollection.validateModels()}};var c=function(){KidsBox.Singleton.CourseRouter=new KidsBox.Router.CourseRouter();Backbone.history.start()};var b=function(){rangy.init();NAPI.range=rangy.createCssClassApplier("highlighted")};return{init:function(){KidsBox.CourseId=$("body").attr("data-course-id");e();d();f();a();b();c()},normalizeEvents:function(i){var h={};if(!!("ontouchstart" in window)){for(var g in i){if(g.indexOf("click")===0){h[g]="fPrevent";h[g.replace("click","touchstart")]=i[g]}else{if(g.indexOf("mouseup")===0){h[g.replace("mouseup","touchstart")]=i[g]}else{h[g]=i[g]}}}}else{h=i}return h}}})()};(function(){if(KidsBox.isLocalAndIE){function a(c){var b={setItem:function(e,d){return b[e]=String(d)},getItem:function(d){return b.hasOwnProperty(d)?String(b[d]):c},removeItem:function(d){return delete b[d]},clear:function(){a()}};KidsBox.localStorage=b}a()}}());$(function(){KidsBox.Main.init();$(document).click(function(a){})});
var NetexTemplateToolsApi=function(){var a=this;a.holdNoteClick=false;a.holdAttachmentClick=false;a.holdCreateMask=false;a.mask={click:false,xCoord:0,yCoord:0};a.maskBinded=false;a.isLocalAndIE=(function(){return(((/MSIE (\d+\.\d+);/.test(navigator.userAgent)===true)||(!!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/))))&&((location.protocol!=="file:")===false))})()};NetexTemplateToolsApi.prototype.indexOrPage=function(a,e){var b=this;var c="only-inside-theme";switch(a){case"index":$("#breadcrum").hide();$("nav.navbar ul > li.menu-item").each(function(){var f=$(this);if(f.attr("rel")===c){f.animate({opacity:0.4});f.click(function(){return false})}});$(window).load(function(f){setTimeout(function(){b.fixBorders()},100)});$("#canvasTools").hide();b.fixBorders();b._removeCurrentClass();b._hideFooter(true);break;case"page":$(".devPageCurrent #breadcrum").show();$(".total-border").css("height","auto");var d=($(".total-border").height()-$(".main-header .navbar").height()-$(".main-header.breadcrum").height());$(".devPageCurrent .main-content").css({"overflow-y":"hidden",height:d+"px","max-height":d+"px"});$("nav.navbar ul > li.menu-item").each(function(){$(this).animate({opacity:1});$(this).unbind("click")});if(!$(".devPageCurrent #breadcrum").is(":visible")&&!e){setTimeout(function(){b.indexOrPage("page",true)},1500)}$(".devPageCurrent #breadcrum").show();$("#canvasTools").show();var a="themes";if(b.isWorkbook()==true){a="workbook"}b.addCurrentTheme(a);b._hideFooter(false);new Draggabilly(document.querySelector("#canvasTools"),{handle:".icon-squares",containment:true}).on("dragEnd",function(h,g,f){setTimeout(function(){var j=$(".canvas-tools").find(".canvas-tools-submenu:visible");var k=j.length>0?j.height():0;var i={x:$("#canvasTools").position().left,y:$("#canvasTools").position().top-k};NAPI.getDraggableBoundaries(document.querySelector("#canvasTools"),i,k)},50)});if(!e){setTimeout(function(){b.fixFooter();new NAPI.CanvasBindings();if(!KidsBox.Singleton.PagesCollection.isFirstPage()){NetexCanvas._init("canvas_"+NAPI._currentBookPage(),true)}$("#btnNext, #btnPrev").css({top:"50%",marginTop:"-24px"})},10)}break}$(window).on("resize ready scroll orientationchange",function(){b.fixFooter()})};NetexTemplateToolsApi.prototype.fixBorders=function(){var b=($(".devPageCurrent .imgcover").height()+$("nav.navbar").height()+3);if(b<300){b="auto"}$(".total-border").css("height",b);var a=($(".total-border").height()-$(".main-header .navbar").height());$(".devPageCurrent .main-content").css({"overflow-y":"hidden",height:a+"px","max-height":a+"px"})};NetexTemplateToolsApi.prototype.fixFooter=function(){var b=$(window).height();var a=$(".total-border").height();var c=((b-a)<0)?0:(b-a);$("div.main-footer").css("bottom",(c)+"px")};NetexTemplateToolsApi.prototype.isWorkbook=function(){var a=false;if($(".devPageCurrent h1#title").is(":visible")){a=($(".devPageCurrent h1#title").find("#isWorkbook").val()=="true")?true:false}return a};NetexTemplateToolsApi.prototype.isTouch=function(){return"ontouchstart" in window||"onmsgesturechange" in window};NetexTemplateToolsApi.prototype._currentThemeId=function(){var a=0;$("#breadcrum h1#title").each(function(){if($(this).is(":visible")){a=$(this).find("#globalThemeId")}});return(typeof a.text==="function")?a.val():1};NetexTemplateToolsApi.prototype._currentBookPage=function(){var a=0;a=KidsBox.Singleton.NavigatorModel.get("current");return(!isNaN(a))?a:""};NetexTemplateToolsApi.prototype._currentBookNumber=function(){var a=0;a=KidsBox.Singleton.NavigatorModel.get("current");return(!isNaN(a))?a:""};NetexTemplateToolsApi.prototype._removeCurrentClass=function(){$("#themesMenu > li, #workbookMenu > li").each(function(){$(this).removeClass("current")})};NetexTemplateToolsApi.prototype.addCurrentTheme=function(a){var b=this;if(!a){a="themes"}b._removeCurrentClass();var c=b._currentThemeId();$("#"+a+'Menu > li[data-theme-id="'+c+'"]').addClass("current")};NetexTemplateToolsApi.prototype._hideFooter=function(a){if(a){$("div.main-footer").hide()}else{$("div.main-footer").show()}};NetexTemplateToolsApi.prototype.rand=function(a){var e=["ABCDEFabcdef0123456789","ghijklm0123456789","nopqrstu1234567890"],f=e[Math.floor(Math.random()*e.length)];var b="";for(var c=0;c<a;c++){var d=Math.floor(Math.random()*f.length);b+=f.substring(d,d+1)}return b};NetexTemplateToolsApi.prototype.CalcSupported=function(){var a=document.createElement("div");a.style.cssText="width:calc(10px); width:-webkit-calc(10px);";return(!!a.style.length)};NetexTemplateToolsApi.prototype.idbSupport=false;NetexTemplateToolsApi.prototype.alertNoAttachments=function(){$("#noAttachmentsSupported").show();$(".dark-background").css("visibility","visible").show();$("#noAttachmentsSupported").find("#noAttachmentsOk").unbind().bind("click",function(a){a.preventDefault();$("#noAttachmentsSupported").hide();$(".dark-background").css("visibility","hidden").hide()})};NetexTemplateToolsApi.prototype.alertBestWork=function(){$("#bestWork").show();$(".dark-background").css("visibility","visible").show();$("#bestWork").find("#bestWorkOk").unbind().bind("click",function(a){a.preventDefault();$("#bestWork").hide();$(".dark-background").css("visibility","hidden").hide()})};NetexTemplateToolsApi.prototype.bindCreateMask=function(){var a=this;var c=$("#container").offset();var b=this.rand(16);a.maskBinded=true;$("#container").unbind(TouchMouseEvent.DOWN+" "+TouchMouseEvent.UP+" "+TouchMouseEvent.MOVE);$("#container").on(TouchMouseEvent.DOWN,function(g){if(a.holdCreateMask===true){g.preventDefault();a.mask.click=true;a.mask.xCoord=g.pageX-c.left;a.mask.yCoord=g.pageY-c.top;var f=$("<div/>").attr({id:"maskHandler","class":"mask-handler"});var h=$("<div/>").attr({id:"maskClose","class":"sprite icon-close-xwhite pull-right special"}).bind("click",function(){$("#maskSquare_"+b).remove()});var d=$("<div/>").attr({id:"maskSquare_"+b,"class":"mask-square"}).css({display:"none"}).append(f).append(h);$("#container").append(d)}});$("#container").on(TouchMouseEvent.MOVE,function(f){if(a.holdCreateMask===true){f.preventDefault();if(a.mask.click===true){var d=f.pageX-c.left;var g=f.pageY-c.top;$("#maskSquare_"+b).css({left:Math.min(a.mask.xCoord,d),top:Math.min(a.mask.yCoord,g),width:Math.abs(a.mask.xCoord-d),height:Math.abs(a.mask.yCoord-g),display:"block"})}}});$("#container").on(TouchMouseEvent.UP,function(){if(a.holdCreateMask===true&&a.mask.click===true){$("#maskSquare_"+b).show().addClass("done");new Draggabilly(document.querySelector("#maskSquare_"+b),{handle:".mask-handler",containment:true});a.maskBinded=false;a.mask.click=false;a.holdCreateMask=false}})};NetexTemplateToolsApi.prototype.getDraggableBoundaries=function(g,h,d){if(h.x===undefined||h.x==="undefined"){h.x=h.left;h.y=h.top}var j=$(".devPageCurrent .main-image").width(),f=$(".devPageCurrent").height()-$("footer").height(),b=window.getComputedStyle(g,null),c=parseInt(b.getPropertyValue("width").replace("px","")),e=parseInt(b.getPropertyValue("height").replace("px","")),a={x:(j-c),y:(f-e)};if(h.x<24){$(g).animate({left:24},150)}if((h.y)<0){if(d!==0){d+=20}$(g).animate({top:d},150)}if(h.x>a.x){var i=a.x-24-12;$(g).animate({left:i},150)}if(h.y>a.y){$(g).animate({top:a.y},150)}};NetexTemplateToolsApi.prototype.lastBM=undefined;NetexTemplateToolsApi.prototype.removeBookmark=function(b){var a=this;var c=new NAPI.Bookmarks();c.remove(b);this.lastBM=c.last();a.fillBookmarkList()};NetexTemplateToolsApi.prototype.addBookmark=function(){var b=this;var d=b._currentThemeId();var a=b._currentBookPage();var c=b.isWorkbook();var e=new NAPI.Bookmarks();e.add(d,a,c);b.fillBookmarkList()};NetexTemplateToolsApi.prototype.lastBookmark=function(){var b=this;var a=null;if(this.lastBM!==undefined){a=this.lastBM}else{var c=new NAPI.Bookmarks();a=c.last()}if(!isNaN(a)){KidsBox.Singleton.NavigatorModel.gotoPage(a);KidsBox.Singleton.FooterModel.set("bookpage",a)}};NetexTemplateToolsApi.prototype.fillBookmarkList=function(){var a=this;var c=new NAPI.Bookmarks();var b=c.list();$('#bookmarkList[rel="sb"], #bookmarkList[rel="wb"]').html("");if(b!==""){for(var e in b){var d="sb";if(b[e].isWorkbook=="true"){d="wb"}$('#bookmarkList[rel="'+d+'"]').append('<li>\n								<span class="sprite icon-trash pull-left" \n									onclick="NAPI.removeBookmark('+b[e].bookpage+');"></span>\n								<a href="javascript:;" rel="gotoBookmark" \n									data-theme-id="'+b[e].themeId+'" \n									data-bookpage="'+b[e].bookpage+'">\n									Unit '+b[e].themeId+" - Page "+arrayPageNumbers[b[e].bookpage]+"								</a>\n							</li>")}}};NetexTemplateToolsApi.prototype.range=undefined;NetexTemplateToolsApi.prototype.newStickyNote=function(b,d,c){var a=new NAPI.StickyNotes();a["new"](b,Math.floor(d),Math.floor(c))};NetexTemplateToolsApi.prototype.newAttachment=function(a,d,c){var b=new NAPI.Attachments();b["new"](a,Math.floor(d),Math.floor(c))};var NAPI=new NetexTemplateToolsApi();
NetexTemplateToolsApi.prototype.CanvasBindings=function(){this.rubber={color:"#00ff00",style:"round",width:30};this.init=function(){this.bindCollapse();this.bindPointer();this.bindPencil();this.bindMarker();this.bindRubber();this.bindPalette()};this.bindCollapse=function(){$("#collapseTool").unbind().bind("click",function(){var a=$(".canvas-tools .wrap");if(a.width()>1){$("#pencilMenu, #markerMenu, #paletteMenu, #rubberMenu").hide();$("#canvasTools .wrap").css("overflow","hidden").stop().animate({width:1},500,function(){$("#canvasTools .collapse").removeClass("icon-toolbar-open").addClass("icon-toolbar-close")})}else{$("#canvasTools .wrap").stop().animate({width:292},500,function(){$(this).css("overflow","visible");$("#canvasTools .collapse").addClass("icon-toolbar-open").removeClass("icon-toolbar-close");NAPI.getDraggableBoundaries(document.querySelector("#canvasTools"),$("#canvasTools").position(),null)})}})};this.activeTool=function(a){$("#canvasTools .wrap > div").removeClass("active");a.addClass("active")};this.bindPointer=function(){var a=this;$("#selectPointer").unbind().bind("click",function(){if(NetexCanvas.canvasId.substring(0,8)!=="freeDraw"){$("canvas").each(function(){$(this).css("background-color","transparent")});$("#pencilMenu, #markerMenu, #paletteMenu, #rubberMenu").hide();if(NetexCanvas.rubberActive===true){NetexCanvas.rubberActive=false;a.restorePencil()}NetexCanvas.pointerActive=true}else{NetexCanvas.pointerActive=true}a.activeTool($(this))})};this.bindPencil=function(){var a=this;$("#selectPencil").unbind().bind("click",function(){var d=$(this).find("#pencilMenu");if(d.is(":visible")){d.hide()}else{d.show();var c=NetexCanvas.canvasId.replace("canvas_","");if(NetexCanvas.canvasId.substring(0,8)!=="freeDraw"&&parseInt(c)!==parseInt(NAPI._currentBookPage())){NetexCanvas._init("canvas_"+NAPI._currentBookPage())}else{NetexCanvas.show()}a.bindPencilStrokes($(this));var b={x:$("#canvasTools").position().left,y:$("#canvasTools").position().top-d.height()};NAPI.getDraggableBoundaries(document.querySelector("#canvasTools"),b,d.height())}if(NetexCanvas.rubberActive===true){NetexCanvas.rubberActive=false;a.restorePencil()}$("#markerMenu, #paletteMenu, #rubberMenu").hide()})};this.bindMarker=function(){var a=this;$("#selectMarker").unbind().bind("click",function(){var d=$(this).find("#markerMenu");if(d.is(":visible")){d.hide()}else{d.show();var c=NetexCanvas.canvasId.replace("canvas_","");if(NetexCanvas.canvasId.substring(0,8)!=="freeDraw"&&parseInt(c)!==parseInt(NAPI._currentBookPage())){NetexCanvas._init(NAPI._currentBookPage())}else{NetexCanvas.show()}a.bindMarkerStrokes($(this));var b={x:$("#canvasTools").position().left,y:$("#canvasTools").position().top-d.height()};NAPI.getDraggableBoundaries(document.querySelector("#canvasTools"),b,d.height())}if(NetexCanvas.rubberActive===true){NetexCanvas.rubberActive=false;a.restorePencil()}$("#pencilMenu, #paletteMenu, #rubberMenu").hide()})};this.bindRubber=function(){var a=this;$("#selectRubber").unbind().bind("click",function(d){var f=$(this).find("#rubberMenu");if(f.is(":visible")&&d.target.id==="selectRubber"){f.hide()}else{f.show();var c=NetexCanvas.canvasId.replace("canvas_","");if(NetexCanvas.canvasId.substring(0,8)!=="freeDraw"&&parseInt(c)!==parseInt(NAPI._currentBookPage())){NetexCanvas._init(NAPI._currentBookPage())}else{NetexCanvas.show()}a.bindRubberOptions();var b={x:$("#canvasTools").position().left,y:$("#canvasTools").position().top-f.height()};NAPI.getDraggableBoundaries(document.querySelector("#canvasTools"),b,f.height())}$("#pencilMenu, #paletteMenu, #markerMenu").hide()})};this.bindRubberOptions=function(){var a=this;a.bindClearAll();a.bindRubberTool()};this.bindRubberTool=function(){var a=this;$("#selectRubberTool").unbind().bind("click",function(){NetexCanvas.pointerActive=false;NetexCanvas.show();NetexCanvas.rubberActive=true;NetexCanvas.changePencil(a.rubber.style);NetexCanvas.changePencilWidth(a.rubber.width);NetexCanvas.changeColor(a.rubber.color);setTimeout(function(){$("#pencilMenu, #markerMenu, #paletteMenu, #rubberMenu").hide()},50);a.activeTool($("#selectRubber"))})};this.bindClearAll=function(){var a=this;$("#selectClearAll").unbind().bind("click",function(){NetexCanvas.clearAll();setTimeout(function(){$("#pencilMenu, #markerMenu, #paletteMenu, #rubberMenu").hide()},50)})};this.bindPalette=function(){var a=this;$("#selectPalette").unbind().bind("click",function(){var d=$(this).find("#paletteMenu");if(d.is(":visible")){d.hide()}else{d.show();var c=NetexCanvas.canvasId.replace("canvas_","");if(NetexCanvas.canvasId.substring(0,8)!=="freeDraw"&&parseInt(c)!==parseInt(NAPI._currentBookPage())){NetexCanvas._init(NAPI._currentBookPage())}else{NetexCanvas.show()}a.bindPaletteColors();var b={x:$("#canvasTools").position().left,y:$("#canvasTools").position().top-d.height()};NAPI.getDraggableBoundaries(document.querySelector("#canvasTools"),b,d.height())}if(NetexCanvas.rubberActive===true){NetexCanvas.rubberActive=false;a.restorePencil()}$("#pencilMenu, #markerMenu, #rubberMenu").hide()})};this.bindPencilStrokes=function(b){var a=this;var c=$("#pencilMenu");c.find(".pencil-stroke").each(function(){var d=$(this);$(this).unbind().bind("click",function(){NetexCanvas.pointerActive=false;if(NetexCanvas.rubberActive===true){NetexCanvas.rubberActive=false;a.restorePencil()}a.activeTool(b);NetexCanvas.changePencil("round");NetexCanvas.changePencilWidth(d.attr("rel"));NetexCanvas.changeColor(NetexCanvas.context.strokeStyle)})})};this.bindMarkerStrokes=function(b){var a=this;var c=$("#markerMenu");c.find(".marker-stroke").each(function(){var d=$(this);$(this).unbind().bind("click",function(){NetexCanvas.pointerActive=false;if(NetexCanvas.rubberActive===true){NetexCanvas.rubberActive=false;a.restorePencil()}a.activeTool(b);NetexCanvas.changePencil("square");NetexCanvas.changePencilWidth(d.attr("rel"));NetexCanvas.changeColor(NetexCanvas.context.strokeStyle)})})};this.bindPaletteColors=function(){var b=$("#paletteMenu");var a=this;b.find(".palette-color").each(function(){var c=$(this);$(this).unbind().bind("click",function(){if(NetexCanvas.pointerActive===true){a.activeTool($("#canvasTools #selectPencil"))}NetexCanvas.pointerActive=false;NetexCanvas.rubberActive=false;NetexCanvas.changeColor(c.attr("rel"))})})};this.restorePencil=function(){NetexCanvas.pointerActive=false;NetexCanvas.changePencil("round");NetexCanvas.changePencilWidth(10);NetexCanvas.changeColor("#000");this.activeTool($("#canvasTools #selectPencil"))};this.init()};
KidsBox.Model.PageModel=Backbone.Model.extend({defaults:{pageId:null,pageNumber:null,html:null,text:null,themeId:null,isWorkbook:false}});
KidsBox.Model.CurrentPageModel=Backbone.Model.extend({defaults:{pageId:null,pageNumber:null,html:null,classType:null,position:null,rendered:null,marker:null,unmarker:null,link:null,linkUrl:null,unlink:null,zoomLevel:0}});
KidsBox.Model.NavigatorModel=Backbone.Model.extend({defaults:{current:null,teacher:false,courseVisible:true,textToFind:null,titleIntroduction:null,updateTitle:null,rangeBookPages:null},cb:new NAPI.CanvasBindings(),goNext:function(){var a=KidsBox.Singleton.PagesCollection.getIdByPosition(this.get("current")+1);if(a!==null){KidsBox.Singleton.CourseRouter.navigate("#/pag/"+a,{trigger:true});KidsBox.Singleton.FooterModel.set("bookpage",a);this.cb.activeTool($("#selectPointer"))}$("#themesMenu").slideUp(300)},goPrev:function(){var a=KidsBox.Singleton.PagesCollection.getIdByPosition(this.get("current")-1);if((this.get("current")-1)===0){this.goHome();this.cb.activeTool($("#selectPointer"))}else{if(a!==null){KidsBox.Singleton.CourseRouter.navigate("#/pag/"+a,{trigger:true});KidsBox.Singleton.FooterModel.set("bookpage",a);this.cb.activeTool($("#selectPointer"))}}$("#themesMenu").slideUp(300)},gotoPage:function(a){if(KidsBox.Singleton.PagesCollection.getIdByPosition(a)!==-1){KidsBox.Singleton.CourseRouter.navigate("#/pag/"+a,{trigger:true});this.cb.activeTool($("#selectPointer"))}else{alert("Theme not found")}},setCurrentById:function(b){var a=KidsBox.Singleton.PagesCollection.getPositionById(b);if(a!==-1){this.cb.activeTool($("#selectPointer"));this.set("current",+a)}else{this.notFound()}},setCurrentByThemeId:function(b){var a=KidsBox.Singleton.PagesCollection.getPositionByThemeId(b);if(a!==-1){this.set("current",+a)}else{this.notFound()}},notFound:function(){KidsBox.Singleton.CourseRouter.navigate("",{trigger:true})},goHome:function(){this.cb.activeTool($("#selectPointer"));KidsBox.Singleton.CourseRouter.navigate("",{trigger:true});KidsBox.Singleton.PageModelA.set("zoomLevel",0);KidsBox.Singleton.PageModelB.set("zoomLevel",0);KidsBox.Singleton.PageModelC.set("zoomLevel",0)}});
KidsBox.Model.PopupModel=Backbone.Model.extend({defaults:{popupId:null,html:null,themeId:null}});
KidsBox.Model.CurrentPopupModel=Backbone.Model.extend({defaults:{html:null,idTheme:null,type:null,visible:null,current:null},setCurrentById:function(b){var a=KidsBox.Singleton.PopupCollection.getById(b);if(a!==null){this.set("html",a.get("html"));this.set("visible",true)}else{this.set("visible",false)}return a},setCurrentByThemeId:function(b,c){if(!c){c="audio"}var a=KidsBox.Singleton.PopupCollection.getByThemeId(b,c);if(a!==null){this.set("html",a.get("html"));this.set("visible",true)}else{this.set("visible",false)}return a}});
KidsBox.Model.FooterModel=Backbone.Model.extend({defaults:{bookpage:undefined,themeId:undefined}});
KidsBox.Model.ThemeModel=Backbone.Model.extend({defaults:{themeId:null,text:null}});
KidsBox.Model.HighLightModel=Backbone.Model.extend({defaults:{page:null,selection:null}});
KidsBox.Model.LinkResourceModel=Backbone.Model.extend({defaults:{pageId:null,resourceId:null,url:null}});
KidsBox.Model.NotesModel=Backbone.Model.extend({defaults:{content:"",noteId:null}});
KidsBox.Model.BookMarkModel=Backbone.Model.extend({defaults:{bookMarkTitle:"",bookMarkId:null,bookMarkUrl:null}});
KidsBox.Model.SearchModel=Backbone.Model.extend({defaults:{title:null,numberResults:null,url:null,textToFind:null}});
KidsBox.Model.CurrentResourceLinkModel=Backbone.Model.extend({defaults:{selection:null,url:"http://"}});
KidsBox.Collection.PagesCollection=Backbone.Collection.extend({model:KidsBox.Model.PageModel,getModelByPosition:function(a){return(a>=0&&a<this.length)?this.at(a):null},getIdByPosition:function(b){var a=this.getModelByPosition(b);return a===null?null:a.get("pageId")},getIdThemeByPosition:function(b){var a=this.getModelByPosition(b);return a===null?null:a.get("themeId")},getHtmlByPosition:function(b){var a=this.getModelByPosition(b);return a===null?"":a.get("html")},getPositionById:function(b){return this.getIdByPosition(b);var a=this.filter(function(c){return _.intersection(c.get("pageNumber").split(","),b.split(",")).length>0});return a.length>0?this.indexOf(a[0]):-1},getPositionByThemeId:function(a){return this.indexOf(this.findWhere({themeId:a}))},search:function(a){},getIdCurrentTheme:function(){var a=this.getModelByPosition(KidsBox.Singleton.NavigatorModel.get("current"));return a===null?null:a.get("themeId")},getIdCurrentPage:function(){var a=this.getModelByPosition(KidsBox.Singleton.NavigatorModel.get("current"));return a===null?null:a.get("pageNumber")},isFirstPage:function(){return(KidsBox.Singleton.NavigatorModel.get("current")===0)},isLastPage:function(){return(KidsBox.Singleton.NavigatorModel.get("current")===(this.length-1))}});
KidsBox.Collection.CurrentPagesCollection=Backbone.Collection.extend({model:KidsBox.Model.CurrentPageModel,aClassTypes:["devPagePrev","devPageCurrent","devPageNext"],initialize:function(){this.listenTo(KidsBox.Singleton.NavigatorModel,"change:current",this.updatePages)},updatePages:function(){var f=KidsBox.Singleton.NavigatorModel.get("current"),a=[(f-1),f,(f+1)],g=this.pluck("position"),b=_.intersection(a,g),c=_.difference(g,a),e=_.difference(a,b),d;for(d=0;d<b.length;d++){this.findWhere({position:b[d]}).set({classType:this.aClassTypes[_.indexOf(a,b[d])]})}for(d=0;d<c.length;d++){this.findWhere({position:c[d]}).set({pageNumber:KidsBox.Singleton.PagesCollection.getIdByPosition(e[d]),classType:this.aClassTypes[_.indexOf(a,e[d])],html:KidsBox.Singleton.PagesCollection.getHtmlByPosition(e[d]),position:e[d]})}},updateMarker:function(a){this.findWhere({classType:this.aClassTypes[1]}).set("marker",a)},updateUnMarker:function(a){this.findWhere({classType:this.aClassTypes[1]}).set("unmarker",a)},updateLink:function(c,b){var a=this.findWhere({classType:this.aClassTypes[1]});a.set("linkUrl",b);a.set("link",c)},updateUnLink:function(a){this.findWhere({classType:this.aClassTypes[1]}).set("unlink",a)},updateSearchHighLight:function(a){this.findWhere({classType:this.aClassTypes[1]}).set("search",a)}});
KidsBox.Collection.PopupCollection=Backbone.Collection.extend({model:KidsBox.Model.PopupModel,getById:function(b){var a=this.where({popupId:b});return a.length===1?a[0]:null},getByThemeId:function(a,b){if(!b){b="audio"}var c=this.where({themeId:a,type:b});return c.length===1?c[0]:null}});
KidsBox.Collection.ThemeCollection=Backbone.Collection.extend({model:KidsBox.Model.ThemeModel,getText:function(){var a=KidsBox.Singleton.PagesCollection.getIdCurrentTheme(),b;if(a===""){b=""}else{if(a!==null){b=this.findWhere({themeId:a}).get("text")}else{b=KidsBox.Singleton.NavigatorModel.get("titleIntroduction")}}return b},getTitleById:function(b){var a=this.where({themeId:b});return a.length===1?a[0].get("text"):""},getCurrentPos:function(){var a=this.indexOf(this.findWhere({themeId:KidsBox.Singleton.PagesCollection.getIdCurrentTheme()}));return a===-1?9999:a},gotoNextTheme:function(){var a=this.getCurrentPos();if(a!==9999){a=a+1;if(a<this.length-1){KidsBox.Singleton.CourseRouter.navigate("#/tema/"+this.at(a).get("themeId"),{trigger:true})}}},gotoPrevTheme:function(){var a=this.getCurrentPos();if(a!==9999){a=a-1;if(a>=0){KidsBox.Singleton.CourseRouter.navigate("#/tema/"+this.at(a).get("themeId"),{trigger:true})}}}});
KidsBox.Collection.HighLightCollection=Backbone.Collection.extend({model:KidsBox.Model.HighLightModel,localStorage:KidsBox.isLocalAndIE?null:new Backbone.LocalStorage("Santunomex_HighLight_"+KidsBox.CourseId),getByPage:function(a){var b=this.where({pageId:a});return b.length===1?b[0].get("selection"):null},updateByPage:function(a,c){var d=this.where({pageId:a});if(d.length===1){d[0].set("selection",c);d[0].save()}else{var b=new KidsBox.Model.HighLightModel({pageId:a,selection:c});this.add(b);b.save()}}});
KidsBox.Collection.LinkResourceCollection=Backbone.Collection.extend({model:KidsBox.Model.LinkResourceModel,localStorage:KidsBox.isLocalAndIE?null:new Backbone.LocalStorage("Santunomex_Resource_"+KidsBox.CourseId),addLink:function(a,d,c){var b=new KidsBox.Model.LinkResourceModel({pageId:a,resourceId:d,resourceUrl:c});this.add(b);b.save()},removeLink:function(a,b){this.findWhere({pageId:a,resourceId:b}).destroy()},getResource:function(a,c){var b=this.where({pageId:a,resourceId:c});return b.length===1?b[0].get("resourceUrl"):null}});
KidsBox.Collection.NotesCollection=Backbone.Collection.extend({model:KidsBox.Model.NotesModel,localStorage:KidsBox.isLocalAndIE?null:new Backbone.LocalStorage("Santunomex_Notes_"+KidsBox.CourseId)});
KidsBox.Collection.BookMarkCollection=Backbone.Collection.extend({model:KidsBox.Model.BookMarkModel,localStorage:KidsBox.isLocalAndIE?null:new Backbone.LocalStorage("Santunomex_BookMark_"+KidsBox.CourseId),validateModels:function(){_.each(this.models,function(a){if(a.get("bookMarkUrl").substring(0,2)==="./"){a.set("bookMarkUrl",a.get("bookMarkUrl").substring(2))}})},addNewModel:function(b){var a=new KidsBox.Model.BookMarkModel({bookMarkTitle:b,bookMarkId:_.uniqueId(),bookMarkUrl:"#/pag/"+KidsBox.Singleton.PagesCollection.getIdCurrentPage()});this.add(a);a.save()}});
KidsBox.Collection.SearchCollection=Backbone.Collection.extend({model:KidsBox.Model.SearchModel,getTotResult:function(){var a=0;for(var b=0;b<this.length;b++){a+=+(this.at(b).get("numberResults"))}return a},getTextToFind:function(){return this.at(0).get("textToFind")}});
KidsBox.View.PageView=Backbone.View.extend({events:{"click .tool-link":"resourceClick","click .main-image":"clickMainImage","click #btnPrev":"goPrev","click #btnNext":"goNext","click #zoomIn":"zoomIn","click #zoomOut":"zoomOut","click #zoomReset":"zoomReset","click #closeTack":"closeTack","keyup .sticky-note-text":"changeNoteContent","change .sticky-note-text":"changeNoteContent","click #minimizeTack":"minimizeTack","click #maximizeTack":"maximizeTack","click .stickyNote .icon-save":"saveStickyNote","click .floating-elements .icon-aside-open":"openCloseAside","click .floating-elements .icon-sound":"openIndividualAudioPlayer","click .floating-elements .icon-vbox":"openActivity"},initialize:function(){this.imgdrag=undefined;this.canvasToolsBinded=false;this.listenTo(this.model,"change:html",this.render);this.listenTo(this.model,"change:rendered",this.rendered);this.listenTo(this.model,"change:classType",this.setClass);this.listenTo(this.model,"change:marker",this.setMarker);this.listenTo(this.model,"change:unmarker",this.setUnMarker);this.listenTo(this.model,"change:link",this.setLink);this.listenTo(this.model,"change:unlink",this.setUnLink);this.listenTo(this.model,"change:zoomLevel",this.zoomImage);this.listenTo(KidsBox.Singleton.CurrentPopupModel,"change:visible",this.overlay);this.listenTo(KidsBox.Singleton.CurrentPopupModel,"change:current",this.popupcurrentchange);this.listenTo(KidsBox.Singleton.NavigatorModel,"change:current",this.updatePage)},render:function(){var b=this;this.model.set("rendered",false);var a="<script>KidsBox.Singleton.CurrentPagesCollection.at("+KidsBox.Singleton.CurrentPagesCollection.indexOf(this.model)+").set('rendered',true);<\/script>";this.$el.empty().append(this.model.get("html")+a);this.loadSavedStickyNotes();$(document).ready(function(){setTimeout(function(){b.loadSavedAttachments()},10)});this.bindCanvasTools();this.zoomReset();this.maskReset();NetexCanvas.pointerActive=true;return this},clickMainImage:function(d){var f=$(d.currentTarget).offset(),c=d.clientX-f.left,b=d.clientY-f.top,a=NAPI._currentBookPage();if(NAPI.holdNoteClick===true){NAPI.newStickyNote(a,c,b);NAPI.holdNoteClick=false}if(NAPI.holdAttachmentClick===true){NAPI.newAttachment(a,c,b);NAPI.holdAttachmentClick=false}},changeNoteContent:function(a){$(a.currentTarget).parent().find(".icon-save").addClass("icon-save-alert")},bindCanvasTools:function(){var a=this;setTimeout(function(){$("#btnNext, #btnPrev").css({top:"50%",marginTop:"-24px"})},10)},goNext:function(a){if(a){a.preventDefault()}KidsBox.Singleton.NavigatorModel.goNext()},goPrev:function(a){if(a){a.preventDefault()}KidsBox.Singleton.NavigatorModel.goPrev()},updatePage:function(){this.closeIndividualAudioPlayer()},CurrentModel:function(){return KidsBox.Singleton.PageModelB},maskReset:function(){if($(".mask-square").length>0){$(".mask-square").each(function(){$(this).remove()})}},zoomIn:function(d){var a=this;var c=this.CurrentModel().get("zoomLevel");var b=c;if(c<1){b=c+1}else{return}$("#canvasTools").hide();this.CurrentModel().set("zoomLevel",b);if(this.imgdrag===undefined){this.imgdrag=new Draggabilly(document.querySelector("#images_"+NAPI._currentBookPage()));this.imgdrag.on("dragEnd",function(i,h,g){var f=$("#images_"+NAPI._currentBookPage());a.viewImageBoundaries(f)})}$("#canvas_"+NAPI._currentBookNumber()).hide();$("#images_"+NAPI._currentBookNumber()).addClass("imgdragging")},zoomOut:function(c){var b=this.CurrentModel().get("zoomLevel");var a=b;if(b>0){a=b-1}$("#canvasTools").show();this.CurrentModel().set("zoomLevel",a);if(a===0&&this.imgdrag!==undefined){this.imgdrag.disable();this.imgdrag=undefined;$("#images_"+NAPI._currentBookNumber()).removeClass("imgdragging").css({left:0,top:0,"z-index":2})}if(a===0){$("#canvas_zoom_"+NAPI._currentBookNumber()).hide()}},zoomReset:function(a){this.CurrentModel().set("zoomLevel",0);if(this.imgdrag){this.imgdrag.disable();this.imgdrag=undefined;$("#images_"+NAPI._currentBookNumber()).removeClass("imgdragging").css({left:0,top:0,"z-index":2})}$("#canvasTools").show();$("#canvas_zoom_"+NAPI._currentBookNumber()).hide()},zoomImage:function(d){$("#selectPointer").click();var b=this,f=this.CurrentModel().get("zoomLevel"),a=NAPI._currentBookPage(),c;switch(f){case 1:c=1264;break;case 2:c=1896;break;default:c=632;break}$("#images_"+a+' img[rel="normal"]').stop().animate({width:(c+"px")},500,function(){b.viewImageBoundaries($("#images_"+NAPI._currentBookPage()));if(f===0){NetexCanvas.restoreScale();$("#canvas_"+NAPI._currentBookNumber()).show()}else{NetexCanvas.scaleAndDraw()}})},viewImageBoundaries:function(b){var c=parseInt(b.css("left").replace("px","")),g=parseInt(b.css("top").replace("px","")),i=this.CurrentModel().get("zoomLevel"),j=$(".devPageCurrent .main-content"),f=parseInt(j.width())-parseInt(b.find("img[rel=normal]").width()),e=parseInt(j.height())-parseInt(b.height()),h=200,a={left:f,top:e},d={left:undefined,top:undefined};if(i>0){if(c>0&&g<=0){d.left=0;d.top=undefined}if(c>0&&g>0){d.left=0;d.top=0}if(c<=0&&g>0){d.left=undefined;d.top=0}if(c<=a.left&&g>a.top){d.left=a.left;d.top=undefined}if(c>a.left&&g<=a.top){d.left=undefined;d.top=a.top}if(c<=a.left&&g<=a.top){d.left=a.left;d.top=a.top}if(c>0&&g<=a.top){d.left=0;d.top=a.top}if(c<=a.left&&g>0){d.left=a.left;d.top=0}if(d.left!==undefined&&d.top!==undefined){b.animate({left:d.left,top:d.top},h)}else{if(d.left!==undefined&&d.top===undefined){b.animate({left:d.left},h)}else{if(d.left===undefined&&d.top!==undefined){b.animate({top:d.top},h)}}}}else{if(this.imgdrag!==undefined){this.imgdrag.disable();this.imgdrag=undefined;$("#images_"+NAPI._currentBookPage()).css({left:0,top:0,"z-index":2,cursor:"default"})}}},closeIndividualAudioPlayer:function(a){$(".individual-audio").find(".transcript-layer").removeClass("open");$(".individual-audio").find("#audio-player").html("");$(".individual-audio").fadeOut(200)},openIndividualAudioPlayer:function(d){var a=this;var b=$(".individual-audio").css("left","-600px").show();b.find(".transcript-layer").removeClass("open");b.find(".transcript-button").html("Show transcript");$("#highlightTextIndividual").hide();this.fillIndividualPlayer($(d.currentTarget),b);b.stop().animate({left:80},500);var f=b.find(".icon-close-xviolet");var c=b.find(".transcript-button");f.unbind().bind("click",function(){a.closeIndividualAudioPlayer(d)});new Draggabilly(document.querySelector("#individualAudio"),{handle:".movingHandle",containment:true});c.unbind().bind("click",function(){a.showHideAudioTranscript(b)})},fillIndividualPlayer:function(b,a){var c=b.find(".devEditTranscript > div").html();a.find(".transcript-layer").html(c);a.find("#audio-player").html(this.loadAudioContainer("audio/mp3",b.attr("data-audio-rel")));this.initAudioVideoMediaElement(a.find("#audio-player audio"),"audio")},showHideAudioTranscript:function(a){a.find(".transcript-layer").toggleClass("open");if(a.find(".transcript-layer").hasClass("open")){a.find(".transcript-button").html("Hide transcript");$("#highlightTextIndividual").show();$(".individual-audio .transcript-layer.open").css("overflow-y","auto")}else{a.find(".transcript-button").html("Show transcript");$("#highlightTextIndividual").hide()}},loadAudioContainer:function(a,b){return'<audio width="555" height="30" controls class="audioKidsBoxArrastrar violeta" preload="none">\n					<source src="'+b+'" type="'+a+'" />\n				</audio>'},moveIndividualAudioPlayer:function(){NAPI.holdMoveAudioPlayer=true;$(".individual-audio").css({opacity:0.65})},moveIndividualAudioPlayerTo:function(b,a){$(".individual-audio").css({left:b,top:a,opacity:1})},openActivity:function(f){var c=this;var b=$(f.currentTarget).attr("data-id");var a=KidsBox.Activities[b];var d=KidsBox.Activities.dummy;$("#activityPopup iframe").attr("src",((a)?a:d));$("#activityPopup, .dark-background").css("visibility","visible").show();if(NAPI.isTouch()&&!(!!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/)))){$("#iframeWrapper").attr("style","height: 888px; overflow: auto; -webkit-overflow-scrolling:touch")}$("#activityPopup #closeActivityPopup").unbind().bind("click",function(){c.closeActivity()})},closeActivity:function(){$("#activityPopup, .dark-background").css("visibility","hidden").hide();$("#activityPopup iframe").attr("src","about:blank")},openCloseAside:function(b){var a=$(b.currentTarget).parent();a.toggleClass("closed")},closeTack:function(c){var a=this;var b=$(c.currentTarget).parent();$(".dark-background").show().css("visibility","visible");$("#sticky-delete-confirm").show();$("#sticky-delete-confirm #deleteNoteYes").unbind().bind("click",function(d){a.deleteStickyNote(b);b.remove();$("#sticky-delete-confirm").hide();$(".dark-background").hide()});$("#sticky-delete-confirm #deleteNoteNo").unbind().bind("click",function(d){$("#sticky-delete-confirm").hide();$(".dark-background").hide()})},minimizeTack:function(g){var c=$(g.currentTarget);c.hide();c.parent().find("#maximizeTack").show();c.parent().removeClass("sticky-note-open").addClass("sticky-note-closed");var h=new NAPI.StickyNotes();var a=c.parent().attr("rel-bookpage"),f=c.parent().attr("rel-left"),d=c.parent().attr("rel-top");var b=h.getByPosition(a,f,d);h.setState(b,"closed")},maximizeTack:function(g){var c=$(g.currentTarget);c.hide();c.parent().find("#minimizeTack").show();c.parent().removeClass("sticky-note-closed").addClass("sticky-note-open");var h=new NAPI.StickyNotes();var a=c.parent().attr("rel-bookpage"),f=c.parent().attr("rel-left"),d=c.parent().attr("rel-top");var b=h.getByPosition(a,f,d);h.setState(b,"open")},saveStickyNote:function(f){var b=$(f.currentTarget).parent();var d=b.find("textarea").val();var a=new NAPI.StickyNotes();var g=+b.css("left").replace("px","");var c=+b.css("top").replace("px","");a.save(+b.attr("rel-bookpage"),+b.attr("rel-left"),+b.attr("rel-top"),d,g,c);b.attr("rel-left",g);b.attr("rel-top",c)},deleteStickyNote:function(b){var a=new NAPI.StickyNotes();a["delete"](+b.attr("rel-bookpage"),+b.attr("rel-left"),+b.attr("rel-top"))},loadSavedStickyNotes:function(){var a=new NAPI.StickyNotes();$(".stickyNote.sticky-note-open, .stickyNote.sticky-note-closed").each(function(){$(this).remove()});a.renderAllNotesByBookpage(NAPI._currentBookPage())},loadSavedAttachments:function(){var a=new NAPI.Attachments();$(".attachment").each(function(){$(this).remove()});setTimeout(function(){$(".attachment").each(function(){$(this).remove()});a.renderAllAttachmentsByBookpage(NAPI._currentBookPage())},300)},popupcurrentchange:function(){var a=KidsBox.Singleton.CurrentPopupModel.get("current");if(a!==-1){this.updateCurrentSlider(a)}},overlay:function(a){if(KidsBox.Singleton.CurrentPopupModel.get("visible")){this.$(".overlay").show()}else{this.$(".overlay").hide()}},sliderImg:function(a){this.updateCurrentSlider($(a.currentTarget).attr("data-slider-btn"))},updateCurrentSlider:function(a){this.$("figure[data-slider-img]").removeClass("devCurrent");this.$("figure[data-slider-img='"+a+"']").addClass("devCurrent");this.$("div[data-slider-btn]").removeClass("contents-slider-page-on").addClass("contents-slider-page");this.$("div[data-slider-btn='"+a+"']").addClass("contents-slider-page-on")},changeAudioTranscript:function(c){var b=$(c.currentTarget).attr("data-popup-id");this.$("div.modalDialog-transcript").hide();this.$('div.modalDialog-transcript[data-popup-id="'+b+'"]').show();var a=this;this.$("video:visible").each(function(){a.initAudioVideoMediaElement($(this),"video")});this.$("audio:visible").each(function(){a.initAudioVideoMediaElement($(this),"audio")});this.changeTranscriptArrow(b)},changeTranscriptArrow:function(c){this.$("span.contents-transcripts-transcript-ico-triangle").remove();var a=$("<span/>").attr("class","contents-transcripts-transcript-ico-triangle");var b=$('div.contents-transcripts-transcript[data-popup-id="'+c+'"]');b.before(a)},unmarkSearch:function(){},markSearch:function(){if(this.isCurrent()){this.unmarkSearch();var c=KidsBox.Singleton.NavigatorModel.get("textToFind");if(c!==null){var a=rangy.createCssClassApplier("devSearch"),b=rangy.createRange();while(b.findText(c)){a.applyToRange(b);b.collapse(false)}KidsBox.Singleton.NavigatorModel.set("textToFind",null)}}},popup:function(a){a.preventDefault();KidsBox.Singleton.CurrentPopupModel.setCurrentById($(a.currentTarget).attr("href").replace("#",""));if($(a.currentTarget).attr("data-popup-current")){KidsBox.Singleton.CurrentPopupModel.set("current",$(a.currentTarget).attr("data-popup-current"))}},setClass:function(){this.$el.removeClass().addClass(this.model.get("classType"));this.$el.css("transform","none").css("height","100%");this.checkStatus()},viewShow:function(){this.zoomReset();this.$el.show();this.viewAfterShow()},adapt:function(a,b){if((a.height()*2)<b.height()){b.css("font-size",+(+(b.css("font-size").replace("px",""))-1)+"px");b.css("line-height",+(+(b.css("line-height").replace("px",""))-1)+"px");this.adapt(a,b)}},adaptUnitNumber:function(a){if((80)<a[0].scrollWidth){a.css("font-size",+(+(a.css("font-size").replace("px",""))-1)+"px");this.adaptUnitNumber(a)}},viewAfterShow:function(){var d=this.$(".header-section");if(d.length>0){this.adapt(d,d.find("h1"))}var b=this.$(".unit-number");if(b.length>0){this.adaptUnitNumber(b)}this.markSearch();var c=KidsBox.Singleton.HighLightCollection.getByPage(this.model.get("pageId"));if(c!==null){}if(KidsBox.isAndroid_40_41&&(window.location.toString().indexOf("http")===-1)){this.$(".module > audio:visible").each(function(){var e=$(this).find("source[type='audio/mpeg']").attr("src");$(this).replaceWith('<video width="1" height="1" controls="controls" preload="none" class="audioLikeVideo" src="'+e+'" poster="http://dummyimage.com/1x1/000/f7f7f7&amp;text=Audio+resource"></video>')})}var a=this;this.$("video:visible, audio:visible").each(function(){a.initAudioVideoMediaElement($(this))});this.$el.trigger("pageViewAfterShow");$("html:not(:animated),body:not(:animated)").animate({scrollTop:0})},viewHide:function(){this.zoomReset();this.$el.hide();this.pauseAudioVideo($("body"))},checkStatus:function(){if(this.model.get("rendered")&&this.isCurrent()){this.viewShow()}else{this.viewHide()}},isCurrent:function(){return this.model.get("classType")==="devPageCurrent"},rendered:function(){this.checkStatus()},setMarker:function(){if(this.model.get("marker")!==null){KidsBox.Singleton.Highlighter.highlightSelection("devHighlight",this.model.get("marker"),this.$el.attr("id"));KidsBox.Singleton.HighLightCollection.updateByPage(this.model.get("pageId"),KidsBox.Singleton.Highlighter.serialize());this.model.set("marker",null)}},setUnMarker:function(){if(this.model.get("unmarker")!==null){KidsBox.Singleton.Highlighter.unhighlightSelection(this.model.get("unmarker"));KidsBox.Singleton.HighLightCollection.updateByPage(this.model.get("pageId"),KidsBox.Singleton.Highlighter.serialize());this.model.set("unmarker",null)}},setLink:function(){if(this.model.get("link")!==null){var a=_.map(KidsBox.Singleton.Highlighter.highlights,function(d){return d.id});KidsBox.Singleton.Highlighter.highlightSelection("tool-link",this.model.get("link"),this.$el.attr("id"));KidsBox.Singleton.HighLightCollection.updateByPage(this.model.get("pageId"),KidsBox.Singleton.Highlighter.serialize());var c=_.map(KidsBox.Singleton.Highlighter.highlights,function(d){return d.id});var b=_.difference(c,a);if(b.length===1){KidsBox.Singleton.LinkResourceCollection.addLink(this.model.get("pageId"),b[0],this.model.get("linkUrl"))}this.model.set("link",null)}},setUnLink:function(){if(this.model.get("unlink")!==null){var a=_.map(KidsBox.Singleton.Highlighter.highlights,function(d){return d.id});KidsBox.Singleton.Highlighter.unhighlightSelection(this.model.get("unlink"));KidsBox.Singleton.HighLightCollection.updateByPage(this.model.get("pageId"),KidsBox.Singleton.Highlighter.serialize());var c=_.map(KidsBox.Singleton.Highlighter.highlights,function(d){return d.id});var b=_.difference(a,c);if(b.length===1){KidsBox.Singleton.LinkResourceCollection.removeLink(this.model.get("pageId"),b[0])}this.model.set("unlink",null)}},resourceClick:function(b){b.preventDefault();var a=KidsBox.Singleton.LinkResourceCollection.getResource(this.model.get("pageId"),KidsBox.Singleton.Highlighter.getHighlightForElement(b.target).id);if(a!==null){window.open(a)}},pauseAudioVideo:function(a){$(a).find("audio, video").each(function(){try{if(typeof this.pause!="undefined"){this.pause()}if(typeof this.player!="undefined"){if(typeof this.player.pause!="undefined"){this.player.pause()}}}catch(b){}})},initAudioVideoMediaElement:function(b,c){var a=$("<div/>");a.addClass("veladura");if(c==="audio"){b.mediaelementplayer({alwaysShowControls:true,videoWidth:500,videoHeight:30,features:["playpause","current","progress","duration","volume"],success:function(d,e){$(".mejs-container").find(".mejs-layers").hide();$(".mejs-container .mejs-time-total,.mejs-container .mejs-horizontal-volume-slider").append(a)}})}else{b.mediaelementplayer({alwaysShowControls:true,videoWidth:"100%",videoHeight:390,features:["playpause","current","progress","duration","volume","fullscreen"],success:function(d,e){}})}}});
KidsBox.View.NavigatorView=Backbone.View.extend({events:$.extend(KidsBox.Main.normalizeEvents({"click #openThemeMenu":"openThemeMenu","click #openWorkBookMenu":"openWorkBookMenu","click #btnGotoPage":"gotoPage","click a[id^='popuplink_']":"popup","click .openMedia":"openMenu","click #openAudioPopup":"openMediaPopup","click #openVideoPopup":"openMediaVideoPopup","click #openFlashcardsPopup":"openFlashcardsPopup","click #lastBookmark":"lastBookmark","click #openLinksMenu":"openLinksPopup","click #openResourcesMenu":"openResourcesPopup","click #openBookmarkMenu":"openBookmarkPopup","click #addBookmark":"addBookmark","click #toolSearch":"toolSearch","click #btnHome":"goHome","click #btnTools":"tools","click #btnMenu":"menu","click #addNote":"addNoteListener","click #addAttachment":"addAttachmentListener",click:"disableMask","click .menu-tool-close":"closeToolMenu","click #openCanvas":"openCanvas","click #createMask":"createMask"}),{"click .dropdown-menu-theme a":"closeMenus"}),flashCardTimeout:300,oldSelection:null,lockFlashcard:false,fPrevent:function(a){a.preventDefault()},initialize:function(){this.listenTo(this.model,"change:current",this.updateTxtCurrent);this.listenTo(this.model,"change:teacher",this.updateTeacher);this.listenTo(this.model,"change:courseVisible",this.navigatorVisible);KidsBox.Singleton.CourseView.on("courseTouch",this.updateCssPosition2,this)},updateCssPosition:function(a){},updateCssPosition2:function(){var a=this.$el;setTimeout(function(){},100)},render:function(){return this},openMenu:function(d){var a=this;var c=$(d.currentTarget).find(".subnav-triple, .subnav-double");if(c.is(":visible")){c.hide()}else{if(KidsBox.Singleton.CurrentPopupModel.get("current")!==null){KidsBox.Singleton.CurrentPopupModel.set("current",null)}a.hideAllElementsOpen();setTimeout(function(){c.show()},40)}this.hideMenuTheme();this.hideWBMenu();this.disableMask()},hideAllElementsOpen:function(){setTimeout(function(){$(".subnav-triple, .subnav-double").each(function(){if($(this).is(":visible")){$(this).hide()}})},20)},hideMenuTheme:function(){if($("#themesMenu").is(":visible")){$("#themesMenu").slideUp(300)}},openThemeMenu:function(){var a=this;var d=new NAPI.Bookmarks();$("#themesMenu").slideToggle(300);var c=0;$("#themesMenu > li").each(function(){c++;var f=$(this);$(this).unbind().click(function(g){g.preventDefault();$(".subnav-list-index").each(function(){$(this).hide()});a.calculatePagesMenuPosition(f.find(".subnav-list-index"));a.openBookPage()})});$(".subnav-list-index > a.item").each(function(){if(parseInt($(this).attr("data-bookpage"))===parseInt(NAPI._currentBookPage())){$(this).animate({opacity:1});$(this).css("border","2px solid #08699C")}else{$(this).animate({opacity:0.85});$(this).css("border","0px")}if(d.exists($(this).attr("data-bookpage"))){$(this).addClass("bookmarked")}else{$(this).removeClass("bookmarked")}});a.hideWBMenu();a.hideAllElementsOpen();if(KidsBox.Singleton.CurrentPopupModel.get("current")!==null){KidsBox.Singleton.CurrentPopupModel.set("current",null)}},hideWBMenu:function(){if($("#workbookMenu").is(":visible")){$("#workbookMenu").slideUp(300)}},calculatePagesMenuPosition:function(d){var a=$("#themesMenu > li").length;var c=d.parent().attr("data-theme-id");if((a/2)>=c){d.css("top","0")}else{d.css("bottom","0")}d.show()},openWorkBookMenu:function(){var a=this;var c=new NAPI.Bookmarks();$("#workbookMenu").slideToggle(300);$("#workbookMenu > li").each(function(){var d=$(this);$(this).unbind().click(function(f){f.preventDefault();$(".subnav-list-index").each(function(){$(this).hide()});a.calculatePagesMenuPosition(d.find(".subnav-list-index"));a.openBookPage()})});$(".subnav-list-index > a.item").each(function(){if(parseInt($(this).attr("data-bookpage"))===parseInt(NAPI._currentBookPage())){$(this).animate({opacity:1});$(this).css("border","2px solid #DB552D")}else{$(this).animate({opacity:0.87});$(this).css("border","0px")}if(c.exists($(this).attr("data-bookpage"))){$(this).addClass("bookmarked")}else{$(this).removeClass("bookmarked")}});a.hideMenuTheme();a.hideAllElementsOpen();if(KidsBox.Singleton.CurrentPopupModel.get("current")!==null){KidsBox.Singleton.CurrentPopupModel.set("current",null)}},openBookPage:function(){var a=this;$(".subnav-list-index .item").unbind().bind("click",function(){var c=$(this).attr("data-bookpage");a.gotoPageById(c);KidsBox.Singleton.FooterModel.set("bookpage",c);a.hideMenuTheme();a.hideWBMenu()})},openMediaPopup:function(c){c.preventDefault();var a=NAPI._currentThemeId();var d=KidsBox.Singleton.CurrentPopupModel.setCurrentByThemeId(a,"audio");this.showAnimatedPopup();if(d&&d.attributes.popupId){KidsBox.Singleton.CurrentPopupModel.set("current",d.attributes.popupId)}else{alert("Audio gallery not found in this unit")}this.hideAllElementsOpen();this.hideMenuTheme()},openMediaVideoPopup:function(d){d.preventDefault();var a=NAPI._currentThemeId();var f=KidsBox.Singleton.CurrentPopupModel.setCurrentByThemeId(a,"video");var c=$(".video-list ul li:first-child img");this.loadFirstVideo(c);this.showAnimatedPopup();if(f&&f.attributes.popupId){KidsBox.Singleton.CurrentPopupModel.set("current",f.attributes.popupId)}else{alert("Video gallery not found in this unit")}this.hideAllElementsOpen();this.hideMenuTheme()},loadFirstVideo:function(d){var i=d.attr("data-rel-mp4");var h=d.attr("data-rel-ogg");var g=d.attr("src");var c,f;if(!i){c="video/ogg";f=h}else{c="video/mp4";f=i}var a=$(".devPopupContainer .video-reproductor");a.find("video").attr("poster",g);a.find("video > source").attr({type:c,src:f});this.initAudioVideoMediaElement(a.find("video"))},initAudioVideoMediaElement:function(a,c){if(c==="audio"){a.mediaelementplayer({alwaysShowControls:true,videoWidth:500,videoHeight:30,features:["playpause","current","progress","duration","volume"],success:function(d,f){a.find(".mejs-layers").hide()}})}else{a.mediaelementplayer({alwaysShowControls:true,videoWidth:500,videoHeight:270,features:["playpause","current","progress","duration","volume","fullscreen"],success:function(d,f){a.find(".mejs-layers").hide()}})}},openFlashcardsPopup:function(c){var a=this;if(KidsBox.Singleton.CurrentPopupModel.get("current")==="flashcards"){return KidsBox.Singleton.CurrentPopupModel.set("current",null)}var d=KidsBox.Singleton.CurrentPopupModel.setCurrentById("flashcards");$("#popupContainer .subnav-full").show();if(d.attributes.popupId){KidsBox.Singleton.CurrentPopupModel.set("current",d.attributes.popupId)}$(".flashcards-thumbs > ul > li").each(function(){if(Number($(this).attr("data-rel-themeid"))===Number(NAPI._currentThemeId())||$(this).attr("data-rel-themeid")===""){$(this).show()}else{var f=a.transformArrayInt($(this).attr("data-rel-themeid").split(","));if(a.inArray(Number(NAPI._currentThemeId()),f)){$(this).show()}else{$(this).hide()}}});this.bindFlashCards();this.showAnimatedPopup(true);this.hideAllElementsOpen();this.hideMenuTheme()},resetFlipFlashcard:function(c){var a=this;if($.support.transition!=null){c.transition({rotateY:"-90deg"},a.flashCardTimeout,function(){a.lockFlashcard=false;$(this).parent().find("img").transition({rotateY:"0deg"},a.flashCardTimeout)})}else{$(this).parent().find("img").fadeIn();$(this).fadeOut();a.lockFlashcard=false}},bindFlashCards:function(){var a=this;var c=$(".flashcards-thumbs ul li img");var d=$(".flashcards-thumbs ul li");d.unbind("click").bind("click",function(g){g.preventDefault();var h=$(this).find("img").attr("data-title");var f=($(this).find("img").attr("data-rel-fullscreen"))?$(this).find("img").attr("data-rel-fullscreen"):$(this).find("img").attr("src");a.activeFlashcard($(this).find("img"));a.openFullFlashcard(f,h)});$("#flashcardsGoLeft").unbind().bind("click",function(){a.moveFlashcards("left")});$("#flashcardsGoRight").unbind().bind("click",function(){a.moveFlashcards("right")})},bindTouchFlashCards:function(){var a=this;var c=$(".flashcards-thumbs ul li img");var d=c.parent().find(".flashcard-back");c.unbind("click").bind("click",function(g){if($.support.transition){var f=$(this).parent().find(".flashcard-back");setTimeout(function(){a.resetFlipFlashcard(f)},(a.flashCardTimeout*10));$(this).transition({rotateY:"90deg"},a.flashCardTimeout,function(){$(this).parent().find(".flashcard-back").transition({rotateY:"0deg"},a.flashCardTimeout)})}else{$(".flashcard-back").fadeOut()}});d.unbind("click").bind("click",function(g){g.preventDefault();var h=$(this).parent().find("img").attr("data-title");var f=($(this).parent().find("img").attr("data-rel-fullscreen"))?$(this).parent().find("img").attr("data-rel-fullscreen"):$(this).parent().find("img").attr("src");a.activeFlashcard($(this).parent().find("img"));a.openFullFlashcard(f,h)})},openFullFlashcard:function(a,c){this.resetFullflashcard();$("#fullFlashcard").fadeIn(350);$("#fullFlashcard .flashcard-back").html(c);$("#fullFlashcard #iframeWrapper").find("img").attr("src",a);this.bindFullscreenFlashcard();$("#fullFlashcard #closeFlashcardPopup").unbind().bind("click",function(){$(this).parent().fadeOut(250)})},resetFullflashcard:function(){var a=this;var c=$(".flashcard-wrapper-fullscreen img");var d=c.parent().find(".flashcard-back");if($.support.transition!=null){c.attr("src","").transition({rotateY:0},0);d.html("").transition({rotateY:"-90deg"},0)}else{c.attr("src","");d.html("");$(e).fadeOut();$(b).fadeIn()}},bindFullscreenFlashcard:function(){var a=this;var c=$(".flashcard-wrapper-fullscreen img");var d=c.parent().find(".flashcard-back");c.unbind("click").bind("click",function(g){var f=$(this).parent().find(".flashcard-back");if($.support.transition!=null){$(this).transition({rotateY:"90deg"},a.flashCardTimeout,function(){$(this).parent().find(".flashcard-back").transition({rotateY:"0deg"},a.flashCardTimeout)})}else{$(this).fadeOut();$(this).parent().find(".flashcard-back").fadeIn()}});d.unbind("click").bind("click",function(f){f.preventDefault();if($.support.transition!=null){a.resetFlipFlashcard($(this))}else{$(this).fadeOut();c.fadeIn()}})},activeFlashcard:function(a){$(".flashcards-thumbs ul li").each(function(){$(this).removeClass("active")});a.parent().addClass("active")},moveFlashcards:function(i){var c=this,d=$(".flashcards-thumbs ul"),g=parseInt($(".flashcards-thumbs ul").css("left").replace("px","")),h=parseInt($(".flashcards-thumbs ul li:first-child").width()+30),a=c.calculateFlashcardsWidth()*-1;switch(i){case"left":if(g<0){var f=(h+g);if(f>0||(f<0&&f>-20)){f=0}d.stop().animate({left:f},300)}break;case"right":if(g>=(a+(h*2))){var f=(g-h);d.stop().animate({left:f},300)}break}},calculateFlashcardsWidth:function(){var c=$(".flashcards-thumbs ul");var a=0;c.find("li:visible").each(function(){a=a+$(this).outerWidth()+20});return a},openBookmarkPopup:function(a){if(KidsBox.Singleton.CurrentPopupModel.get("current")==="bookmarks"){return KidsBox.Singleton.CurrentPopupModel.set("current",null)}var c=KidsBox.Singleton.CurrentPopupModel.setCurrentById("bookmarks");$("#popupContainer .subnav-full").show();if(c.attributes.popupId){KidsBox.Singleton.CurrentPopupModel.set("current",c.attributes.popupId)}NAPI.fillBookmarkList();this.showAnimatedPopup();this.hideAllElementsOpen();this.hideMenuTheme()},addBookmark:function(a){if(NAPI._currentBookPage()>0){NAPI.addBookmark()}},lastBookmark:function(a){NAPI.lastBookmark()},openLinksPopup:function(a){if(KidsBox.Singleton.CurrentPopupModel.get("current")==="links"){return KidsBox.Singleton.CurrentPopupModel.set("current",null)}var c=KidsBox.Singleton.CurrentPopupModel.setCurrentById("links");$("#popupContainer .subnav-full").show();if(c.attributes.popupId){KidsBox.Singleton.CurrentPopupModel.set("current",c.attributes.popupId)}this.showAnimatedPopup();this.hideAllElementsOpen();this.hideMenuTheme();this.hideWBMenu();this.fillCustomLinks()},fillCustomLinks:function(){var g=new NAPI.Links(),c=g._getSplitted(),f=$("#linkList");f.find('li[rel="linkRemovable"]').each(function(){$(this).remove()});for(var d in c){if(c[d][0]&&c[d][1]){var a=$('<li rel="linkRemovable" data-url="'+c[d][1]+'" data-name="'+c[d][0]+'"><span class="sprite icon-trash pull-left remove-custom-link"></span><a href="http://'+c[d][1]+'" target="_blank">'+c[d][0]+"</li>");f.append(a)}}},openResourcesPopup:function(c){var a=this;if(KidsBox.Singleton.CurrentPopupModel.get("current")==="resources"){return KidsBox.Singleton.CurrentPopupModel.set("current",null)}var d=KidsBox.Singleton.CurrentPopupModel.setCurrentById("resources");$("#popupContainer .subnav-full").show();if(d.attributes.popupId){KidsBox.Singleton.CurrentPopupModel.set("current",d.attributes.popupId)}$("#popupContainer ul.custom-list > li").each(function(){if(Number($(this).attr("data-rel-themeid"))===Number(NAPI._currentThemeId())||$(this).attr("data-rel-themeid")===""){$(this).show()}else{var f=a.transformArrayInt($(this).attr("data-rel-themeid").split(","));if(a.inArray(Number(NAPI._currentThemeId()),f)){$(this).show()}else{$(this).hide()}}});this.showAnimatedPopup();this.hideAllElementsOpen();this.hideMenuTheme();this.hideWBMenu()},showAnimatedPopup:function(a){$("#popupContainer .audio-reproductor, #popupContainer #showTranscript").hide();if(a){$("#popupContainer .subnav-full").hide().parent().css("top","-500px")}else{$("#popupContainer .subnav-full").hide().parent().css("top","-500px")}if(NAPI._currentBookPage()>0){$("#popupContainer .subnav-full").show().parent().stop().animate({top:40},1000)}else{$("#popupContainer .subnav-full").show().parent().stop().animate({top:0},1000)}},addNoteListener:function(){setTimeout(function(){NAPI.holdNoteClick=true},500)},addAttachmentListener:function(){var c=(function(){return(((/MSIE (\d+\.\d+);/.test(navigator.userAgent)===true)||(!!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/)))))})();var d=!!(window.File&&window.FileList&&window.FileReader&&window.Blob);var a=navigator.userAgent;var f=((a.indexOf("Mozilla/5.0")>-1&&a.indexOf("Android ")>-1&&a.indexOf("AppleWebKit")>-1)&&!(a.indexOf("Chrome")>-1));if(NAPI.idbSupport===false||!d||f||c){NAPI.alertNoAttachments()}else{setTimeout(function(){NAPI.holdAttachmentClick=true},500)}},openCanvas:function(a){if(typeof(a)==="object"){$(".numberFreeCanvas").html("1")}if(!a||typeof(a)==="object"){a=1}this.disableNavigationButtons();$("canvas#freeDraw_1,canvas#freeDraw_2,canvas#freeDraw_3").css("background-color","white").css("display","none");$("canvas#freeDraw_"+a).css("background-color","white").css("display","block");$("#freeDrawTools").show();$("#canvasTools").show();this.hideAllElementsOpen();this.hideMenuTheme();this.hideWBMenu();if(KidsBox.Singleton.CurrentPopupModel.get("current")!==null){KidsBox.Singleton.CurrentPopupModel.set("current",null)}new NAPI.CanvasBindings();NetexCanvas._init("freeDraw_"+a);this.bindFreeCanvasTools();this.disableMask()},bindFreeCanvasTools:function(){var a=this,c=$("#freeDrawTools");c.find(".close-canvas").unbind().bind("click",function(){a.enableNavigationButtons();$("#freeDrawTools").hide();$("canvas").css("background-color","transparent").hide();if(KidsBox.Singleton.PagesCollection.isFirstPage()){$("#canvasTools").hide()}else{NetexCanvas._init("canvas_"+NAPI._currentBookPage())}});c.find("#btnCanvasPrev").unbind().bind("click",function(d){d.preventDefault();a.goPrevFreeCanvas()});c.find("#btnCanvasNext").unbind().bind("click",function(d){d.preventDefault();a.goNextFreeCanvas()})},getFreeCanvasPage:function(){return Number($(".numberFreeCanvas").text())},setFreeCanvasPage:function(c){var a=this.getFreeCanvasPage();$(".numberFreeCanvas").html(c);this.changeFreeCanvasPage(c,a)},goPrevFreeCanvas:function(){var a=this.getFreeCanvasPage()-1;if(a>0&&a<=3){this.setFreeCanvasPage(a)}},goNextFreeCanvas:function(){var a=this.getFreeCanvasPage()+1;if(a>0&&a<=3){this.setFreeCanvasPage(a)}},changeFreeCanvasPage:function(c,a){this.openCanvas(c)},disableNavigationButtons:function(){var c="only-inside-theme";var d="only-disabled-canvas";var a=this;$("nav.navbar ul > li.menu-item").each(function(){var f=$(this);if(f.attr("rel")===c||f.attr("rel")===d){f.animate({opacity:0.4});f.click(function(){return false})}})},enableNavigationButtons:function(){if(NAPI._currentBookPage()>0){var a="only-inside-theme";var c="only-disabled-canvas";$("nav.navbar ul > li.menu-item").each(function(){var d=$(this);if(d.attr("rel")===a||d.attr("rel")===c){d.animate({opacity:1});d.unbind("click")}})}else{var c="only-disabled-canvas";$("nav.navbar ul > li.menu-item").each(function(){var d=$(this);if(d.attr("rel")===c){d.animate({opacity:1});d.unbind("click")}})}},disableMask:function(){NAPI.maskBinded=false;NAPI.holdCreateMask=false},createMask:function(){var a=this;setTimeout(function(){a.hideAllElementsOpen();a.hideMenuTheme();a.hideWBMenu();if(KidsBox.Singleton.CurrentPopupModel.get("current")!==null){KidsBox.Singleton.CurrentPopupModel.set("current",null)}if(NAPI.maskBinded===false){NAPI.bindCreateMask()}NAPI.holdCreateMask=true},100)},inArray:function(f,d){var c=d.length;for(var a=0;a<c;a++){if(d[a]==f){return true}}return false},transformArrayInt:function(d){var c=new Array();for(var a in d){c.push(Number(d[a]))}return c},navigatorVisible:function(){if(this.model.get("courseVisible")){this.$el.show()}else{this.$el.hide()}},goHome:function(a){if(a){a.preventDefault()}this.model.goHome()},goNext:function(a){if(a){a.preventDefault()}this.model.goNext()},goPrev:function(a){if(a){a.preventDefault()}this.model.goPrev()},gotoPage:function(a){if(a){a.preventDefault()}this.model.gotoPage(this.$("#txtCurrent").val())},gotoPageById:function(a){this.model.gotoPage(a)},toolSearch:function(a){a.preventDefault();var c=$(a.currentTarget).parent();if(c.hasClass("selected")){c.removeClass("selected");c.find(".dropdown-search").hide();this.$("#toolSearch").focus()}else{this.closeMenus();c.addClass("selected");c.find(".dropdown-search").show();this.$("#txtSearch").focus()}},search:function(c){c.preventDefault();var a=this.$("#txtSearch").val();if(a.length>0){this.$("#txtSearch").val("");this.model.set("textToFind",a);KidsBox.Singleton.PagesCollection.search(this.model.get("textToFind"));this.closeMenus()}},searchText:function(a){this.model.set("textToFind",a);KidsBox.Singleton.PagesCollection.search(this.model.get("textToFind"))},updateTxtCurrent:function(){var c=KidsBox.Singleton.PagesCollection.getIdByPosition(this.model.get("current")),a=this.$("a[data-idpage-rel='"+c+"']");this.$("#txtCurrent").val(c);this.$(".dropdown-menu-theme > li").removeClass("current");if(a.length>0){a.parent().addClass("current");this.$("#btnMenu").html('<span class="icon icon-mini icon-dropdown"></span> '+a.text())}},keypressCurrent:function(a){if(a.which===13){this.gotoPage(a)}},keypressSearch:function(a){if(a.which===13){this.search(a)}},txtCurrentFocus:function(a){setTimeout(function(){var c=document.getElementById("txtCurrent");c.setSelectionRange(0,c.value.length)},100)},tools:function(a){this.oldSelection=rangy.getSelection();a.preventDefault();var c=$(a.currentTarget).parent();if(c.hasClass("selected")){c.removeClass("selected");c.find(".dropdown-menu").hide()}else{this.closeMenus();c.addClass("selected");c.find(".dropdown-menu").show()}},menu:function(a){a.preventDefault();var c=$(a.currentTarget).parent();if(c.hasClass("selected")){c.removeClass("selected");c.find(".dropdown-menu").hide()}else{this.closeMenus();c.addClass("selected");c.find(".dropdown-menu").show()}},updateTeacher:function(){if(this.model.get("teacher")){this.$("#toolTeacher").parent().addClass("current");this.$el.trigger("teacherMode")}else{this.$("#toolTeacher").parent().removeClass("current");this.$el.trigger("studentMode")}},marker:function(a){if(a){a.preventDefault()}KidsBox.Singleton.CurrentPagesCollection.updateMarker(this.getSelection());this.oldSelection=null},unmarker:function(a){if(a){a.preventDefault()}KidsBox.Singleton.CurrentPagesCollection.updateUnMarker(this.getSelection());this.oldSelection=null},noteAndBookmark:function(c){c.preventDefault();var a=$(c.currentTarget).parent();if(a.hasClass("current")){a.removeClass("current")}else{this.closeToolMenu(c);a.addClass("current")}},closeMenus:function(){var a=this.$(".dropdown-search");a.hide();a.parent().removeClass("selected");var c=this.$(".dropdown-menu");c.hide();c.parent().removeClass("selected")},closeToolMenu:function(a){a.preventDefault();this.$("#toolsMenu").find("li:not(:last)").removeClass("current")},link:function(c){if(c){c.preventDefault()}if(rangy.getSelection().toHtml()!==""){KidsBox.Singleton.CurrentResourceLinkModel.set("selection",this.getSelection());var a=$(c.currentTarget).parent();if(a.hasClass("current")){a.removeClass("current")}else{this.closeToolMenu(c);a.addClass("current")}this.oldSelection=null}},unlink:function(a){if(a){a.preventDefault()}KidsBox.Singleton.CurrentPagesCollection.updateUnLink(this.getSelection());this.oldSelection=null},teacher:function(a){a.preventDefault();this.model.set("teacher",!this.model.get("teacher"))},teacherTrue:function(){this.model.set("teacher",true)},teacherFalse:function(){this.model.set("teacher",false)},getSelection:function(){return this.oldSelection!==null?this.oldSelection:rangy.getSelection()}});
KidsBox.View.FooterView=Backbone.View.extend({events:{"click #footerToggle":"toggle","click .footer-navbar-item":"goBookpage","click #footerGoLeft":"goLeft","click #footerGoRight":"goRight",},initialize:function(){this.listenTo(this.model,"change:bookpage",this.activePage);var a=this;setTimeout(function(){a.model.set("themeId",NAPI._currentThemeId());a.model.set("bookpage",NAPI._currentBookPage());a.activePage(a.model.bookpage)},500);this.render()},render:function(){if(NAPI.isTouch()&&!(!!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/)))){this.$el.find(".library").css("overflow-x","scroll")}return this},toggle:function(){var a=this.$el.find("footer");if(a.hasClass("footer-navbar-open")){a.attr("class","footer-navbar-closed");a.find("#footerToggle").css({transform:"rotate(180deg)","margin-top":"-5px"})}else{a.attr("class","footer-navbar-open");a.find("#footerToggle").css({transform:"rotate(0deg)","margin-top":"0"});setTimeout(function(){var d=document.getElementById("canvasTools"),b=window.getComputedStyle(d),c={x:parseInt(b.getPropertyValue("left").replace("px","")),y:parseInt(b.getPropertyValue("top").replace("px",""))};NAPI.getDraggableBoundaries(d,c)},500)}},Navigator:function(){return KidsBox.Singleton.NavigatorModel},goBookpage:function(f){var b=this.$(f.currentTarget);var d=b.attr("data-bookpage");var a=KidsBox.Singleton.PageModelA.get("pageNumber");var c=b.attr("data-theme-id");this.Navigator().gotoPage(d);this.model.bookpage=d;this.model.themeId=c;this.activePage(d);var g=this.$el.find("footer");if(g.hasClass("footer-navbar-closed")){g.find("#footerToggle").css({transform:"rotate(180deg)","margin-top":"-5px"})}else{g.find("#footerToggle").css({transform:"rotate(0deg)","margin-top":"0"})}},showWorkbook:function(){$('footer .library[rel="workbook"]').removeClass("hide");$('footer .library[rel="studentsbook"]').addClass("hide")},showStudentsBook:function(){$('footer .library[rel="studentsbook"]').removeClass("hide");$('footer .library[rel="workbook"]').addClass("hide")},activePage:function(a){if(NAPI.isWorkbook()===true){this.showWorkbook()}else{this.showStudentsBook()}if(typeof a==="object"||!a){this.model.bookpage=NAPI._currentBookPage()}a=this.model.bookpage;this.$el.find("li.footer-navbar-item").each(function(){$(this).removeClass("active")});if(this.$el.find('li.footer-navbar-item[data-bookpage="'+a+'"]').is(":last-child")){$("#footerGoRight").fadeOut();$(".devPageCurrent").find("#btnNext").fadeOut()}else{$("#footerGoRight").fadeIn();$(".devPageCurrent").find("#btnNext").fadeIn()}if(this.$el.find('li.footer-navbar-item[data-bookpage="'+a+'"]').is(":first-child")){$("#footerGoLeft").fadeOut();$(".devPageCurrent").find("#btnPrev").fadeOut()}else{$("#footerGoLeft").fadeIn();$(".devPageCurrent").find("#btnPrev").fadeIn()}this.$el.find('li.footer-navbar-item[data-bookpage="'+a+'"]').addClass("active");this.moveSlider();this.model.themeId=NAPI._currentThemeId()},goLeft:function(b){var a=this.model.bookpage;if(!this.$el.find('.library:not(.hide) li.footer-navbar-item[data-bookpage="'+a+'"]').is(":first-child")){this.$el.find('.library:not(.hide) li.footer-navbar-item[data-bookpage="'+a+'"]').prev().click()}$(".main-footer footer").attr("class","footer-navbar-open")},goRight:function(b){var a=this.model.bookpage;if(!this.$el.find('.library:not(.hide) li.footer-navbar-item[data-bookpage="'+a+'"]').is(":last-child")){this.$el.find('.library:not(.hide) li.footer-navbar-item[data-bookpage="'+a+'"]').next().click()}$(".main-footer footer").attr("class","footer-navbar-open")},moveSlider:function(){var c=this;var b=this.model.bookpage;var a=this.elementPosition(b);if(a===undefined){a={left:0}}if(a!==0&&(!a||!a.left)&&b>0){$(".devPageCurrent #breadcrum").show();this.model.bookpage=NAPI._currentBookPage();var a={left:0};this.$el.find('li.footer-navbar-item[data-bookpage="1"]').addClass("active");setTimeout(function(){c.moveSlider()},200)}var d=$("footer .library:not(.hide)").width();$("ul.footer-navbar-items").stop().animate({left:((a.left-((d/2)-39.5))*-1)+"px"},300)},getTouch:function(a){return(a.originalEvent.touches[0]||a.originalEvent.changedTouches[0])},moveTouchSlider:function(d){var a=$(d.currentTarget),f=a.offset(),c=parseInt(a.css("left").replace("px","")),b=(((f.left-c)-this.getTouch(d).pageX)*-1);a.css("left",b+"px")},elementPosition:function(a){var b;var c=(this.model.bookpage)?this.model.bookpage:NAPI._currentBookPage();if(!a){b=$('.library:not(.hide) li.footer-navbar-item[data-bookpage="'+c+'"]')}else{b=$('.library:not(.hide) li.footer-navbar-item[data-bookpage="'+a+'"]')}return b.position()},footerWidth:function(){var b=this.$(".library:not(.hide) ul.footer-navbar-items");var a=0;b.find("li").each(function(){a=a+$(this).outerWidth()});return a}});
KidsBox.View.CourseView=Backbone.View.extend({events:{"touchstart #highlightTextIndividual":"highlightText","mousedown #highlightTextIndividual":"highlightText",},ww:null,initTouchX:null,initTouchY:null,isSwipeLeft:null,isSwipeRight:null,devPagePrev:null,devPageNext:null,initialize:function(){this.listenTo(this.model,"change:teacher",this.updateTeacher);this.listenTo(this.model,"change:courseVisible",this.courseVisible);this.checkBestWork()},render:function(){return this},highlightText:function(a){a.preventDefault();NAPI.range.applyToSelection()},updateTeacher:function(){if(this.model.get("teacher")){this.$el.addClass("devTeacher");this.trigger("teacherVisible")}else{this.$el.removeClass("devTeacher");this.trigger("teacherInvisible")}},touchstart:function(a){if(NAPI.holdCreateMask===false){this.trigger("courseTouch");this.ww=$(window).width();this.isSwipe=null;this.initTouchX=this.getTouch(a).pageX;this.initTouchY=this.getTouch(a).pageY;this.isSwipeLeft=((this.initTouchX<(this.ww*0.1))&&(!KidsBox.Singleton.PagesCollection.isFirstPage()));this.isSwipeRight=((this.initTouchX>(this.ww-this.ww*0.1))&&(!KidsBox.Singleton.PagesCollection.isLastPage()));this.devPagePrev=this.$(".devPagePrev");this.devPageNext=this.$(".devPageNext")}},touchmove:function(a){if(NAPI.holdCreateMask===false){if((a.originalEvent.touches.length===1)&&(this.isSwipeLeft||this.isSwipeRight)){var b=this.getTouch(a);if(Math.abs(b.pageX-this.initTouchX)>Math.abs(b.pageY-this.initTouchY)){a.preventDefault();if(this.isSwipeLeft){this.devPagePrev.css({display:"block","z-index":100000,position:"absolute"}).height(1000).css("transform","translate3d("+(+(-100+((b.pageX/this.ww)*100)))+"%,0,0) scale3d(1,1,1)")}else{this.devPageNext.css({display:"block","z-index":100000,position:"absolute"}).height(1000).css("transform","translate3d("+(+((b.pageX/this.ww)*100))+"%,0,0) scale3d(1,1,1)")}}}}},touchend:function(b){if(NAPI.holdCreateMask===false){this.trigger("courseTouch");var a=(Math.abs(this.getTouch(b).pageX-this.initTouchX)>((this.ww/5)/(screen.width/window.innerWidth)));if(a){if(this.isSwipeLeft){this.model.goPrev()}if(this.isSwipeRight){this.model.goNext()}this.$("devPagePrev, .devPageNext, .devPageCurrent").css({position:"relative","z-index":0})}else{this.$(".devPagePrev, .devPageNext").css({display:"none","z-index":0,position:"relative"});this.$(".devPagePrev, .devPageNext, .devPageCurrent").css("transform","none").css({height:"auto","z-index":0,position:"relative"})}}},getTouch:function(a){return(a.originalEvent.touches[0]||a.originalEvent.changedTouches[0])},courseVisible:function(){if(this.model.get("courseVisible")){this.$el.show()}else{this.$el.hide()}},checkBestWork:function(){$("#bestWork").hide();var b=navigator.userAgent;var c=(function(){return(((/MSIE (\d+\.\d+);/.test(b)===true)||(!!(b.match(/Trident/)&&b.match(/rv:11/)))))})();var a=b.indexOf("Opera")>-1;if(c||a){NAPI.alertBestWork()}}});
KidsBox.View.PopupView=Backbone.View.extend({events:{"click div.button-close":"close","click a[rel=gotoBookmark]":"gotoBookmark","click img[data-action=loadVideo]":"loadVideo","click .audios":"loadAudio","click #showTranscript":"showTranscript","click div[data-slider-btn]":"updateCurrent","click .remove-custom-link":"removeCustomLink","click div[data-btn-showTeacher]":"showHideTeacher","click .add-link-button":"addLink","touchstart #highlightText":"highlightText","mousedown #highlightText":"highlightText"},highlighter:null,highlightActive:false,initialize:function(){this.listenTo(this.model,"change:html",this.render);this.listenTo(this.model,"change:visible",this.visible);this.listenTo(this.model,"change:current",this.showCurrent)},render:function(){this.$el.empty().append(this.model.get("html"));return this},showCurrent:function(){if(this.model.get("current")===null){var a=this;$("#popupContainer").stop().animate({top:-850},300,function(){a.close()})}},highlightListener:function(a){a.preventDefault()},highlightText:function(b){if(!this.highlighter){this.highlighter=rangy.createHighlighter();this.highlighter.addClassApplier(NAPI.range)}var a=this;this.$("#transcript > div").each(function(c,d){if($(d).is(":visible")){a.highlighter.highlightSelection("highlighted",null,$(d).attr("id"))}})},visible:function(){if(this.model.get("visible")){this.$el.show();var a=this;this.$("video:visible").each(function(){a.initAudioVideoMediaElement($(this),"video")});this.$("audio:visible").each(function(){a.initAudioVideoMediaElement($(this),"audio")})}else{this.close();this.$el.hide()}},addLink:function(b){var a=this;$(".dark-background").show().css("visibility","visible");$("#addLinkWindow").show();$("#addLinkInputName").focus();$("#addLinkWindow .icon-add-link-confirm").unbind().bind("click",function(g){var f=$("#addLinkInputName"),d=$("#addLinkInputUrl"),c;if(f.val().length>0&&d.val().length>0){if(d.val().substring(0,7)==="http://"){c=d.val().replace("http://","")}else{c=d.val()}var h=new NAPI.Links();h.add(f.val(),c);$("#addLinkWindow").hide();$(".dark-background").hide();f.val("");d.val("");a.fillCustomLinks()}else{alert("Please, fill all the fields in the form")}});$("#addLinkWindow .icon-add-link-cancel").unbind().bind("click",function(c){$("#addLinkWindow").hide();$(".dark-background").hide()})},fillCustomLinks:function(){var e=new NAPI.Links(),b=e._getSplitted(),d=$("#linkList");d.find('li[rel="linkRemovable"]').each(function(){$(this).remove()});for(var c in b){if(b[c][0]&&b[c][1]){var a=$('<li rel="linkRemovable" data-url="'+b[c][1]+'" data-name="'+b[c][0]+'"><span class="sprite icon-trash pull-left remove-custom-link"></span><a href="http://'+b[c][1]+'" target="_blank">'+b[c][0]+"</li>");d.append(a)}}},removeCustomLink:function(d){var c=$(d.currentTarget),b=c.parent().attr("data-url"),a=c.parent().attr("data-name");var f=new NAPI.Links();f.remove(a,b);this.fillCustomLinks()},gotoBookmark:function(b){var a=$(b.currentTarget).attr("data-bookpage");KidsBox.Singleton.NavigatorModel.gotoPage(a);KidsBox.Singleton.FooterModel.set("bookpage",a)},close:function(a){if(a){a.preventDefault()}KidsBox.Singleton.NavigatorModel.set("courseVisible",true);this.model.set("html","");this.model.set("current",-1);this.model.set("visible",false)},updateCurrent:function(a){this.model.set("current",$(a.currentTarget).attr("data-slider-btn"))},showHideTeacher:function(a){this.$el.toggleClass("devShowTeacher")},loadAudio:function(c){var b=$(c.currentTarget);var d=$(b).attr("rel");var f=$(b).attr("rel-id");b.parent().find(".audios").each(function(){$(this).css("color","#fff")});b.css("color","#D5A07E");var a=this.$el.find(".audio-reproductor");a.empty();a.html(this.loadAudioContainer("audio/mp3",d));$("#popupContainer .audio-reproductor, #popupContainer #showTranscript").show();$("#currentAudioId").attr("value",f);this.hideAllTranscripts();this.initAudioVideoMediaElement(a.find("audio"),"audio")},loadVideo:function(d){var c=$(d.currentTarget);var i=c.attr("data-rel-mp4");var h=c.attr("data-rel-ogg");var g=c.attr("src");var b,f;if(!i){b="video/ogg";f=h}else{b="video/mp4";f=i}var a=this.$el.find(".video-reproductor");a.empty();a.html(this.loadVideoContainer(b,f,g));this.initAudioVideoMediaElement(a.find("video"))},showTranscript:function(b){var a=$("#currentAudioId").val();if(!$('#transcript .transcription[id="trans_'+a+'"]').is(":visible")){$('#transcript .transcription[id="trans_'+a+'"]').show();$("#showTranscript p").html("Hide transcript");$("#highlightText").show();$('#transcript .transcription[id="trans_'+a+'"]').css("overflow-y","auto")}else{$('#transcript .transcription[id="trans_'+a+'"]').hide();$("#showTranscript p").html("Show transcript");$("#highlightText").hide()}},hideAllTranscripts:function(a){$("#transcript .transcription").each(function(){$(this).hide()});$("#highlightText").hide();$("#showTranscript p").html("Show transcript")},loadAudioContainer:function(a,b){return'<audio width="660" height="30" controls class="audioKidsBoxArrastrar popup" preload="none">\n					<source src="'+b+'" type="'+a+'" />\n				</audio>'},loadVideoContainer:function(a,b,c){return'<video width="500" height="270" poster="'+c+'" controls preload="none">\n					<source src="'+b+'" type="'+a+'" />\n				</video>'},initAudioVideoMediaElement:function(b,c){var a=$("<div/>");a.addClass("veladura");if(c==="audio"){b.mediaelementplayer({alwaysShowControls:true,videoWidth:500,videoHeight:30,features:["playpause","current","progress","duration","volume"],success:function(d,e){$(".mejs-container").find(".mejs-layers").hide();$(".mejs-container .mejs-time-total,.mejs-container .mejs-horizontal-volume-slider").append(a)}})}else{b.mediaelementplayer({alwaysShowControls:true,videoWidth:500,videoHeight:270,features:["playpause","current","progress","duration","volume","fullscreen"],success:function(d,e){$(".mejs-container .mejs-time-total,.mejs-container .mejs-horizontal-volume-slider").append(a)}})}}});
KidsBox.View.NotesView=Backbone.View.extend({template:_.template("<% _.each(action, function(acs) { %>	<div>		<textarea data-note-id='<%= acs.noteId %>' placeholder='Note...'><%= acs.content %></textarea>		<a href='#' data-note-id='<%= acs.noteId %>'><span class='icon icon-medium icon-delete'></span></a>	</div><% }); %>"),events:{"click #addNote":"addNote","click a[data-note-id]":"removeNote","keyup textarea":"updateNote"},initialize:function(){this.listenTo(this.model,"add",this.render);this.listenTo(this.model,"remove",this.render);this.render()},render:function(){this.$("#notesContainerContent").empty().append(this.template({action:this.model.toJSON()}));return this},addNote:function(b){b.preventDefault();var a=new KidsBox.Model.NotesModel({content:"",noteId:_.uniqueId()});this.model.add(a);a.save()},removeNote:function(a){a.preventDefault();this.model.findWhere({noteId:$(a.currentTarget).attr("data-note-id")}).destroy()},updateNote:function(a){a.preventDefault();this.model.findWhere({noteId:$(a.currentTarget).attr("data-note-id")}).set("content",$(a.currentTarget).val()).save()}});
KidsBox.View.BookMarkView=Backbone.View.extend({template:_.template('<% _.each(action, function(acs) { %>	<div>	<div class=\'menu-tool-box\'><a href=\'<%= acs.bookMarkUrl %>\'><%= acs.bookMarkTitle %></a></div>		<a href=\'#\' data-id=\'<%= acs.bookMarkId %>\'>			<span class=\'icon icon-medium icon-delete\'></span>		</a>	</div><% }); %><div>	<input id="bookMarkInput" type="text" class="add">	<a href="#" id="addBookMark"><span class="icon icon-medium icon-add"></span></a></div>'),events:{"click #addBookMark":"addBookMark","click a[data-id]":"removeBookMark"},initialize:function(){this.listenTo(this.model,"add",this.render);this.listenTo(this.model,"remove",this.render);this.render()},render:function(){this.$("#bookMarkContainerContent").empty().append(this.template({action:this.model.toJSON()}));return this},addBookMark:function(a){a.preventDefault();var b=this.$("#bookMarkInput").val();if(b.length>0){KidsBox.Singleton.BookMarkCollection.addNewModel(b)}},removeBookMark:function(a){a.preventDefault();this.model.findWhere({bookMarkId:$(a.currentTarget).attr("data-id")}).destroy()}});
KidsBox.View.BookMarkApiView=Backbone.View.extend({events:{"click .search-results-header a":"close","click .search-results-result a[data-id]":"goTo","click .search-results-result a[data-delete]":"deleteItem"},template:_.template("<% _.each(action, function(acs) { %><div class='search-results-result'><a data-id='' href='<%= acs.bookMarkUrl %>'><%= acs.bookMarkTitle %></a><a style='float:right;' data-delete='<%= acs.bookMarkId %>' href='#'><span class='icon icon-medium icon-delete'></span></a></div><% }); %>"),initialize:function(){this.listenTo(this.model,"add",this.modeladded)},render:function(){this.$("#bookMarkApiContainerContent").empty().append(this.template({action:this.model.toJSON()}));this.$(".search-results-header p").remove();this.$(".search-results-header").append("<p>"+$("#toolBookMark").text()+"</p>");this.$el.show();return this},modeladded:function(){if(this.$(".devPopupBg").is(":visible")){this.render()}},goTo:function(a){this.close()},close:function(a){if(a){a.preventDefault()}this.$el.hide()},deleteItem:function(a){a.preventDefault();this.model.findWhere({bookMarkId:$(a.currentTarget).attr("data-delete")}).destroy();this.render()}});
KidsBox.View.SearchView=Backbone.View.extend({events:{"click .search-results-header a":"close","click .search-results-result a":"goTo"},template:_.template("<% _.each(action, function(acs) { %><div class='search-results-result'><p><a href='<%= acs.url %>'><%= acs.title %></a></p><p><%= acs.numberResults %> matches</p></div><% }); %>"),initialize:function(){this.listenTo(this.model,"add",this.render)},render:function(){this.$("#searchContainerContent").empty().append(this.template({action:this.model.toJSON()}));var a=this.$(".search-results-header a");this.$(".search-results-header").empty().append(this.model.getTotResult()+" matches for "+this.model.getTextToFind()).append(a);this.$el.show();return this},goTo:function(a){this.$el.hide();if(KidsBox.Singleton.PagesCollection.getIdCurrentPage()===$(a.currentTarget).attr("href").replace("#/pag/","")){KidsBox.Singleton.ViewA.markSearch();KidsBox.Singleton.ViewB.markSearch();KidsBox.Singleton.ViewC.markSearch()}},close:function(a){a.preventDefault();this.$el.hide()}});
KidsBox.View.ResourceLinkView=Backbone.View.extend({events:{"click #btnCloseToolLink":"close","click #btnSaveToolLink":"save"},initialize:function(){this.listenTo(this.model,"change:selection",this.render)},render:function(){this.$("input").val(this.model.get("url"));return this},close:function(a){a.preventDefault();$("#resourceLinkContainer").parent().removeClass("current")},save:function(a){a.preventDefault();KidsBox.Singleton.CurrentPagesCollection.updateLink(this.model.get("selection"),this.$("input").val());this.close(a)}});
KidsBox.Router.CourseRouter=Backbone.Router.extend({routes:{"":"index","pag/:value":"page","tema/:value":"theme","popup/:value":"popup"},index:function(){KidsBox.Singleton.CurrentPopupModel.set("visible",false);KidsBox.Singleton.NavigatorModel.set("current",0);NAPI.indexOrPage("index")},page:function(b){var c=new NAPI.Bookmarks();var a=c.exists(NAPI._currentBookPage());if(a===true){NAPI.lastBM=NAPI._currentBookPage()}KidsBox.Singleton.CurrentPopupModel.set("visible",false);KidsBox.Singleton.NavigatorModel.setCurrentById(b);KidsBox.Singleton.FooterModel.set({bookpage:b});if(parseInt(b)>0){NAPI.indexOrPage("page")}},popup:function(a){KidsBox.Singleton.CurrentPopupModel.set("visible",false);KidsBox.Singleton.CurrentPopupModel.setCurrentById(a)},theme:function(a){KidsBox.Singleton.CurrentPopupModel.set("visible",false);KidsBox.Singleton.NavigatorModel.setCurrentByThemeId(a)}});
NetexTemplateToolsApi.prototype.DB=function(){var a=this;this.objectStore;this.vdb=undefined;this.db={connection:(window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB),version:1,name:"dcp_kidsbox_attachments"};this.dbrequest=undefined;if(this.dbrequest===undefined){if(!this.db.connection){NAPI.idbSupport=false;return false}else{NAPI.idbSupport=true}this.dbrequest=this.db.connection.open(this.db.name,this.db.version)}this.dbrequest.onerror=function(b){};this.dbrequest.onsuccess=function(b){a.vdb=a.dbrequest.result;var c=a.vdb.transaction("files","readwrite");c.onerror=function(){a.objectStore=a.vdb.createObjectStore("files",{keyPath:"bookzone"})};c.oncomplete=function(){}};this.dbrequest.onupgradeneeded=function(b){a.vdb=b.target.result;a.objectStore=a.vdb.createObjectStore("files",{keyPath:"bookzone"});a.objectStore.createIndex("name","name",{unique:false});a.objectStore.createIndex("bookzone","bookzone",{unique:false})}};var IDB=new NAPI.DB();
NetexTemplateToolsApi.prototype.Attachments=function(){var b=$("body").attr("data-course-id");var a=this;this.storageKey=b+"_90_kidsbox_attachments";this.storage=(!NAPI.isLocalAndIE)?window.localStorage:KidsBox.localStorage;this.fileSelector=undefined;if(NAPI.idbSupport===true){this.objectStore=IDB.objectStore;this.vdb=IDB.vdb;this.db=IDB.db;this.dbrequest=IDB.dbrequest}else{this.objectStore=null;this.vdb=null;this.db=null;this.dbrequest=null}this.createFirstInstance=function(){if(!this._get()){this._set("")}};this["new"]=function(c,f,e){var d=this._get();if(Number(f)>610){f=610}if(d!==""){d+=this._pattern()}d+=c+this._patternField()+f+this._patternField()+e+this._patternField();this.setNote(c,f,e,"",true,d)};this.save=function(o,d,j,f,l,i,c){var h=this.getByPosition(o,d,j);var g=h.split(this._patternField());var r=this;if(l&&i){g[1]=l;g[2]=i;var e=this.dbrequest;var n=o+"-"+d+"-"+j;var q=o+"-"+l+"-"+i;var s=this.vdb.transaction(["files"],"readwrite");var k=s.objectStore("files");var p=k.index("bookzone");var m=p.openCursor(IDBKeyRange.only(n));m.onsuccess=function(t){var v=t.target.result;v.value.bookzone=q;var u=k["delete"](n);k.put(v.value)}}g[3]=f;this["delete"](o,d,j);this.saveByPosition(g);if(c){$(".attachment").each(function(){$(this).remove()});setTimeout(function(){r.renderAllAttachmentsByBookpage(o)},10)}};this["delete"]=function(l,c,h){var j=this._getSplit();var g=new Array();for(var k in j){var f=j[k].split(this._patternField());if(Number(f[0])!==Number(l)||Number(f[1])!==Number(c)||Number(f[2])!==Number(h)){g.push(j[k])}}var e="";for(var d in g){if(d>0){e+=this._pattern()}e+=g[d]}this.stringifyAndSave(e)};this.stringifyAndSave=function(c){this._set(c)};this.handleFileSelect=function(m,n,d,k,l,e){var o=this;var c=m.target.files;$(".main-content").append(l[0]);this._set(e);var p=$(".attachment[rel-bookpage="+n+"][rel-left="+d+"][rel-top="+k+"]");this.bindActions(p);for(var g=0,j;j=c[g];g++){var h=new FileReader();h.onload=(function(f){return function(i){$(".attachment[rel-bookpage="+n+"][rel-left="+d+"][rel-top="+k+"]").find(".attachdata").attr({filename:f.name}).html(i.target.result);o.trans(n,d,k)}})(j);h.readAsDataURL(j)}};this.trans=function(i,c,g){var j=this;var e=this.dbrequest;var f={bookzone:i+"-"+c+"-"+g,name:$(".attachment[rel-bookpage="+i+"][rel-left="+c+"][rel-top="+g+"]").find(".attachdata").attr("filename"),content:$(".attachment[rel-bookpage="+i+"][rel-left="+c+"][rel-top="+g+"]").find(".attachdata").html()};var k=this.vdb.transaction(["files"],"readwrite");k.oncomplete=function(l){};k.onerror=function(l){};var h=k.objectStore("files");var d=h.add(f);d.onsuccess=function(l){}};this.setNote=function(j,c,g,e,f,d){var k=this;if(!e){e=""}var i=this._template(j,c,g,e);if(f===true){var h=$("#inputFile");h.off("change").on("change",function(m){k.handleFileSelect(m,j,c,g,i,d);h.off("change").val("")});h.trigger("click")}else{$(".main-content").append(i);this.setAttachToTemplate(j,c,g,e);var l=$(".attachment[rel-bookpage="+j+"][rel-left="+c+"][rel-top="+g+"]");this.bindActions(l)}};this.setAttachToTemplate=function(k,d,h,f){var l=$(".attachment[rel-bookpage="+k+"][rel-left="+d+"][rel-top="+h+"]");var c=$(".attachment[rel-bookpage="+k+"][rel-left="+d+"][rel-top="+h+"]").find(".attachdata");if(this.vdb===undefined){var e=new NAPI.DB();this.vdb=e.vdb}var m=this.vdb.transaction("files");var j=m.objectStore("files");var i=k+"-"+d+"-"+h;var g=j.openCursor();g.onsuccess=function(o){var p=o.target.result;if(p&&p.value.bookzone===i){var n=p.value;c.attr("filename",n.name);c.html(n.content)}else{if(p){p["continue"]()}}}};this.getMIMEType=function(e){var d=new RegExp(/data\:(.*);base64/);var c=d.exec(e);return c};this.generateBlob=function(f){var e=this.getMIMEType(f);var c,d;if(e){if(e[1]===""){e[1]="application/octet-stream"}c=[f];d=new Blob(c,{type:e[1]})}else{c=[f];d=new Blob(c)}return d};this.bindActions=function(g){var e=this;g.find(".launcher .icon-attach-launch").unbind().bind("click",function(j){var i=new FileReader();i.onload=function(k){console.log(k.target.result);window.open(k.target.result,"_blank");console.log("despues")};if(i.readAsBinaryString){i.readAsBinaryString(e.generateBlob(g.find(".attachdata").html()))}else{i.readAsDataURL(e.generateBlob(g.find(".attachdata").html()))}});g.find(".close .icon-attach-close").unbind().bind("click",function(i){$(".dark-background").show().css("visibility","visible");$("#sticky-delete-confirm-attach").show();$("#sticky-delete-confirm-attach #deleteNoteYes").unbind().bind("click",function(j){e.deleteAttach(g);g.remove();$("#sticky-delete-confirm-attach").hide();$(".dark-background").hide()});$("#sticky-delete-confirm-attach #deleteNoteNo").unbind().bind("click",function(j){$("#sticky-delete-confirm-attach").hide();$(".dark-background").hide()})});var d=document.querySelectorAll(".attachment");for(var f=0,c=d.length;f<c;f++){var h=d[f];new Draggabilly(h,{handle:".handler",containment:true}).on("dragEnd",function(q,o,n){if(q.element){var k=q.element;var m={bookpage:k.getAttribute("rel-bookpage"),left:k.getAttribute("rel-left"),top:k.getAttribute("rel-top"),};var j=window.getComputedStyle(k,null);var l=j.getPropertyValue("left").replace("px","");var i=j.getPropertyValue("top").replace("px","");e.save(m.bookpage,m.left,m.top,"",l,i,true)}})}};this.deleteAttach=function(d){this["delete"](d.attr("rel-bookpage"),d.attr("rel-left"),d.attr("rel-top"));var c=this.vdb.transaction("files","readwrite");var g=c.objectStore("files");var f=d.attr("rel-bookpage")+"-"+d.attr("rel-left")+"-"+d.attr("rel-top");var e=g["delete"](f);e.onsuccess=function(h){}};this.getByPage=function(c){var f=this._getSplit();var d=new Array();for(var e in f){var g=f[e].split(this._patternField());if(parseInt(g[0])===parseInt(c)){d.push(f[e])}}return d};this.saveByPosition=function(c){c=c.join(this._patternField());var d=this._get()+this._pattern()+c;this._set(d)};this.getByPosition=function(c,i,h){var f=this._getSplit();var d="";for(var e in f){var g=f[e].split(this._patternField());if(g[0]==c&&g[1]==i&&g[2]==h){d=f[e]}}return d};this.renderAllAttachmentsByBookpage=function(c){var e=this.getByPage(c);for(var d in e){var f=e[d].split(this._patternField());this.setNote(f[0],f[1],f[2],f[3])}};this._get=function(){if(this.storage===undefined){return""}return this.storage.getItem(this.storageKey)};this._set=function(c){if(this.storage===undefined){return""}return this.storage.setItem(this.storageKey,c)};this._getSplit=function(){var d=this._get();var c=d.split(this._pattern());return c};this._pattern=function(){return"|(@)|"};this._patternField=function(){return"||"};this._template=function(c,g,f,e){var d=$("<div/>").attr({"class":"attachment",style:"left:"+g+"px;top:"+f+"px","rel-bookpage":c,"rel-left":g,"rel-top":f,"rel-content":e}).html('<div class="close"><div class="sprite icon-attach-close"></div></div><div class="handler"><div class="sprite icon-attachment"><input type="file" multiple class="file-hide" id="file-'+c+"-"+g+"-"+f+'"></div></div><div class="launcher"><div class="sprite icon-attach-launch"></div><div class="attachdata"></div></div>');return d};this.createFirstInstance()};
NetexTemplateToolsApi.prototype.Bookmarks=function(){var a=$("body").attr("data-course-id");this.storageKey=a+"_90_kidsbox_bookmarks";this.storage=(!NAPI.isLocalAndIE)?window.localStorage:KidsBox.localStorage;this.createFirstInstance=function(){if(!this._get()){this._set("")}};this.add=function(e,c,g){if(!this.exists(c)){var b=e+","+c+","+g;var d=(this._get())?this._get()+"|":"";var f=d+b;return this._set(f)}else{return false}};this.remove=function(b){var f=this._getSplit();var h=new Array();for(var d=0;d<f.length;d++){var e=f[d].split(",");if(Number(e[1])!==Number(b)){h.push({themeId:e[0],bookpage:e[1],isWorkbook:e[2]})}}var g=new Array();for(var c=0;c<h.length;c++){g.push(h[c].themeId+","+h[c].bookpage+","+h[c].isWorkbook)}return this._set(g.join("|"))};this.list=function(){var d=this._getSplit();var e=new Array();for(var b=0;b<d.length;b++){var c=d[b].split(",");if(Number(c[0])&&Number(c[1])){e[b]={themeId:c[0],bookpage:c[1],isWorkbook:c[2]}}}return(e.length>0)?JSON.parse(JSON.stringify(e)):""};this.exists=function(b){var f=this._getSplit();var c=false;for(var d=0;d<f.length;d++){var e=f[d].split(",");if(Number(e[1])===Number(b)){c=true}}return c};this.last=function(){var b=this._getSplit();var c=b[(b.length-1)].split(",");return c[1]};this._get=function(){if(this.storage===undefined){return""}return this.storage.getItem(this.storageKey)};this._set=function(b){if(this.storage===undefined){return""}return this.storage.setItem(this.storageKey,b)};this._getSplit=function(){var b=this._get();var c=b.split("|");return c};this.createFirstInstance()};
NetexTemplateToolsApi.prototype.StickyNotes=function(){var a=$("body").attr("data-course-id");this.storageKey=a+"_90_kidsbox_stickynotes";this.storage=(!NAPI.isLocalAndIE)?window.localStorage:KidsBox.localStorage;this.isResizing=false;this.startCoords={x:null,y:null};this.initialSize={x:null,y:null};this.initialSizeTxt={x:null,y:null};this.resizeElement=null;this.resizeTextarea=null;this.placeholderValue="Insert your text here...";this.createFirstInstance=function(){if(!this._get()){this._set("")}};this["new"]=function(b,f,e){var c=this._get();if(Number(f)>499){f=500}if(c!==""){c+=this._pattern()}var d="open";c+=b+this._patternField()+f+this._patternField()+e+this._patternField()+""+this._patternField()+d;this._set(c);this.setNote(b,f,e,null,d)};this.save=function(k,d,i,e,j,h,c,b){if(!k||k==""||isNaN(k)){k=NAPI._currentBookPage()}if(!b){b="open"}var g=this.getByPosition(k,d,i);var f=g.split(this._patternField());$('.stickyNote[rel-left="'+d+'"][rel-top="'+i+'"][rel-bookpage="'+k+'"]').find(".icon-save").removeClass("icon-save-alert");var l=this;if(j&&h){f[1]=j;f[2]=h}f[3]=e;f[4]=b;if(f[0]===""||!f[0]){f[0]=NAPI._currentBookPage()}this["delete"](k,d,i);this.saveByPosition(f);if(c){$(".stickyNote.sticky-note-open, .stickyNote.sticky-note-closed").each(function(){$(this).remove()});setTimeout(function(){l.renderAllNotesByBookpage(k)},10)}};this["delete"]=function(k,b,g){var h=this._getSplit();var f=new Array();for(var j in h){var e=h[j].split(this._patternField());if(Number(e[0])!==Number(k)||Number(e[1])!==Number(b)||Number(e[2])!==Number(g)){f.push(h[j])}}var d="";for(var c in f){if(c>0){d+=this._pattern()}d+=f[c]}this.stringifyAndSave(d)};this.stringifyAndSave=function(b){this._set(b)};this.setNote=function(c,h,g,e,f){var b=this;if(!e){e=""}if(!f){f="open"}var d=this._template(c,h,g,e,f);$(".main-content").append(d);$("textarea").each(function(){if($(this).val()===b.placeholderValue){$(this).val("")}$(this).simplePlaceholder()});this.bounds();this.makeResizable(d)};this.makeResizable=function(c){var b=this;$(".notes-resize-handler").on(TouchMouseEvent.DOWN,function(d){b.isResizing=true;b.resizeElement=$(this).parent();b.resizeTextarea=$(this).parent().find("textarea");b.initialSize.x=$(this).parent().width();b.initialSize.y=$(this).parent().height();b.initialSizeTxt.x=$(this).parent().find("textarea").innerWidth()-10;b.initialSizeTxt.y=$(this).parent().find("textarea").innerHeight()-10;b.startCoords.x=d.pageX;b.startCoords.y=d.pageY});$(document).on(TouchMouseEvent.MOVE,function(g){if(b.isResizing===true){g.preventDefault();var f=b.resizeElement;var d=b.resizeTextarea;f.css("width",b.initialSize.x+(g.pageX-b.startCoords.x)+"px");f.css("height",b.initialSize.y+(g.pageY-b.startCoords.y)+"px");d.css("width",b.initialSizeTxt.x+(g.pageX-b.startCoords.x)+"px");d.css("height",b.initialSizeTxt.y+(g.pageY-b.startCoords.y)+"px")}});$(document).on(TouchMouseEvent.UP,function(d){if(b.isResizing===true){b.isResizing=false}})};this.bounds=function(){var c=document.querySelectorAll(".stickyNote");for(var d=0,b=c.length;d<b;d++){var e=c[d];new Draggabilly(e,{handle:".icon-tack-handle",containment:true}).on("dragEnd",function(i,h,g){var f;if(i.element){f=i.element.querySelector(".icon-save");if(f){f.className=f.className+" icon-save-alert"}}})}};this.getByPage=function(b){var e=this._getSplit();var c=new Array();for(var d in e){var f=e[d].split(this._patternField());if(parseInt(f[0])===parseInt(b)){c.push(e[d])}}return c};this.saveByPosition=function(b){b=b.join(this._patternField());var c=this._get()+this._pattern()+b;this._set(c)};this.getByPosition=function(b,h,g){var e=this._getSplit();var c="";for(var d in e){var f=e[d].split(this._patternField());if(f[0]===""||!f[0]||isNaN(f[0])){f[0]=NAPI._currentBookPage()}if(Number(f[0])===Number(b)&&Number(f[1])===Number(h)&&Number(f[2])===Number(g)){c=e[d]}}return c};this.renderAllNotesByBookpage=function(b){var d=this.getByPage(b);for(var c in d){var e=d[c].split(this._patternField());this.setNote(e[0],e[1],e[2],e[3],e[4])}};this.setState=function(b,c){b=b.split(this._patternField());b[4]=c;this.save(b[0],b[1],b[2],b[3],null,null,null,c)};this._get=function(){if(this.storage===undefined){return""}return this.storage.getItem(this.storageKey)};this._set=function(b){if(this.storage===undefined){return""}return this.storage.setItem(this.storageKey,b)};this._getSplit=function(){var c=this._get();var b=c.split(this._pattern());return b};this._pattern=function(){return"|(@)|"};this._patternField=function(){return"||"};this._template=function(b,h,g,d,e){var i="display: none;",f="display: block";if(e==="closed"){i="display: block;";f="display: none;"}var c=$("<div/>").attr({"class":"stickyNote sticky-note-"+e,style:"z-index:120;left:"+h+"px;top:"+g+"px","rel-bookpage":b,"rel-left":h,"rel-top":g}).html('<div class="icon-tack-handle"><div class="sprite icon-tack-small pull-left"></div></div><div class="sprite icon-close-small pull-right" id="closeTack"></div><div class="sprite icon-minime pull-right" id="minimizeTack" style="'+f+'"></div><div class="sprite icon-enlarge pull-right" id="maximizeTack" style="'+i+'"></div><textarea class="sticky-note-text" placeholder="Insert your text here...">'+d+'</textarea><div class="sprite icon-save pull-center"></div><div class="notes-resize-handler"></div>');return c};this.createFirstInstance()};
NetexTemplateToolsApi.prototype.Links=function(){var b=$("body").attr("data-course-id");var a=this;this.storageKey=b+"_90_kidsbox_links";this.storage=(!NAPI.isLocalAndIE)?window.localStorage:KidsBox.localStorage;this.createFirstInstance=function(){if(!this._get()){this._set("")}};this["add"]=function(d,c){var e=this._get();if(e!==""){e+=this._pattern()}e+=d+this._patternField()+c;this.save(e)};this["save"]=function(c){this._set(c)};this["remove"]=function(f,e){var g=new Array(),d=this._getSplitted();for(var c in d){if(d[c][0]!==f&&d[c][1]!==e){g.push(d[c])}}this.setAfterRemove(g)};this.setAfterRemove=function(d){var f=new Array();for(var c in d){f.push(d[c].join(this._patternField()))}var e=f.join(this._pattern());this.save(e)};this._get=function(){if(this.storage===undefined){return""}return this.storage.getItem(this.storageKey)};this._set=function(c){if(this.storage===undefined){return""}return this.storage.setItem(this.storageKey,c)};this._getSplit=function(){var d=this._get();var c=d.split(this._pattern());return c};this._getSplitted=function(){var e=this._get();var d=e.split(this._pattern());for(var c in d){d[c]=d[c].split(this._patternField())}return d};this._pattern=function(){return"|(@)|"};this._patternField=function(){return"||"};this.createFirstInstance()};
NetexTemplateToolsApi.prototype.Canvas=function(){this.dataCourse=$("body").attr("data-course-id");this.storageKey=this.dataCourse+"_90_kidsbox_canvas";this.storage=(!NAPI.isLocalAndIE)?window.localStorage:KidsBox.localStorage;this.canvas=undefined;this.canvasId=undefined;this.context=undefined;this.click=false;this.xCoord="",this.yCoord="";this.offsetLeft=undefined;this.offsetTop=undefined;this.rubberActive=false;this.pointerActive=false;this.createFirstInstance=function(){this._set("")};this._init=function(f,c){this.canvas=$("#"+f);var e=f.replace("canvas_","");if(this.storageKey===this.dataCourse+"_90_kidsbox_canvas"||this.storageKey!==this.dataCourse+"_90_kidsbox_canvas_"+e){this.storageKey=this.dataCourse+"_90_kidsbox_canvas_"+e;if(!this._get()){this.createFirstInstance()}}this.canvasId=f;this.context=(f)?document.getElementById(f).getContext("2d"):undefined;var b=this;var a=this._get();if(a){var d=new Image();d.onload=function(){b.context.drawImage(this,0,0)};d.src=a}this.context.strokeStyle="#000";this.context.lineWidth=6;this.context.lineCap="round";this.context.lineJoin="round";this.context.fillStyle="transparent";this.bindEvents();this.offsetLeft=this.canvas.offset().left;this.offsetTop=this.canvas.offset().top;this.checkTrueOffset();this.clearRubberPixels();this.show()};this.hide=function(){if(this.canvas.is(":visible")){this.canvas.hide()}};this.show=function(){if(!this.canvas.is(":visible")){this.canvas.show()}};this.checkTrueOffset=function(){var a=this;if(this.offsetLeft===0){setTimeout(function(){a.offsetLeft=a.canvas.offset().left;a.offsetTop=a.canvas.offset().top;a.checkTrueOffset()},100)}};this.changeColor=function(c){var e=this.hexToRgb(c),d,b;if(this.context.lineCap==="square"&&e!==null){d="rgba("+e.r+", "+e.g+", "+e.b+", 0.2)";b="rgb("+e.r+", "+e.g+", "+e.b+")"}else{if(e===null){var f=/(\d+), (\d+), (\d+)/g;if(f.test(c)===true){var a=c.match(f);a=a[0].split(", ");if(this.context.lineCap==="square"){d="rgba("+a[0]+", "+a[1]+", "+a[2]+", 0.2)"}else{d="rgb("+a[0]+", "+a[1]+", "+a[2]+")"}b="rgb("+a[0]+", "+a[1]+", "+a[2]+")"}}else{d="rgb("+e.r+", "+e.g+", "+e.b+")";b="rgb("+e.r+", "+e.g+", "+e.b+")"}}if(this.rubberActive===false){$("#selectPalette").css("background-color",b);if(b==="rgb(255, 255, 255)"||b==="rgba(255, 255, 255, 0.2)"){$("#selectPalette").css("background-color","#e0e0e0")}}this.context.strokeStyle=d};this.changePencil=function(a){this.context.lineCap=a};this.changePencilWidth=function(a){this.context.lineWidth=a};this.knowImageSize=function(b){var a=this,c;switch(b){case"b":c=(1/8);break;case"Kb":c=(1024/8);break;case"KB":c=1024;break;case"MB":c=(1024*1024);break;case"GB":c=(1024*1024*1024);break;case"B":default:c=1;break}return((encodeURI(a.toData()).split(/%..|./).length-1)/c)};this.toData=function(b){var a=this;if(!b){b="image/png"}if(a.canvasId){return document.getElementById(a.canvasId).toDataURL(b)}else{return null}};this.bindEvents=function(){var a=this;$("#"+a.canvasId).on(TouchMouseEvent.DOWN,function(b){if(a.pointerActive===false){if(NAPI.holdCreateMask===false){a.click=true;a.context.save();a.xCoord=b.pageX-a.offsetLeft;a.yCoord=b.pageY-a.offsetTop}}});$("#"+a.canvasId).on(TouchMouseEvent.MOVE,function(b){b.preventDefault();if(a.click===true){var f=Number(b.pageX),d=Number(a.offsetLeft),e=Number(b.pageY),c=Number(a.offsetTop);a.context.beginPath();if(a.rubberActive===true){a.clearCircle((f-d),(e-c),25)}else{a.context.moveTo(f-d,e-c);a.context.lineTo(a.xCoord,a.yCoord);a.context.stroke()}a.context.closePath();a.xCoord=b.pageX-a.offsetLeft;a.yCoord=b.pageY-a.offsetTop}});$(document).on(TouchMouseEvent.UP,function(){a._set(a.toData());a.click=false});$(document).click(function(){a.click=false})};this.clearAll=function(){var a=document.getElementById(this.canvasId);this.context.clearRect(0,0,a.width,a.height);this._set(this.toData())};this.clearCircle=function(b,c,a){this.context.save();this.context.arc(b,c,a,0,2*Math.PI,false);this.context.clip();this.context.clearRect((b-a-1),(c-a-1),(a*4+2),(a*4+2));this.context.restore()};this.hexToRgb=function(c){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;c=c.replace(b,function(e,h,f,d){return h+h+f+f+d+d});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};this.clearRubberPixels=function(){var k=this,a=document.getElementById(k.canvasId),g=k.context.getImageData(0,0,a.width,a.height),b=g.data,c=[],e=[],j=[],d=[];for(var f=0;f<b.length;f+=4){c[f/4]=b[f];e[f/4]=b[f+1];j[f/4]=b[f+2];d[f/4]=b[f+3]}for(var f=0,h=a.width*a.height;f<h;f++){if(c[f]<10&&e[f]>100&&j[f]<10){b[(f*4)+3]=0}}k.context.putImageData(g,0,0)};this.scaleAndDraw=function(){var d=this,a=d.canvasId.replace("canvas_","canvas_zoom_"),e=document.getElementById(d.canvasId),c=document.getElementById(a),b=d.context.getImageData(0,0,e.width,e.height);var f=$("<canvas>").attr({width:c.width,height:c.height,id:"temp_canvas"})[0];var g=c.getContext("2d");f.getContext("2d").putImageData(b,0,0);this.resetZoomStyle(g,c);g.scale(2,2);g.drawImage(f,0,0);c.style.display="block";e.style.display="none"};this.restoreScale=function(){var c=this,a=c.canvasId.replace("canvas_","canvas_zoom_"),d=document.getElementById(c.canvasId),b=document.getElementById(a);var e=b.getContext("2d");this.resetZoomStyle(e,b);this.pointerActive=false};this.resetZoomStyle=function(b,a){b.setTransform(1,0,0,1,0,0);b.fillStyle="transparent";b.clearRect(0,0,a.width,a.height)};this._get=function(){if(this.storage===undefined){return""}return this.storage.getItem(this.storageKey)};this._set=function(c){if(this.storage===undefined){return""}var b,a=this;try{return a.storage.setItem(this.storageKey,c)}catch(d){return b=d}}};var NetexCanvas=new NAPI.Canvas();